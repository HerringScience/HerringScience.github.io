library(gridExtra)
library(cowplot)
larv = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/Larval Measurements.csv"))
arc = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/ARC Data.csv"))
arc = arc %>% dplyr::select(id, Larvae_Count, Notes)
survey = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv"))
survey = survey %>% mutate(Ground = substr(id,1,2))
larv = left_join(larv, arc, by="id")
larv = left_join(larv, survey)
larv = larv %>% dplyr::select(Ground, id, Date, Survey.No, No_jars, Lengthmm, Condition, Yolk_sac, Preservative, ARC_Count=Larvae_Count, ARC_Notes=Notes, Lon1, Lat1, Lon2, Lat2, TowTime, AvgTowDepth, MaxTowDepth, CTDAvgTemp=AvgTemp, Volume, Month, Year, Day)
larv$Date = dmy(larv$Date)
larv$Survey.No = as.factor(larv$Survey.No)
larv$Year = as.factor(larv$Year)
larv$category =  with(larv, ifelse(larv$Lengthmm < 8 , 1,
ifelse(larv$Lengthmm < 12 & larv$Lengthmm >= 8, 2,
ifelse(larv$Lengthmm >= 12  & larv$Lengthmm < 17, 3,
ifelse(larv$Lengthmm > 17 & larv$Lengthmm < 27, 4, 5)))))
larv$category = as.factor(larv$category)
larv$hatchDate = larv$Date - 10 #incubation duration of 10 days
larv$hatchDate = ymd(larv$hatchDate)
#Calculating spawn dates
larv=larv %>% mutate(MAXspawnDate = ifelse(category == 1, hatchDate-14,
ifelse(category == 2, hatchDate-35,
ifelse(category == 3, hatchDate-56,
ifelse(category == 4, hatchDate-98,
ifelse(category == 5, hatchDate-99, "NA"))))))
larv$MAXspawnDate=as.numeric(larv$MAXspawnDate)
larv$MAXspawnDate=as.Date(larv$MAXspawnDate, origin = "1970-01-01")
larv=larv %>% mutate(MINspawnDate = ifelse(category == 1, hatchDate,
ifelse(category == 2, hatchDate-14,
ifelse(category == 3, hatchDate-35,
ifelse(category == 4, hatchDate-56,
ifelse(category == 5, hatchDate-98, "NA"))))))
larv$MINspawnDate=as.numeric(larv$MINspawnDate)
larv$MINspawnDate=as.Date(larv$MINspawnDate, origin = "1970-01-01")
#add Julian
larv<-larv %>% mutate(Julian = yday(Date))
#Calculating SE/mean/min/max of larval measurements. Changed 'group by' in both larvsummary to (id) from (Ground, Survey.No, Year)
larv <- larv %>%
group_by(Ground, Survey.No, Year) %>%
mutate(SD = sd(Lengthmm), MinLength = min(Lengthmm), MaxLength = max(Lengthmm), MeanLength = mean(Lengthmm), Abundance = length(Lengthmm)) %>%
ungroup()
larvsummary <- larv %>% group_by(id) %>%
summarize(MinLength = mean(MinLength, na.rm = TRUE),
MaxLength = mean(MaxLength, na.rm = TRUE),
MeanLength = mean(MeanLength, na.rm = TRUE),
SD = mean(SD, na.rm = TRUE),
Abundance = length(Lengthmm)) %>%
mutate(SE = SD/sqrt(Abundance))
surveysummary = survey %>% dplyr::select(id, Ground, Survey.No, Year) %>% group_by(id, Ground, Survey.No, Year) %>% summarize(Survey.No = Survey.No, Year = Year)
surveysummary$Year = as.factor(surveysummary$Year)
surveysummary$Survey.No = as.factor(surveysummary$Survey.No)
larvsummary = left_join(surveysummary, larvsummary)
larvsummary %>% write.csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/Larval Summary Table.csv"))
larv = larv %>%
mutate(Larv_per_jar = Abundance/No_jars) %>%
mutate(Volume = ifelse(Volume < 0.01, NA, Volume)) %>%
mutate(Density = Larv_per_jar/Volume)
#Adds TowID based on date
#larv <- larv %>%
#  group_by(Ground) %>%
#  transform(TowID = as.numeric(factor(Date)))
#Replicate True or False
#Larval1 <- larv %>%
#  group_by(TowID) %>%
#  summarize(TowReplicate = n_distinct(id))
#Larval1$TowReplicate[Larval1$TowReplicate == "1"] <- "False"
#Larval1$TowReplicate[Larval1$TowReplicate == "2"] <- "True"
#larv <- merge(larv, Larval1, by = "TowID")
# if preservative is formalin, apply L  = 0.984 + 0.993 x X1. (X1 = fixed/preserved length therefore Larval$Lengthmm, L = Live length.)
# if preservation is alcohol apply L = 0.532 + 0.989 x X1
#This is taken from Fox 1996 alcohol vs Formalin paper. They did 5% and 5 minute net capture simulation. They did suggest that this adjustment would be less accurate the longer the tow period.
# These equations are when the maximum shrinkage has occured.
larv$LengthAdjustment = with(larv, ifelse(larv$Preservative == "4% formalin", (0.984 + 0.993* larv$Lengthmm),
ifelse(larv$Preservative == "70% alcohol", (0.532 + 0.989*larv$Lengthmm),
ifelse(larv$Preservative == "Unknown", NA,
ifelse(larv$Preservative == "70% Alcohol (1) 4% Formalin (1)", NA, NA)))))
# Changed all NAs to 0 to ensure that they stay within the dataframe. Will change back to NA at the end of the process as none of the values can be 0.
#larv[is.na(larv)] <- 0
MeanLengthAdjustment <- aggregate(LengthAdjustment~id, larv, mean)
colnames(MeanLengthAdjustment)[2]<- "MeanLengthAdjustment"
#'Exact' spawn date. Growth rate of .24mm/day based on Chenoweth 1989 paper.
# Paper says applies estimate growth rates to calculate the number of days back to 5mm. Took 5mm off total length to account for this.
# Assumes hatching length is 5mm, day of hatching = day 0
larv$AdjustedAgeInDays <- ((larv$LengthAdjustment - 5)/0.24)
larv <- merge(larv, MeanLengthAdjustment)
larv$AdjustedSpawnDate <- larv$Date-larv$AdjustedAgeInDays
AdjustedMeanAgeInDays <- aggregate(AdjustedAgeInDays~id, larv, mean)
colnames(AdjustedMeanAgeInDays)[2]<- "AdjustedMeanAgeInDays"
AdjustedMinDateOfSpawn <- aggregate(AdjustedSpawnDate~id, larv, min)
colnames(AdjustedMinDateOfSpawn)[2] <- "AdjustedMinDateOfSpawn"
AdjustedMaxDateOfSpawn <- aggregate(AdjustedSpawnDate~id, larv, max)
colnames(AdjustedMaxDateOfSpawn)[2] <- "AdjustedMaxDateOfSpawn"
AdjustedDays <- merge(AdjustedMaxDateOfSpawn, AdjustedMinDateOfSpawn, by = 'id')
AdjustedDays <- merge(AdjustedDays, AdjustedMeanAgeInDays, by = 'id')
larv <- merge(larv, AdjustedDays, by = 'id')
#Calculating SE/mean/min/max of larval measurements. Changed 'group by' in both larvsummary to (id) from (Ground, Survey.No, Year)
larv <- larv %>%
group_by(Ground, Survey.No, Year) %>%
mutate(AvgSD = sd(LengthAdjustment), AdjustedMinLength = min(LengthAdjustment), AdjustedMaxLength = max(LengthAdjustment), Abundance = length(Lengthmm)) %>%
ungroup()
View(larv)
larvsummary <- larv %>% group_by(id) %>%
summarize(MeanAdjustedMinLength = mean(AdjustedMinLength, na.rm = TRUE),
MeanAdjustedMaxLength = mean(AdjustedMaxLength, na.rm = TRUE),
MeanAdjustedSD = mean(SD, na.rm = TRUE),
Abundance = length(LengthAdjustment)) %>%
mutate(SE = SD/sqrt(Abundance))
#Calculating SE/mean/min/max of larval measurements. Changed 'group by' in both larvsummary to (id) from (Ground, Survey.No, Year)
larv <- larv %>%
group_by(Ground, Survey.No, Year) %>%
mutate(AvgSD = sd(LengthAdjustment), AdjustedMinLength = min(LengthAdjustment), AdjustedMaxLength = max(LengthAdjustment), Abundance = length(LengthAdjustment)) %>%
ungroup()
larvsummary <- larv %>% group_by(id) %>%
summarize(MeanAdjustedMinLength = mean(AdjustedMinLength, na.rm = TRUE),
MeanAdjustedMaxLength = mean(AdjustedMaxLength, na.rm = TRUE),
MeanAdjustedSD = mean(SD, na.rm = TRUE),
Abundance = length(LengthAdjustment)) %>%
mutate(SE = SD/sqrt(Abundance))
View(larv)
#Calculating SE/mean/min/max of larval measurements. Changed 'group by' in both larvsummary to (id) from (Ground, Survey.No, Year)
larv <- larv %>%
group_by(Ground, Survey.No, Year) %>%
mutate(AvgSD = sd(LengthAdjustment), AdjustedMinLength = min(LengthAdjustment), AdjustedMaxLength = max(LengthAdjustment), MeanLengthAdjustment = MeanLengthAdjustment, Abundance = length(LengthAdjustment)) %>%
ungroup()
larvsummary <- larv %>% group_by(id) %>%
summarize(MeanAdjustedMinLength = mean(AdjustedMinLength, na.rm = TRUE),
MeanAdjustedMaxLength = mean(AdjustedMaxLength, na.rm = TRUE),
MeanAdjustedSD = mean(SD, na.rm = TRUE),
Abundance = length(LengthAdjustment)) %>%
mutate(SE = SD/sqrt(Abundance))
larv[is.na(larv)] <- 0
str()
str(condition)
str(Condition)
larvsummary <- larv %>% group_by(id) %>%
summarize(MeanAdjustedMinLength = mean(AdjustedMinLength, na.rm = TRUE),
MeanAdjustedMaxLength = mean(AdjustedMaxLength, na.rm = TRUE),
MeanAdjustedSD = mean(AvgSD, na.rm = TRUE),
Abundance = length(LengthAdjustment)) %>%
mutate(SE = SD/sqrt(Abundance))
#Calculating SE/mean/min/max of larval measurements. Changed 'group by' in both larvsummary to (id) from (Ground, Survey.No, Year)
larv <- larv %>%
group_by(Ground, Survey.No, Year) %>%
mutate(AvgSD = sd(LengthAdjustment), AdjustedMinLength = min(LengthAdjustment), AdjustedMaxLength = max(LengthAdjustment), MeanLengthAdjustment = MeanLengthAdjustment, Abundance = length(LengthAdjustment)) %>%
ungroup()
larvsummary <- larv %>% group_by(id) %>%
summarize(MeanAdjustedMinLength = mean(AdjustedMinLength, na.rm = TRUE),
MeanAdjustedMaxLength = mean(AdjustedMaxLength, na.rm = TRUE),
MeanAdjustedSD = mean(AvgSD, na.rm = TRUE),
Abundance = length(LengthAdjustment)) %>%
mutate(SE = SD/sqrt(Abundance))
#Calculating SE/mean/min/max of larval measurements. Changed 'group by' in both larvsummary to (id) from (Ground, Survey.No, Year)
larv <- larv %>%
group_by(Ground, Survey.No, Year) %>%
mutate(AvgSD = sd(LengthAdjustment), AdjustedMinLength = min(LengthAdjustment), AdjustedMaxLength = max(LengthAdjustment), MeanLengthAdjustment = MeanLengthAdjustment, Abundance = length(LengthAdjustment)) %>%
ungroup()
larvsummary <- larv %>% group_by(Ground, Survey.No, Year) %>%
summarize(MeanAdjustedMinLength = mean(AdjustedMinLength, na.rm = TRUE),
MeanAdjustedMaxLength = mean(AdjustedMaxLength, na.rm = TRUE),
MeanAdjustedSD = mean(AvgSD, na.rm = TRUE),
Abundance = length(LengthAdjustment)) %>%
mutate(SE = SD/sqrt(Abundance))
larvsummary <- larv %>% group_by(id) %>%
summarize(MeanAdjustedMinLength = mean(AdjustedMinLength, na.rm = TRUE),
MeanAdjustedMaxLength = mean(AdjustedMaxLength, na.rm = TRUE),
MeanAdjustedSD = mean(AvgSD, na.rm = TRUE),
Abundance = length(LengthAdjustment)) %>%
mutate(SE = SD/sqrt(Abundance))
larvsummary <- larv %>% group_by(Ground, Survey.No, Year) %>%
summarize(MeanAdjustedMinLength = mean(AdjustedMinLength, na.rm = TRUE),
MeanAdjustedMaxLength = mean(AdjustedMaxLength, na.rm = TRUE),
MeanAdjustedSD = mean(AvgSD, na.rm = TRUE),
Abundance = length(LengthAdjustment)) %>%
mutate(SE = SD/sqrt(Abundance))
View(larv)
View(larv)
rm(list = ls())
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(raster)
library(PBSmapping)
#library(rgeos)
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
larv = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/Larval Measurements.csv"))
arc = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/ARC Data.csv"))
arc = arc %>% dplyr::select(id, Larvae_Count, Notes)
survey = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv"))
survey = survey %>% mutate(Ground = substr(id,1,2))
larv = left_join(larv, arc, by="id")
larv = left_join(larv, survey)
larv = larv %>% dplyr::select(Ground, id, Date, Survey.No, No_jars, Lengthmm, Condition, Yolk_sac, Preservative, ARC_Count=Larvae_Count, ARC_Notes=Notes, Lon1, Lat1, Lon2, Lat2, TowTime, AvgTowDepth, MaxTowDepth, CTDAvgTemp=AvgTemp, Volume, Month, Year, Day)
larv$Date = dmy(larv$Date)
larv$Survey.No = as.factor(larv$Survey.No)
larv$Year = as.factor(larv$Year)
larv$category =  with(larv, ifelse(larv$Lengthmm < 8 , 1,
ifelse(larv$Lengthmm < 12 & larv$Lengthmm >= 8, 2,
ifelse(larv$Lengthmm >= 12  & larv$Lengthmm < 17, 3,
ifelse(larv$Lengthmm > 17 & larv$Lengthmm < 27, 4, 5)))))
larv$category = as.factor(larv$category)
larv$hatchDate = larv$Date - 10 #incubation duration of 10 days
larv$hatchDate = ymd(larv$hatchDate)
#Calculating spawn dates
larv=larv %>% mutate(MAXspawnDate = ifelse(category == 1, hatchDate-14,
ifelse(category == 2, hatchDate-35,
ifelse(category == 3, hatchDate-56,
ifelse(category == 4, hatchDate-98,
ifelse(category == 5, hatchDate-99, "NA"))))))
larv$MAXspawnDate=as.numeric(larv$MAXspawnDate)
larv$MAXspawnDate=as.Date(larv$MAXspawnDate, origin = "1970-01-01")
larv=larv %>% mutate(MINspawnDate = ifelse(category == 1, hatchDate,
ifelse(category == 2, hatchDate-14,
ifelse(category == 3, hatchDate-35,
ifelse(category == 4, hatchDate-56,
ifelse(category == 5, hatchDate-98, "NA"))))))
larv$MINspawnDate=as.numeric(larv$MINspawnDate)
larv$MINspawnDate=as.Date(larv$MINspawnDate, origin = "1970-01-01")
#add Julian
larv<-larv %>% mutate(Julian = yday(Date))
#Calculating SE/mean/min/max of larval measurements. Changed 'group by' in both larvsummary to (id) from (Ground, Survey.No, Year)
larv <- larv %>%
group_by(Ground, Survey.No, Year) %>%
mutate(SD = sd(Lengthmm), MinLength = min(Lengthmm), MaxLength = max(Lengthmm), MeanLength = mean(Lengthmm), Abundance = length(Lengthmm)) %>%
ungroup()
larvsummary <- larv %>% group_by(id) %>%
summarize(MinLength = mean(MinLength, na.rm = TRUE),
MaxLength = mean(MaxLength, na.rm = TRUE),
MeanLength = mean(MeanLength, na.rm = TRUE),
SD = mean(SD, na.rm = TRUE),
Abundance = length(Lengthmm)) %>%
mutate(SE = SD/sqrt(Abundance))
surveysummary = survey %>% dplyr::select(id, Ground, Survey.No, Year) %>% group_by(id, Ground, Survey.No, Year) %>% summarize(Survey.No = Survey.No, Year = Year)
surveysummary$Year = as.factor(surveysummary$Year)
surveysummary$Survey.No = as.factor(surveysummary$Survey.No)
larvsummary = left_join(surveysummary, larvsummary)
larvsummary %>% write.csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/Larval Summary Table.csv"))
larv = larv %>%
mutate(Larv_per_jar = Abundance/No_jars) %>%
mutate(Volume = ifelse(Volume < 0.01, NA, Volume)) %>%
mutate(Density = Larv_per_jar/Volume)
View(larv)
View(larvsummary)
rm(list = ls())
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(raster)
library(PBSmapping)
#library(rgeos)
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
larv = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/Larval Measurements.csv"))
arc = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/ARC Data.csv"))
arc = arc %>% dplyr::select(id, Larvae_Count, Notes)
survey = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv"))
survey = survey %>% mutate(Ground = substr(id,1,2))
larv = left_join(larv, arc, by="id")
larv = left_join(larv, survey)
larv = larv %>% dplyr::select(Ground, id, Date, Survey.No, No_jars, Lengthmm, Condition, Yolk_sac, Preservative, ARC_Count=Larvae_Count, ARC_Notes=Notes, Lon1, Lat1, Lon2, Lat2, TowTime, AvgTowDepth, MaxTowDepth, CTDAvgTemp=AvgTemp, Volume, Month, Year, Day)
larv$Date = dmy(larv$Date)
larv$Survey.No = as.factor(larv$Survey.No)
larv$Year = as.factor(larv$Year)
larv$category =  with(larv, ifelse(larv$Lengthmm < 8 , 1,
ifelse(larv$Lengthmm < 12 & larv$Lengthmm >= 8, 2,
ifelse(larv$Lengthmm >= 12  & larv$Lengthmm < 17, 3,
ifelse(larv$Lengthmm > 17 & larv$Lengthmm < 27, 4, 5)))))
larv$category = as.factor(larv$category)
larv$hatchDate = larv$Date - 10 #incubation duration of 10 days
larv$hatchDate = ymd(larv$hatchDate)
#Calculating spawn dates
larv=larv %>% mutate(MAXspawnDate = ifelse(category == 1, hatchDate-14,
ifelse(category == 2, hatchDate-35,
ifelse(category == 3, hatchDate-56,
ifelse(category == 4, hatchDate-98,
ifelse(category == 5, hatchDate-99, "NA"))))))
larv$MAXspawnDate=as.numeric(larv$MAXspawnDate)
larv$MAXspawnDate=as.Date(larv$MAXspawnDate, origin = "1970-01-01")
larv=larv %>% mutate(MINspawnDate = ifelse(category == 1, hatchDate,
ifelse(category == 2, hatchDate-14,
ifelse(category == 3, hatchDate-35,
ifelse(category == 4, hatchDate-56,
ifelse(category == 5, hatchDate-98, "NA"))))))
larv$MINspawnDate=as.numeric(larv$MINspawnDate)
larv$MINspawnDate=as.Date(larv$MINspawnDate, origin = "1970-01-01")
#add Julian
larv<-larv %>% mutate(Julian = yday(Date))
#Calculating SE/mean/min/max of larval measurements. Changed 'group by' in both larvsummary to (id) from (Ground, Survey.No, Year)
larv <- larv %>%
group_by(Ground, Survey.No, Year) %>%
mutate(SD = sd(Lengthmm), MinLength = min(Lengthmm), MaxLength = max(Lengthmm), MeanLength = mean(Lengthmm), Abundance = length(Lengthmm)) %>%
ungroup()
larvsummary <- larv %>% group_by(id) %>%
summarize(MinLength = mean(MinLength, na.rm = TRUE),
MaxLength = mean(MaxLength, na.rm = TRUE),
MeanLength = mean(MeanLength, na.rm = TRUE),
SD = mean(SD, na.rm = TRUE),
Abundance = length(Lengthmm)) %>%
mutate(SE = SD/sqrt(Abundance))
surveysummary = survey %>% dplyr::select(id, Ground, Survey.No, Year) %>% group_by(id, Ground, Survey.No, Year) %>% summarize(Survey.No = Survey.No, Year = Year)
surveysummary$Year = as.factor(surveysummary$Year)
surveysummary$Survey.No = as.factor(surveysummary$Survey.No)
larvsummary = left_join(surveysummary, larvsummary)
larvsummary %>% write.csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/Larval Summary Table.csv"))
larv = larv %>%
mutate(Larv_per_jar = Abundance/No_jars) %>%
mutate(Volume = ifelse(Volume < 0.01, NA, Volume)) %>%
mutate(Density = Larv_per_jar/Volume)
#Adds TowID based on date
#larv <- larv %>%
#  group_by(Ground) %>%
#  transform(TowID = as.numeric(factor(Date)))
#Replicate True or False
#Larval1 <- larv %>%
#  group_by(TowID) %>%
#  summarize(TowReplicate = n_distinct(id))
#Larval1$TowReplicate[Larval1$TowReplicate == "1"] <- "False"
#Larval1$TowReplicate[Larval1$TowReplicate == "2"] <- "True"
#larv <- merge(larv, Larval1, by = "TowID")
# if preservative is formalin, apply L  = 0.984 + 0.993 x X1. (X1 = fixed/preserved length therefore Larval$Lengthmm, L = Live length.)
# if preservation is alcohol apply L = 0.532 + 0.989 x X1
#This is taken from Fox 1996 alcohol vs Formalin paper. They did 5% and 5 minute net capture simulation. They did suggest that this adjustment would be less accurate the longer the tow period.
# These equations are when the maximum shrinkage has occured.
larv$LengthAdjustment = with(larv, ifelse(larv$Preservative == "4% formalin", (0.984 + 0.993* larv$Lengthmm),
ifelse(larv$Preservative == "70% alcohol", (0.532 + 0.989*larv$Lengthmm),
ifelse(larv$Preservative == "Unknown", NA,
ifelse(larv$Preservative == "70% Alcohol (1) 4% Formalin (1)", NA, NA)))))
# Changed all NAs to 0 to ensure that they stay within the dataframe. Will change back to NA at the end of the process as none of the values can be 0.
larv[is.na(larv)] <- 0
0 <- larv[is.na(larv)]
larv[is.na(larv)] <- 0
# Changed all NAs to 0 to ensure that they stay within the dataframe. Will change back to NA at the end of the process as none of the values can be 0.
larv$Condition <- as.character(larv$Condition)
larv[is.na(larv)] <- 0
larv$LengthAdjustment = with(larv, ifelse(larv$Preservative == "4% formalin", (0.984 + 0.993* larv$Lengthmm),
ifelse(larv$Preservative == "70% alcohol", (0.532 + 0.989*larv$Lengthmm))))
larv$LengthAdjustment = with(larv, ifelse(larv$Preservative == "4% formalin", (0.984 + 0.993* larv$Lengthmm),
ifelse(larv$Preservative == "70% alcohol", (0.532 + 0.989*larv$Lengthmm),
ifelse(larv$Preservative == "Unknown", NA))))
larv$LengthAdjustment = with(larv, ifelse(larv$Preservative == "4% formalin", (0.984 + 0.993* larv$Lengthmm),
ifelse(larv$Preservative == "70% alcohol", (0.532 + 0.989*larv$Lengthmm),
ifelse(larv$Preservative == "Unknown", NA,
ifelse(larv$Preservative == "70% Alcohol (1) 4% Formalin (1)", NA, NA)))))
larv$LengthAdjustment = with(larv, ifelse(larv$Preservative == "4% formalin", (0.984 + 0.993* larv$Lengthmm),
ifelse(larv$Preservative == "70% alcohol", (0.532 + 0.989*larv$Lengthmm),NA)))
# Changed all NAs to 0 to ensure that they stay within the dataframe. Will change back to NA at the end of the process as none of the values can be 0.
larv[is.na(larv)] <- 0
View(larv)
# Changed all NAs to 0 to ensure that they stay within the dataframe. Will change back to NA at the end of the process as none of the values can be 0.
larv = subset(larv, select = -c(Condition))
larv[is.na(larv)] <- 0
# Changed all NAs to 0 to ensure that they stay within the dataframe. Will change back to NA at the end of the process as none of the values can be 0.
larv = subset(larv, select = -c(Condition, Yolk_sac))
larv[is.na(larv)] <- 0
larv$LengthAdjustment = with(larv, ifelse(larv$Preservative == "4% formalin", (0.984 + 0.993* larv$Lengthmm),
ifelse(larv$Preservative == "70% alcohol", (0.532 + 0.989*larv$Lengthmm),NA)))
# Changed all NAs to 0 to ensure that they stay within the dataframe. Will change back to NA at the end of the process as none of the values can be 0.
larv = subset(larv, select = -c(Condition, Yolk_sac))
MeanLengthAdjustment <- aggregate(LengthAdjustment~id, larv, mean)
colnames(MeanLengthAdjustment)[2]<- "MeanLengthAdjustment"
MeanLengthAdjustment <- aggregate(LengthAdjustment~id, larv, mean)
colnames(MeanLengthAdjustment)[2]<- "MeanLengthAdjustment"
larv$AdjustedAgeInDays <- ((larv$LengthAdjustment - 5)/0.24)
larv <- merge(larv, MeanLengthAdjustment)
larv$AdjustedSpawnDate <- larv$Date-larv$AdjustedAgeInDays
AdjustedMeanAgeInDays <- aggregate(AdjustedAgeInDays~id, larv, mean)
colnames(AdjustedMeanAgeInDays)[2]<- "AdjustedMeanAgeInDays"
AdjustedMinDateOfSpawn <- aggregate(AdjustedSpawnDate~id, larv, min)
colnames(AdjustedMinDateOfSpawn)[2] <- "AdjustedMinDateOfSpawn"
AdjustedMaxDateOfSpawn <- aggregate(AdjustedSpawnDate~id, larv, max)
colnames(AdjustedMaxDateOfSpawn)[2] <- "AdjustedMaxDateOfSpawn"
AdjustedDays <- merge(AdjustedMaxDateOfSpawn, AdjustedMinDateOfSpawn, by = 'id')
AdjustedDays <- merge(AdjustedDays, AdjustedMeanAgeInDays, by = 'id')
larv <- merge(larv, AdjustedDays, by = 'id')
rm(list = ls())
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(raster)
library(PBSmapping)
#library(rgeos)
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
larv = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/Larval Measurements.csv"))
arc = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/ARC Data.csv"))
arc = arc %>% dplyr::select(id, Larvae_Count, Notes)
survey = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv"))
survey = survey %>% mutate(Ground = substr(id,1,2))
larv = left_join(larv, arc, by="id")
larv = left_join(larv, survey)
larv = larv %>% dplyr::select(Ground, id, Date, Survey.No, No_jars, Lengthmm, Condition, Yolk_sac, Preservative, ARC_Count=Larvae_Count, ARC_Notes=Notes, Lon1, Lat1, Lon2, Lat2, TowTime, AvgTowDepth, MaxTowDepth, CTDAvgTemp=AvgTemp, Volume, Month, Year, Day)
larv$Date = dmy(larv$Date)
larv$Survey.No = as.factor(larv$Survey.No)
larv$Year = as.factor(larv$Year)
larv$category =  with(larv, ifelse(larv$Lengthmm < 8 , 1,
ifelse(larv$Lengthmm < 12 & larv$Lengthmm >= 8, 2,
ifelse(larv$Lengthmm >= 12  & larv$Lengthmm < 17, 3,
ifelse(larv$Lengthmm > 17 & larv$Lengthmm < 27, 4, 5)))))
larv$category = as.factor(larv$category)
larv$hatchDate = larv$Date - 10 #incubation duration of 10 days
larv$hatchDate = ymd(larv$hatchDate)
#Calculating spawn dates
larv=larv %>% mutate(MAXspawnDate = ifelse(category == 1, hatchDate-14,
ifelse(category == 2, hatchDate-35,
ifelse(category == 3, hatchDate-56,
ifelse(category == 4, hatchDate-98,
ifelse(category == 5, hatchDate-99, "NA"))))))
larv$MAXspawnDate=as.numeric(larv$MAXspawnDate)
larv$MAXspawnDate=as.Date(larv$MAXspawnDate, origin = "1970-01-01")
larv=larv %>% mutate(MINspawnDate = ifelse(category == 1, hatchDate,
ifelse(category == 2, hatchDate-14,
ifelse(category == 3, hatchDate-35,
ifelse(category == 4, hatchDate-56,
ifelse(category == 5, hatchDate-98, "NA"))))))
larv$MINspawnDate=as.numeric(larv$MINspawnDate)
larv$MINspawnDate=as.Date(larv$MINspawnDate, origin = "1970-01-01")
#add Julian
larv<-larv %>% mutate(Julian = yday(Date))
#Calculating SE/mean/min/max of larval measurements. Changed 'group by' in both larvsummary to (id) from (Ground, Survey.No, Year)
larv <- larv %>%
group_by(Ground, Survey.No, Year) %>%
mutate(SD = sd(Lengthmm), MinLength = min(Lengthmm), MaxLength = max(Lengthmm), MeanLength = mean(Lengthmm), Abundance = length(Lengthmm)) %>%
ungroup()
larvsummary <- larv %>% group_by(id) %>%
summarize(MinLength = mean(MinLength, na.rm = TRUE),
MaxLength = mean(MaxLength, na.rm = TRUE),
MeanLength = mean(MeanLength, na.rm = TRUE),
SD = mean(SD, na.rm = TRUE),
Abundance = length(Lengthmm)) %>%
mutate(SE = SD/sqrt(Abundance))
surveysummary = survey %>% dplyr::select(id, Ground, Survey.No, Year) %>% group_by(id, Ground, Survey.No, Year) %>% summarize(Survey.No = Survey.No, Year = Year)
surveysummary$Year = as.factor(surveysummary$Year)
surveysummary$Survey.No = as.factor(surveysummary$Survey.No)
larvsummary = left_join(surveysummary, larvsummary)
larvsummary %>% write.csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/Larval Summary Table.csv"))
larv = larv %>%
mutate(Larv_per_jar = Abundance/No_jars) %>%
mutate(Volume = ifelse(Volume < 0.01, NA, Volume)) %>%
mutate(Density = Larv_per_jar/Volume)
#Adds TowID based on date
#larv <- larv %>%
#  group_by(Ground) %>%
#  transform(TowID = as.numeric(factor(Date)))
#Replicate True or False
#Larval1 <- larv %>%
#  group_by(TowID) %>%
#  summarize(TowReplicate = n_distinct(id))
#Larval1$TowReplicate[Larval1$TowReplicate == "1"] <- "False"
#Larval1$TowReplicate[Larval1$TowReplicate == "2"] <- "True"
#larv <- merge(larv, Larval1, by = "TowID")
# if preservative is formalin, apply L  = 0.984 + 0.993 x X1. (X1 = fixed/preserved length therefore Larval$Lengthmm, L = Live length.)
# if preservation is alcohol apply L = 0.532 + 0.989 x X1
#This is taken from Fox 1996 alcohol vs Formalin paper. They did 5% and 5 minute net capture simulation. They did suggest that this adjustment would be less accurate the longer the tow period.
# These equations are when the maximum shrinkage has occurred.
larv$LengthAdjustment = with(larv, ifelse(larv$Preservative == "4% formalin", (0.984 + 0.993* larv$Lengthmm),
ifelse(larv$Preservative == "70% alcohol", (0.532 + 0.989*larv$Lengthmm),NA)))
# Changed all NAs to 0 to ensure that they stay within the dataframe. Will change back to NA at the end of the process as none of the values can be 0.
#larv[is.na(larv)] <- 0
MeanLengthAdjustment <- aggregate(LengthAdjustment~id, larv, mean)
colnames(MeanLengthAdjustment)[2]<- "MeanLengthAdjustment"
#'Exact' spawn date. Growth rate of .24mm/day based on Chenoweth 1989 paper.
# Paper says applies estimate growth rates to calculate the number of days back to 5mm. Took 5mm off total length to account for this.
# Assumes hatching length is 5mm, day of hatching = day 0
larv$AdjustedAgeInDays <- ((larv$LengthAdjustment - 5)/0.24)
larv <- merge(larv, MeanLengthAdjustment)
larv$AdjustedSpawnDate <- larv$Date-larv$AdjustedAgeInDays
AdjustedMeanAgeInDays <- aggregate(AdjustedAgeInDays~id, larv, mean)
colnames(AdjustedMeanAgeInDays)[2]<- "AdjustedMeanAgeInDays"
AdjustedMinDateOfSpawn <- aggregate(AdjustedSpawnDate~id, larv, min)
colnames(AdjustedMinDateOfSpawn)[2] <- "AdjustedMinDateOfSpawn"
AdjustedMaxDateOfSpawn <- aggregate(AdjustedSpawnDate~id, larv, max)
colnames(AdjustedMaxDateOfSpawn)[2] <- "AdjustedMaxDateOfSpawn"
AdjustedDays <- merge(AdjustedMaxDateOfSpawn, AdjustedMinDateOfSpawn, by = 'id')
AdjustedDays <- merge(AdjustedDays, AdjustedMeanAgeInDays, by = 'id')
larv <- merge(larv, AdjustedDays, by = 'id')
