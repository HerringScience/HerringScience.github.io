ggtitle(paste("Growth applied to compare spawning modes.")) +
labs(y="Count", x="Growth Rate Applied Length (mm)"))
cat("\n")
print(ggplot(data=Larval1, (aes(JulianMax, JulianMin, colour = category))) +
geom_point(alpha = 0.45, size = 5) +
ggtitle(paste("Growth applied to compare spawning modes.")) +
labs(x = "Max Estimated Julian Date", y= "Min Estimated Julian Date"))
cat("\n")
}
Larval = Larval %>% filter(Ground == "GB")
Larval %>% ggplot(aes(y=Lengthmm, x=Julian, colour = Year)) +
geom_point() +
labs(y="Length (mm)", x="Julian Date of Collection")
ggplot(Larval, aes(Year, Lengthmm, colour = Year)) +
geom_boxplot() +
labs(y="Length (mm)")
Table = Larval %>%
group_by(Year) %>%
summarize(MinLength = min(Lengthmm),
MaxLength = max(Lengthmm),
AvgLength = mean(Lengthmm),
AvgSD = mean(SD),
Abundance = n()) %>%
mutate_if(is.numeric, format, digits=2)
kbl(Table, col.names=c("Year", "Min Length (mm)", "Max Length (mm)", "Mean Length (mm)", "+/- SD (mm)", "Abundance"), align = "c") %>%
kable_paper("striped", full_width = F)
for(i in unique(Larval$Year)) {
cat("\n")
cat("#####", i, "\n")
cat("\n")
Larval1 = Larval %>% filter(Year == i)
print(ggplot(data = Larval1, (aes(Lengthmm))) +
geom_histogram(binwidth=0.5, colour = "white") +
theme(panel.background = element_rect(fill = "white", colour = "grey50")) +
labs(x = "Length (mm)", y="Count"))
cat("\n")
print(ggplot(data=Larval1, aes(Lengthmm, colour = Survey.No)) +
geom_freqpoly(bins=100, linewidth = 1) +
labs(y="Count", x="Length (mm)"))
cat("\n")
Table = Larval1 %>%
group_by(Survey.No) %>%
summarize(AvgLength = mean(Lengthmm),
AvgSD = mean(SD),
Abundance = n()) %>%
mutate_if(is.numeric, format, digits=2)
print(kbl(Table, col.names=c("Survey #", "Mean Length (mm)", "+/- SD (mm)", "Abundance"), align = "c") %>%
kable_paper("striped", full_width = F))
cat("\n")
}
ggplot(Larval, aes(Julian, Lengthmm, colour = Year)) +
geom_jitter(size = 2) +
geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  +
geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  +
geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") +
geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
labs(x= "Julian Date of Collection", y = "Length (mm)")
TotalCategories <- Larval %>%
group_by(category) %>%
dplyr::summarize(n = n()) %>%
mutate(Percentage = (n/sum(n))*100) %>%
mutate_if(is.numeric, format, digits = 1) %>%
mutate(Length = ifelse(category==1, "<8",
ifelse(category==2, "8-12",
ifelse(category==3, "12-17",
ifelse(category==4, "17-27",
ifelse(category==5, ">27", NA)))))) %>%
relocate(Length, .after = category)
kbl(TotalCategories, col.names=c("Category", "Length (mm)", "Abundance", "%"), align = "c") %>%
kable_paper("striped", full_width = F)
for(i in unique(Larval$Year)) {
cat("\n")
cat("#####", i, "\n")
cat("\n")
Larval1 = Larval %>% filter(Year == i)
print(ggplot(Larval1, aes(Julian, Lengthmm)) +
geom_jitter(size = 2) +
geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  +
geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  +
geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") +
geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
labs(x= "Julian Date of Collection", y = "Length (mm)"))
cat("\n")
TotalCategories <- Larval1 %>%
group_by(category) %>%
dplyr::summarize(n = n()) %>%
mutate(Percentage = (n/sum(n))*100) %>%
mutate_if(is.numeric, format, digits = 1)
print(kbl(TotalCategories, col.names=c("Category", "Abundance", "%"), align = "c") %>%
kable_paper("striped", full_width = F))
cat("\n")
}
CP <- as(extent(-66.5, -65.5, 43, 44), "SpatialPolygons") #set boundaries for German Bank before plotting
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)
Larval2 <- subset(Larval, Ground == 'GB')
ggplot(Larval2, aes(x=X, y=Y)) +
geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
geom_polygon(data=polyGB,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
geom_polygon(data=GBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
geom_polygon(data=polySI,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
geom_point(data=Larval2, aes(fill = Year, size = Abundance), pch=21, alpha = 0.6) +
labs(x=NULL, y=NULL) +
coord_map()
TotalCategories <- Larval2 %>%
group_by(category) %>%
dplyr::summarize(n = n()) %>%
mutate(Percentage = (n/sum(n))*100) %>%
mutate_if(is.numeric, format, digits = 1) %>%
mutate(Length = ifelse(category==1, "<8",
ifelse(category==2, "8-12",
ifelse(category==3, "12-17",
ifelse(category==4, "17-27",
ifelse(category==5, ">27", NA)))))) %>%
relocate(Length, .after = category)
kbl(TotalCategories, col.names=c("Category", "Length (mm)", "Abundance", "%"), align = "c") %>%
kable_paper("striped", full_width = F)
for(i in unique(Larval$Year)) {
cat("\n")
cat("#####", i, "\n")
cat("\n")
Larval1 = Larval %>% filter(Year == i) %>% filter()
print(ggplot(Larval1, aes(x=X, y=Y)) +
geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
geom_polygon(data=GBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
geom_polygon(data=polyGB,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
geom_polygon(data=polySI,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
geom_point(data=Larval1, aes(fill = category, size = Abundance), pch=21, alpha = 0.6) +
labs(x=NULL, y=NULL) +
coord_map())
cat("\n")
TotalCategories <- Larval1 %>%
group_by(category) %>%
dplyr::summarize(n = n()) %>%
mutate(Percentage = (n/sum(n))*100) %>%
mutate_if(is.numeric, format, digits = 1)
print(kbl(TotalCategories, col.names=c("Category", "Abundance", "%"), align = "c") %>%
kable_paper("striped", full_width = F))
cat("\n")
}
library(rlang)
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(sp)
library(raster)
library(PBSmapping)
#library(rgeos) - replaced by terra and sf
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
library(readxl)
library(hms)
library(measurements)
library(ggplot2)
library(maps)
library(dplyr)
library(RColorBrewer)
library(AICcmodavg)
library(datasets)
library(terra)
library(multcompView)
library(sf)
library(zoo)
library(ggrepel)
###remove everything in environment
rm(list = ls())
options(scipen = 999)
setwd("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Tracey's Folder")
Survey_Factors <- read_csv("surveyFactorsAll_Tracey with SSB data.csv")
Survey_Data <- read_csv("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv")
#Scots Bay 3 year rolling averages
TotalBiomass <- subset(Survey_Factors, select = c("id", "Year","Ground", "DFO_Estimate", "Survey_Date", "DFO_Turnover_Adjusted"))
TotalBiomass <- na.omit(TotalBiomass)
TotalBiomass <- subset(TotalBiomass, Survey_Date < '2023-05-22')
ScotsBayTotalBiomass <- subset(TotalBiomass, Ground == "SB")
ScotsBayTotalBiomass <- ScotsBayTotalBiomass %>% group_by(Year) %>% add_count(Year)
aggregateSB <- aggregate(ScotsBayTotalBiomass$DFO_Turnover_Adjusted, list(ScotsBayTotalBiomass$Year), FUN=(sum))
colnames(aggregateSB)<-c("Year", "DFO_Turnover_Adjusted")
PeakBiomass <- subset(Survey_Factors, select = c("Survey_Date", "Year","Ground", "DFO_Estimate", "DFO_Turnover_Adjusted"))
PeakBiomass <- na.omit(PeakBiomass)
PeakBiomass <- subset(PeakBiomass, Survey_Date < '2023-05-22')
ScotsBayPeakBiomass <- subset(PeakBiomass, Ground == "SB")
ScotsBayPeakBiomass <- ScotsBayPeakBiomass %>% group_by(Year) %>% slice_max(DFO_Turnover_Adjusted)
ThreeYearRollingBiomass <- aggregateSB %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
ThreeYearRollingBiomassGraph <- print(ggplot(ThreeYearRollingBiomass, aes(x=Year, y=avg_biomass3)) +
geom_point() +
geom_line())
ScotsBayPeakBiomass <- ScotsBayPeakBiomass %>% select(Year, DFO_Turnover_Adjusted)
ScotsBayPeakBiomass <- ungroup(ScotsBayPeakBiomass)
ThreeYearRollingPeak <- ScotsBayPeakBiomass %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
ThreeYearRollingPeakGraph <- print(ggplot(ThreeYearRollingPeak, aes(x=Year, y=avg_biomass3)) +
geom_point()+
geom_line())
View(ScotsBayPeakBiomass)
View(ScotsBayTotalBiomass)
View(aggregateSB)
TotalBiomass <- subset(Survey_Factors, select = c("id", "Year","Ground", "DFO_Estimate", "Survey_Date"))
TotalBiomass <- na.omit(TotalBiomass)
TotalBiomass <- subset(TotalBiomass, Survey_Date < '2023-05-22')
GermanBankTotalBiomass <- subset(TotalBiomass, Ground == "GB")
GermanBankTotalBiomass <- GermanBankTotalBiomass %>% group_by(Year) %>% add_count(Year)
aggregateGB <- aggregate(GermanBankTotalBiomass$DFO_Estimate, list(GermanBankTotalBiomass$Year), FUN=(sum))
colnames(aggregateGB)<-c("Year", "DFO_Estimate")
GBTotalBiomass <- print(ggplot(aggregateGB, aes(x=Year, y=DFO_Estimate, col = "Yearly Total Biomass")) +
geom_point(aes(size = 2)) +
geom_line()+
labs(x = "Year", y= "Total Biomass (mt)"))
PeakBiomass <- subset(Survey_Factors, select = c("Survey_Date", "Year","Ground", "DFO_Estimate"))
PeakBiomass <- na.omit(PeakBiomass)
PeakBiomass <- subset(PeakBiomass, Survey_Date < '2023-05-22')
GermanBankPeakBiomass <- subset(PeakBiomass, Ground == "GB")
GermanBankPeakBiomass <- GermanBankPeakBiomass %>% group_by(Year) %>% slice_max(DFO_Estimate)
GermanBankPeakBiomassGraph2 <- ggplot(GermanBankPeakBiomass, aes(x=Year, y=DFO_Estimate, col = "Yearly Peak Biomass")) +
geom_point()+
geom_line()
labs(x="Year", y="Peak Biomass (mt)")
GermanBankPeakBiomassPointGraph <- ggplot(GermanBankPeakBiomass, aes(x=Year, y=DFO_Estimate)) +
geom_point() +
geom_line()+
legend(2000, 500000, legend= c("German Bank Peak Biomass"))
CombinedPlot <- merge(aggregateGB, GermanBankPeakBiomass, by="Year" )
CombinedPlot2 <- print(ggplot(CombinedPlot, aes(x=Year)) +
geom_line(aes(y=DFO_Estimate.x, color = "German Bank Total Yearly Biomass")) +
geom_line(aes(y=DFO_Estimate.y, color = "German Bank Peak Biomass")) +
labs(x = "Year", y = "Total Biomass (mt)"))
View(GermanBankPeakBiomass)
###remove everything in environment
rm(list = ls())
options(scipen = 999)
setwd("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Tracey's Folder")
Survey_Factors <- read_csv("surveyFactorsAll_Tracey with SSB data.csv")
Survey_Data <- read_csv("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv")
#German Bank 3 year rolling averages
TotalBiomass <- subset(Survey_Factors, select = c("id", "Year","Ground", "DFO_Estimate", "Survey_Date", "DFO_Turnover_Adjusted"))
TotalBiomass <- na.omit(TotalBiomass)
TotalBiomass <- subset(TotalBiomass, Survey_Date < '2023-05-22')
GermanBankTotalBiomass <- subset(TotalBiomass, Ground == "GB")
GermanBankTotalBiomass <- GermanBankTotalBiomass %>% group_by(Year) %>% add_count(Year)
aggregateGB <- aggregate(GermanBankTotalBiomass$DFO_Turnover_Adjusted, list(GermanBankTotalBiomass$Year), FUN=(sum))
colnames(aggregateGB)<-c("Year", "DFO_Turnover_Adjusted")
PeakBiomass <- subset(Survey_Factors, select = c("Survey_Date", "Year","Ground", "DFO_Estimate", "DFO_Turnover_Adjusted"))
PeakBiomass <- na.omit(PeakBiomass)
PeakBiomass <- subset(PeakBiomass, Survey_Date < '2023-05-22')
GermanBankPeakBiomass <- subset(PeakBiomass, Ground == "GB")
GermanBankPeakBiomass <- GermanBankPeakBiomass %>% group_by(Year) %>% slice_max(DFO_Turnover_Adjusted)
ThreeYearRollingBiomass <- aggregateGB %>%
arrange(Year) %>%
group_by(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
ThreeYearRollingBiomassGraph <- print(ggplot(ThreeYearRollingBiomass, aes(x=Year, y=DFO_Turnover_Adjusted)) +
geom_point() +
geom_line())
ThreeYearRollingPeak <- GermanBankPeakBiomass %>%
arrange(Year) %>%
group_by(Year) %>%
mutate(avg_biomass3 =rollmean(DFO_Turnover_Adjusted, k=3, fill = NA, align = 'right'))
ThreeYearRollingPeakGraph <- print(ggplot(ThreeYearRollingPeak, aes(x=Year, y=avg_biomass3)) +
geom_point()+
geom_line())
GermanBankPeakBiomass <- GermanBankPeakBiomass %>% select(Year, DFO_Turnover_Adjusted)
GermanBankPeakBiomass <- GermanBankPeakBiomass %>% select(Year, DFO_Turnover_Adjusted)
GermanBankPeakBiomass <- ungroup(GermanBankPeakBiomass)
ThreeYearRollingPeak <- GermanBankPeakBiomass %>%
arrange(Year) %>%
group_by(Year) %>%
mutate(avg_biomass3 =rollmean(DFO_Turnover_Adjusted, k=3, fill = NA, align = 'right'))
ThreeYearRollingPeakGraph <- print(ggplot(ThreeYearRollingPeak, aes(x=Year, y=avg_biomass3)) +
geom_point()+
geom_line())
View(ThreeYearRollingBiomass)
GermanBankPeakBiomass <- ungroup(GermanBankPeakBiomass)
ThreeYearRollingPeak <- GermanBankPeakBiomass %>%
arrange(Year) %>%
group_by(Year) %>%
mutate(avg_biomass3 =rollmean(DFO_Turnover_Adjusted, k=3, fill = NA, align = 'right'))
View(ThreeYearRollingPeak)
str(ThreeYearRollingPeak)
View(GermanBankPeakBiomass)
GermanBankPeakBiomass <- GermanBankPeakBiomass %>% select(Year, DFO_Turnover_Adjusted)
GermanBankPeakBiomass <- ungroup(GermanBankPeakBiomass)
str(GermanBankPeakBiomass)
ThreeYearRollingPeak <- GermanBankPeakBiomass %>%
arrange(Year) %>%
group_by(Year) %>%
mutate(avg_biomass3 =rollmean(DFO_Turnover_Adjusted, k=3, fill = NA, align = 'right'))
ThreeYearRollingPeakGraph <- print(ggplot(ThreeYearRollingPeak, aes(x=Year, y=avg_biomass3)) +
geom_point()+
geom_line())
View(ThreeYearRollingPeak)
#Scots Bay 3 year rolling averages
TotalBiomass <- subset(Survey_Factors, select = c("id", "Year","Ground", "DFO_Estimate", "Survey_Date", "DFO_Turnover_Adjusted"))
TotalBiomass <- na.omit(TotalBiomass)
TotalBiomass <- subset(TotalBiomass, Survey_Date < '2023-05-22')
ScotsBayTotalBiomass <- subset(TotalBiomass, Ground == "SB")
ScotsBayTotalBiomass <- ScotsBayTotalBiomass %>% group_by(Year) %>% add_count(Year)
aggregateSB <- aggregate(ScotsBayTotalBiomass$DFO_Turnover_Adjusted, list(ScotsBayTotalBiomass$Year), FUN=(sum))
colnames(aggregateSB)<-c("Year", "DFO_Turnover_Adjusted")
PeakBiomass <- subset(Survey_Factors, select = c("Survey_Date", "Year","Ground", "DFO_Estimate", "DFO_Turnover_Adjusted"))
PeakBiomass <- na.omit(PeakBiomass)
PeakBiomass <- subset(PeakBiomass, Survey_Date < '2023-05-22')
ScotsBayPeakBiomass <- subset(PeakBiomass, Ground == "SB")
ScotsBayPeakBiomass <- ScotsBayPeakBiomass %>% group_by(Year) %>% slice_max(DFO_Turnover_Adjusted)
ThreeYearRollingBiomass <- aggregateSB %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
ThreeYearRollingBiomassGraph <- print(ggplot(ThreeYearRollingBiomass, aes(x=Year, y=avg_biomass3)) +
geom_point() +
geom_line())
ScotsBayPeakBiomass <- ScotsBayPeakBiomass %>% select(Year, DFO_Turnover_Adjusted)
ScotsBayPeakBiomass <- ungroup(ScotsBayPeakBiomass)
ThreeYearRollingPeak <- ScotsBayPeakBiomass %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
ThreeYearRollingPeakGraph <- print(ggplot(ThreeYearRollingPeak, aes(x=Year, y=avg_biomass3)) +
geom_point()+
geom_line())
ThreeYearRollingPeak <- GermanBankPeakBiomass %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
TotalBiomass <- subset(Survey_Factors, select = c("id", "Year","Ground", "DFO_Estimate", "Survey_Date", "DFO_Turnover_Adjusted"))
TotalBiomass <- na.omit(TotalBiomass)
TotalBiomass <- subset(TotalBiomass, Survey_Date < '2023-05-22')
GermanBankTotalBiomass <- subset(TotalBiomass, Ground == "GB")
GermanBankTotalBiomass <- GermanBankTotalBiomass %>% group_by(Year) %>% add_count(Year)
aggregateGB <- aggregate(GermanBankTotalBiomass$DFO_Turnover_Adjusted, list(GermanBankTotalBiomass$Year), FUN=(sum))
colnames(aggregateGB)<-c("Year", "DFO_Turnover_Adjusted")
PeakBiomass <- subset(Survey_Factors, select = c("Survey_Date", "Year","Ground", "DFO_Estimate", "DFO_Turnover_Adjusted"))
PeakBiomass <- na.omit(PeakBiomass)
PeakBiomass <- subset(PeakBiomass, Survey_Date < '2023-05-22')
GermanBankPeakBiomass <- subset(PeakBiomass, Ground == "GB")
GermanBankPeakBiomass <- GermanBankPeakBiomass %>% group_by(Year) %>% slice_max(DFO_Turnover_Adjusted)
ThreeYearRollingBiomass <- aggregateGB %>%
arrange(Year) %>%
group_by(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
ThreeYearRollingBiomassGraph <- print(ggplot(ThreeYearRollingBiomass, aes(x=Year, y=DFO_Turnover_Adjusted)) +
geom_point() +
geom_line())
GermanBankPeakBiomass <- GermanBankPeakBiomass %>% select(Year, DFO_Turnover_Adjusted)
GermanBankPeakBiomass <- ungroup(GermanBankPeakBiomass)
ThreeYearRollingPeak <- GermanBankPeakBiomass %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
ThreeYearRollingPeakGraph <- print(ggplot(ThreeYearRollingPeak, aes(x=Year, y=avg_biomass3)) +
geom_point()+
geom_line())
CombinedPlot3 <- merge(ThreeYearRollingBiomass, ThreeYearRollingPeak, by="Year")
CombinedPlot4 <- print(ggplot(CombinedPlot3, aes(x=Year))+
geom_line(aes(y=avg_biomass3.x, colour = "German Bank Three Year rolling Average Yearly Biomass")) +
geom_line(aes(y=avg_biomass3.y, colour = "German Bank Three Year rolling Average Peak Biomass")) +
labs(x = "Year", y = "Total Biomass (mt)"))
ThreeYearRollingPeak <- GermanBankPeakBiomass %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
View(ThreeYearRollingPeak)
View(ThreeYearRollingPeak)
ThreeYearRollingPeak <- GermanBankPeakBiomass %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
ThreeYearRollingPeakGraph <- print(ggplot(ThreeYearRollingPeak, aes(x=Year, y=avg_biomass3)) +
geom_point()+
geom_line())
CombinedPlot3 <- merge(ThreeYearRollingBiomass, ThreeYearRollingPeak, by="Year")
CombinedPlot4 <- print(ggplot(CombinedPlot3, aes(x=Year))+
geom_line(aes(y=avg_biomass3.x, colour = "German Bank Three Year rolling Average Yearly Biomass")) +
geom_line(aes(y=avg_biomass3.y, colour = "German Bank Three Year rolling Average Peak Biomass")) +
labs(x = "Year", y = "Total Biomass (mt)"))
ThreeYearRollingPeak <- GermanBankPeakBiomass %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
ThreeYearRollingPeakGraph <- print(ggplot(ThreeYearRollingPeak, aes(x=Year, y=avg_biomass3)) +
geom_point()+
geom_line())
ThreeYearRollingPeak <- GermanBankPeakBiomass %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
ThreeYearRollingPeakGraph <- print(ggplot(ThreeYearRollingPeak, aes(x=Year, y=avg_biomass3)) +
geom_point()+
geom_line())
CombinedPlot3 <- merge(ThreeYearRollingBiomass, ThreeYearRollingPeak, by="Year")
View(CombinedPlot3)
View(ThreeYearRollingBiomass)
ThreeYearRollingBiomass <- aggregateGB %>%
arrange(Year) %>%
group_by(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
View(ThreeYearRollingBiomass)
ThreeYearRollingBiomass <- aggregateGB %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
View(ThreeYearRollingBiomass)
View(GermanBankPeakBiomass)
View(GermanBankTotalBiomass)
View(aggregateGB)
View(ThreeYearRollingBiomass)
###remove everything in environment
rm(list = ls())
options(scipen = 999)
setwd("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Tracey's Folder")
Survey_Factors <- read_csv("surveyFactorsAll_Tracey with SSB data.csv")
Survey_Data <- read_csv("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv")
#German Bank 3 year rolling averages
TotalBiomass <- subset(Survey_Factors, select = c("id", "Year","Ground", "DFO_Estimate", "Survey_Date", "DFO_Turnover_Adjusted"))
TotalBiomass <- na.omit(TotalBiomass)
TotalBiomass <- subset(TotalBiomass, Survey_Date < '2023-05-22')
GermanBankTotalBiomass <- subset(TotalBiomass, Ground == "GB")
GermanBankTotalBiomass <- GermanBankTotalBiomass %>% group_by(Year) %>% add_count(Year)
aggregateGB <- aggregate(GermanBankTotalBiomass$DFO_Turnover_Adjusted, list(GermanBankTotalBiomass$Year), FUN=(sum))
colnames(aggregateGB)<-c("Year", "DFO_Turnover_Adjusted")
PeakBiomass <- subset(Survey_Factors, select = c("Survey_Date", "Year","Ground", "DFO_Estimate", "DFO_Turnover_Adjusted"))
PeakBiomass <- na.omit(PeakBiomass)
PeakBiomass <- subset(PeakBiomass, Survey_Date < '2023-05-22')
GermanBankPeakBiomass <- subset(PeakBiomass, Ground == "GB")
GermanBankPeakBiomass <- GermanBankPeakBiomass %>% group_by(Year) %>% slice_max(DFO_Turnover_Adjusted)
ThreeYearRollingBiomass <- aggregateGB %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
ThreeYearRollingBiomassGraph <- print(ggplot(ThreeYearRollingBiomass, aes(x=Year, y=DFO_Turnover_Adjusted)) +
geom_point() +
geom_line())
GermanBankPeakBiomass <- GermanBankPeakBiomass %>% select(Year, DFO_Turnover_Adjusted)
GermanBankPeakBiomass <- ungroup(GermanBankPeakBiomass)
ThreeYearRollingPeak <- GermanBankPeakBiomass %>%
arrange(Year) %>%
mutate(avg_biomass3 = rollmean(DFO_Turnover_Adjusted, k = 3, fill = NA, align = 'right'))
ThreeYearRollingPeakGraph <- print(ggplot(ThreeYearRollingPeak, aes(x=Year, y=avg_biomass3)) +
geom_point()+
geom_line())
CombinedPlot3 <- merge(ThreeYearRollingBiomass, ThreeYearRollingPeak, by="Year")
CombinedPlot4 <- print(ggplot(CombinedPlot3, aes(x=Year))+
geom_line(aes(y=avg_biomass3.x, colour = "German Bank Three Year rolling Average Yearly Biomass")) +
geom_line(aes(y=avg_biomass3.y, colour = "German Bank Three Year rolling Average Peak Biomass")) +
labs(x = "Year", y = "Total Biomass (mt)"))
library(rlang)
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(sp)
library(raster)
library(PBSmapping)
#library(rgeos) - replaced by terra and sf
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
library(readxl)
library(hms)
library(measurements)
library(ggplot2)
library(maps)
library(dplyr)
library(RColorBrewer)
library(AICcmodavg)
library(datasets)
library(terra)
library(multcompView)
library(sf)
library(zoo)
library(ggrepel)
###remove everything in environment
rm(list = ls())
options(scipen = 999)
setwd("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Tracey's Folder")
Survey_Factors <- read_csv("surveyFactorsAll_Tracey with SSB data.csv")
Survey_Data <- read_csv("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv")
View(Survey_Factors)
Survey_Factors$Julian = as.POSIXlt(Survey_Factors$Survey_Date)$yday
View(Survey_Factors)
###remove everything in environment
rm(list = ls())
options(scipen = 999)
setwd("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Tracey's Folder")
Survey_Factors <- read_csv("surveyFactorsAll_Tracey with SSB data.csv")
Survey_Factors$Julian = as.POSIXlt(Survey_Factors$Survey_Date)$yday
View(Survey_Factors)
JulianAndBiomass <- subset(Survey_Factors, select=c("Survey_Date", "Ground", "Julian", "DFO_Estimate")) +
JulianAndBiomass <- na.omit(JulianAndBiomass)
JulianAndBiomass <- subset(Survey_Factors, select=c("Survey_Date", "Ground", "Julian", "DFO_Estimate")) +
JulianAndBiomass <- na.omit(JulianAndBiomass)
Survey_Data <- read_csv("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv")
JulianAndBiomass <- subset(Survey_Factors, select=c("Survey_Date", "Ground", "Julian", "DFO_Estimate")) +
JulianAndBiomass <- na.omit(JulianAndBiomass)
JulianAndBiomass <- subset(Survey_Factors, select=c("Survey_Date", "Ground", "Julian", "DFO_Estimate"))
JulianAndBiomass <- na.omit(JulianAndBiomass)
JulianAndBiomass<- subset(JulianAndBiomass, Survey_Date < '2023-05-22') #As only one DFO factor for 2023 is in the system, removed to keep years nice.
View(JulianAndBiomass)
