SUA = read.csv("polygon_SB.csv")
polySB_main = as.PolySet(SUA, projection="LL")
#German Bank CTD box
GBCTD=boxes[which(boxes$Box == "GBocean"), ]
# German Bank
SUA = read.csv("polygon_GB.csv")
polyGB = as.PolySet(SUA, projection="LL")
# Seal Island
SUA = read.csv("polygon_SI.csv")
polySI = as.PolySet(SUA, projection="LL")
View(Larval)
for(i in unique(Larval$Date)) {
print(ggplot(data=subset(Larval, Ground == "German Bank" & Date == i), aes (x=id, y= Abundance)) +
geom_point() +
xlab("ID") +
ylab("Abundance"))
for(i in unique(Larval$Date)) {
cat("\n")
cat("##### ", i, "\n")
cat("\n")
print(ggplot(data=subset(Larval, Ground == "German Bank" & Date == i), aes (x=id, y= Abundance)) +
geom_point() +
xlab("ID") +
ylab("Abundance"))
cat("\n")
}
```
for(i in unique(Larval$Date)) {
cat("\n")
cat("##### ", i, "\n")
cat("\n")
print(ggplot(data=subset(Larval, Ground == "German Bank" & Date == i), aes (x=id, y= Abundance)) +
geom_point() +
xlab("ID") +
ylab("Abundance"))
cat("\n")
}
print(ggplot(LarvalSum, aes(Year, Abundance, colour = Survey.No)) +
geom_point() +
geom_label_repel(aes(label = id), size = 3))
#Remove
rm(list = ls())
#Import all packages, CTD data, and land data
#Packages
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/"))
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(raster)
library(PBSmapping)
#library(rgeos)
library(sf)
library(terra)
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
library(DT)
library(dygraphs)
library(leaflet)
library(rmapshaper)
library(plotly)
library(mapproj)
library(oce) #new CTD Data package
library(ggrepel)
#Larval Data
Larval <- read_csv("Full Larval.csv")
Larval$Year <- as.factor(Larval$Year)
Larval$category <- as.factor(Larval$category)
Larval$Survey.No <- as.factor(Larval$Survey.No)
# 0 is NA in these categories to allow for other data to be pulled.
Larval$Volume[is.na(Larval$Volume)] <- 0
Larval$Density[is.na(Larval$Density)] <- 0
Larval$AvgTowDepth[is.na(Larval$AvgTowDepth)] <- 0
Larval$TowTime[is.na(Larval$TowTime)] <- 0
#Plankton Data
Plankton <- read_csv("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Source Data/planktonsamplingData.csv")
Plankton$TowTime[is.na(Plankton$TowTime)] <- 0
#'Exact' spawn date. Growth rate of .24mm/day based on Chenoweth 1989 paper.
# Paper says applies estimate growth rates to calculate the number of days back to 5mm. Took 5mm off total length to account for this.
# Assumes hatching length is 5mm, day of hatching = day 0
Larval$AgeInDays <- ((Larval$Lengthmm - 5)/0.24)
Larval$SpawnDate <- Larval$Date-Larval$AgeInDays
LarvalA <- select(Larval, id, Date, Survey.No, Abundance, Density, Volume, TowTime, AvgTowDepth)
MeanAgeInDays <- aggregate(AgeInDays~id, Larval, mean)
colnames(MeanAgeInDays)[2]<- "MeanAgeInDays"
MinDateOfSpawn <- aggregate(SpawnDate~id, Larval, min)
colnames(MinDateOfSpawn)[2] <- "MinDateOfSpawn"
MaxDateOfSpawn <- aggregate(SpawnDate~id, Larval, max)
colnames(MaxDateOfSpawn)[2] <- "MaxDateOfSpawn"
LarvalB <- merge(MeanAgeInDays, MinDateOfSpawn)
LarvalC <- merge(LarvalB, MaxDateOfSpawn)
LarvalC <- merge(LarvalA, LarvalC)
LarvalC <- unique(LarvalC)
StartLat <- aggregate(Lat1~id, Plankton, mean)
StartLon <- aggregate(Lon1~id, Plankton, mean)
StartCoords <- merge(StartLat, StartLon)
EndLat <- aggregate(Lat2~id, Plankton, mean)
EndLon <- aggregate(Lon2~id, Plankton, mean)
EndCoords <- merge(EndLat, EndLon)
TowCoords <- merge(StartCoords, EndCoords)
LarvalC$Density[is.na(LarvalC$Density)] <- 0
LarvalC$AvgTowDepth[is.na(LarvalC$AvgTowDepth)] <- 0
LarvalC$TowTime[is.na(LarvalC$TowTime)] <- 0
LarvalD <- merge(LarvalC, TowCoords)
#Plankton <- select(Plankton, id, TowTime, AvgTowDepth, Volume)
Plankton <- Plankton %>% drop_na(id)
Plankton$AvgTowDepth[is.na(Plankton$AvgTowDepth)] <- 0
Plankton2 <- select(Plankton, id, TowTime, AvgTowDepth)
Plankton2 <- Plankton2 %>% drop_na(TowTime)
MeanTowTime <- aggregate(TowTime~id, Plankton2, mean)
#Left in because this should update the tow time with means
LarvalE <- merge(LarvalD, MeanTowTime)
Volume <- aggregate(Volume~id, Larval, mean)
LarvalF <- merge(LarvalE, Volume)
LarvalSum <- Larval %>% select("Ground", "Year", "id", "Survey.No", "Abundance", "Density", "Preservative", "TowTime", "MeanLength", "Volume")
LarvalSum <- merge(LarvalSum, LarvalF)
LarvalSum <- unique(LarvalSum)
LarvalSum[LarvalSum == 0] <- NA
write.csv(LarvalSum,"C:/Users/herri/Documents/GitHub/HerringScience.github.io//Main Data/LarvalSum.csv" )
# Abundance by Year, differentiating Survey Numbers. Need to separate by Ground
print(ggplot(LarvalSum, aes(Year, Abundance, colour = Survey.No)) +
geom_point() +
geom_label_repel(aes(label = id), size = 3))
print(ggplot(LarvalSum, aes(Year, Density, colour = Survey.No)) +
geom_point())
print(ggplot(LarvalSum, aes(Year, MeanLength, colour = Survey.No)) +
geom_point())
print(ggplot(LarvalSum, aes(Year, MeanAgeInDays, colour = Survey.No)) +
geom_point())
print(ggplot(LarvalSum, aes(Year, Abundance, colour = Survey.No)) +
geom_point())
print(ggplot(data=subset(Larval, Ground == "German Bank" & Date == i), aes (x=id, y= Count)) +
geom_point() +
xlab("ID") +
ylab("Abundance"))
for(i in unique(Larval$Date)) {
cat("\n")
cat("##### ", i, "\n")
cat("\n")
print(ggplot(data=subset(Larval, Ground == "German Bank" & Date == i), aes (x=id, y= Count)) +
geom_point() +
xlab("ID") +
ylab("Abundance"))
cat("\n")
}
View(Larval)
print(ggplot(data=subset(Larval, Ground == "German Bank" & Date == i), aes (x=id, y= Abundance)) +
geom_point() +
xlab("ID") +
ylab("Abundance"))
Larval <- Larval %>% subset(Ground == "GB")
View(Larval)
print(ggplot(data=subset(Larval, Ground == "German Bank" & Survey.No == i), aes (x=id, y= Abundance)) +
geom_point() +
xlab("ID") +
ylab("Abundance"))
cat("\n")
for(i in unique(Larval$Survey.No)) {
cat("\n")
cat("##### ", i, "\n")
cat("\n")
Larval <- Larval %>% subset(Ground == "GB")
print(ggplot(data=subset(Larval, Ground == "German Bank" & Survey.No == i), aes (x=id, y= Abundance)) +
geom_point() +
xlab("ID") +
ylab("Abundance"))
cat("\n")
}
LarvalGB = Larval %>% filter(Ground == "GB")
View(LarvalGB)
print(ggplot(Larval, aes(x = id, y = Abundance, colour = Date)))
View(LarvalGB)
print(ggplot(Larval, aes(x = id, y = Abundance, colour = Date)) +
geom_point())
View(LarvalGB)
LarvalSB = Larval %>% filter(Ground == "SB")
print(ggplot(Larval, aes(x = id, y = Abundance, colour = Date)) +
geom_point())
print(ggplot(LarvalGB, aes(x = id, y = Abundance, colour = Date)) +
geom_point())
print(ggplot(LarvalSB, aes(x = id, y = Abundance, colour = Date)) +
geom_point())
#Import all packages, CTD data, and land data
rm(list = ls())
#Packages
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/"))
library(ggplot2)
library(patchwork)
library(scales)
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(raster)
library(PBSmapping)
#library(rgeos)
library(sf)
library(terra)
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
library(DT)
library(dygraphs)
library(leaflet)
library(rmapshaper)
library(plotly)
library(mapproj)
library(oce) #new CTD Data package
#Larval Data
Larval = read_csv("Full Larval.csv")
Larval$Date <- lubridate::ymd(Larval$Date)
Larval <- dplyr::arrange(Larval, Date)
Larval$Year <- as.factor(Larval$Year)
Larval$category <- as.factor(Larval$category)
Larval$Survey.No <- as.factor(Larval$Survey.No)
LarvalSI = filter(Larval, Ground == "SI")
LarvalSum = read_csv("LarvalSum.csv")
LarvalSum$Year <- as.factor(LarvalSum$Year)
#Land Data
can<-getData('GADM', country="CAN", level=1)
us = getData('GADM', country = "USA", level = 1)
can1 = rbind(can,us)
NBNS <- can1[can1@data$NAME_1%in%c("New Brunswick","Nova Scotia","Prince Edward Island","Newfoundland and Labrador","QuÃ©bec", "Maine"),]
#Import All Boxes
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Box Coordinates/"))
boxes = read.csv("surveyBoxes.csv")
# Scots Bay plankton and CTD box
SBplankton=boxes[which(boxes$Box == "SBPlanktonBox"), ]
SBCTD=boxes[which(boxes$Box == "SBocean"), ]
# Scots Bay
SUA = read.csv("polygon_SBEastern.csv")
polyEastern = as.PolySet(SUA, projection="LL")
SUA = read.csv("polygon_SBNorthern.csv")
polyNorthern = as.PolySet(SUA, projection="LL")
SUA = read.csv("polygon_SB.csv")
polySB_main = as.PolySet(SUA, projection="LL")
#German Bank CTD box
GBCTD=boxes[which(boxes$Box == "GBocean"), ]
# German Bank
SUA = read.csv("polygon_GB.csv")
polyGB = as.PolySet(SUA, projection="LL")
# Seal Island
SUA = read.csv("polygon_SI.csv")
polySI = as.PolySet(SUA, projection="LL")
LarvalSB = Larval %>% filter(Ground == "SB")
View(LarvalSB)
print(ggplot(LarvalSB, aes(x = id, y = Abundance, colour = Date)) +
geom_point())
LarvalSB = Larval %>% filter(Ground == "SB")
print(ggplot(LarvalSB, aes(x = Date, y = Abundance, colour = id)) +
geom_point())
LarvalSI = Larval %>% filter(Ground == "SI")
print(ggplot(LarvalSI, aes(x = id, y = Abundance, colour = Date)) +
geom_point())
print(ggplot(LarvalSI, aes(x = Date, y = Abundance, colour = id) +
LarvalSI = Larval %>% filter(Ground == "SI")
LarvalSI <- Larval %>% filter(Ground == "SI")
print(ggplot(LarvalSI, aes(x = Date, y = Abundance, colour = id) +
print(ggplot(LarvalSI, aes(x = Date, y = Abundance, colour = id) +
geom_point()))
print(ggplot(LarvalSI, aes(x = Date, y = Abundance, colour = id) +
print(ggplot(LarvalSI, aes(x = Date, y = Abundance, colour = id) +
geom_point()))
(ggplot(LarvalSI, aes(x = Date, y = Abundance, colour = id) +
geom_point()))
rlang::last_trace()
ggplot(LarvalSI, aes(x = Date, y = Abundance, colour = id) +
geom_point())
?length
#(SB ONLY) Set main-box vessels
ids = c("C1", "FM", "LM", "LJ", "SL", "MS", "LB", "BP")
#Area and TS values - From table C
SB1= 661 #SB main area
SB2= 77 #SB north area
SB3= 115 #SB east area
GB1 = 796 #GB main area
GB2 = 272 #Seal Island area
GB3 = NA #Ad-hoc school survey area
##
###
##
#BELOW VALUES SHOULD RARELY CHANGE#
TS1 = -35.5 #TS38
#turnover calculation regression values
GB_y = 0.199392662629964
GB_x_var = 0.528381832773883
GB_days = 31
SB_y = 0.364102758434224
SB_x_var = 0.436969270679439
SB_days = 29
library(rlang)
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(raster)
library(PBSmapping)
#library(rgeos)
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
library(readxl)
library(hms)
library(measurements)
##Survey Data import and filtering
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Surveys/", year, "/", surv, surv.no))
###Abundance code taken from Update Data Script
# IMPORTANT : SET GROUND, YEAR, AND SURVEY # HERE
surv="GB" #SB or GB or SI
surv2="German Bank" #"German Bank", "Seal Island" or "Scots Bay" as written
year="2023"
surv.no="7"
adhoc = "FALSE" #true or false if an adhoc survey was completed (and "adhoc.csv" exists)
Sample = "N" #whether ("Y") or not ("N") they caught fish during this survey window
Tow = "Y" #whether or not plankton tow(s) were conducted
#(SB ONLY) Set main-box vessels
ids = c("C1", "FM", "LM", "LJ", "SL", "MS", "LB", "BP")
#Area and TS values - From table C
SB1= 661 #SB main area
SB2= 77 #SB north area
SB3= 115 #SB east area
GB1 = 796 #GB main area
GB2 = 272 #Seal Island area
GB3 = NA #Ad-hoc school survey area
##
###
##
#BELOW VALUES SHOULD RARELY CHANGE#
TS1 = -35.5 #TS38
#turnover calculation regression values
GB_y = 0.199392662629964
GB_x_var = 0.528381832773883
GB_days = 31
SB_y = 0.364102758434224
SB_x_var = 0.436969270679439
SB_days = 29
library(rlang)
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(raster)
library(PBSmapping)
#library(rgeos)
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
library(readxl)
library(hms)
library(measurements)
##Survey Data import and filtering
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Surveys/", year, "/", surv, surv.no))
Plankton = read_csv("PlanktonData.csv")
Plankton = Plankton %>%
mutate(Year = year,
Ground = surv,
Survey.No = surv.no,
TowTime = difftime(Time2, Time1, units = "mins"))
Plankton$Year = as.numeric(Plankton$Year)
Plankton$Swell = as.character(Plankton$Swell)
if(Sample == "Y"){Plankton$Sample = "Y"}
if(Sample == "N"){Plankton$Sample = "N"}
#get CTD data from Plankton
SurveyData = read_csv("Plan Data.csv")
SurveyData$StartDate = as.Date(SurveyData$Date, format = "%d/%m/%Y")
if(!is.na(first(Plankton$CTD_ID))){
CTDData = read_csv(paste0(Plankton$CTD_ID, ".csv"))
CTDData = CTDData %>%
dplyr::select(Pressure = "Pressure (Decibar)", Depth = "Depth (Meter)", Temperature = "Temperature (Celsius)",	Conductivity = "Conductivity (MicroSiemens per Centimeter)", Specific_conductance = "Specific conductance (MicroSiemens per Centimeter)",
Salinity = "Salinity (Practical Salinity Scale)", Sound_velocity = "Sound velocity (Meters per Second)", Density = "Density (Kilograms per Cubic Meter)")
CTDData = CTDData %>%
mutate(plankton_ID = paste0(first(Plankton$Set_Number), "/", last(Plankton$Set_Number)),
ground = surv2,
id = first(Plankton$CTD_ID),
Date = first(SurveyData$StartDate),
Lat = first(Plankton$CTD_Lat),
Lon = first(Plankton$CTD_Lon),
Year = first(year),
Survey = first(surv.no))
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data"))
CTDRaw = read_csv("CTD_Raw.csv")
CTDData$Year = as.numeric(CTDData$Year)
CTDData$Survey = as.numeric(CTDData$Survey)
CTDTotal = full_join(CTDRaw, CTDData)
Plankton = Plankton %>%
mutate(AvgTemp = mean(CTDData$Temperature),
AvgSalinity = mean(CTDData$Salinity))
}
if(is.na(first(Plankton$CTD_ID))){
Plankton = Plankton %>%
mutate(AvgTemp = NA,
AvgSalinity = NA)
}
#Calculating SE/mean/min/max of larval measurements
larv <- larv %>%
group_by(Survey.No, Year, Date) %>%
mutate(SD = sd(Lengthmm),
MinLength = min(Lengthmm),
MaxLength = max(Lengthmm),
MeanLength = mean(Lengthmm),
Abundance = length(Lengthmm),
X = ((Lon1 + Lon2)/2),
Y = ((Lat1 + Lat2)/2)) %>%
ungroup()
larv = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/Larval Measurements.csv"))
arc = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/ARC Data.csv"))
arc = arc %>% dplyr::select(id, Larvae_Count, Notes)
survey = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv"))
survey = survey %>% mutate(Ground = substr(id,1,2))
larv = left_join(larv, arc, by="id")
larv = left_join(larv, survey)
larv = larv %>% dplyr::select(Ground, id, Date, Survey.No, No_jars, Lengthmm, Condition, Yolk_sac, Yolk_sac_length, Preservative, ARC_Count=Larvae_Count, ARC_Notes=Notes, Lon1, Lat1, Lon2, Lat2, TowTime, AvgTowDepth, MaxTowDepth, CTDAvgTemp=AvgTemp, CTDAvgSalinity=AvgSalinity, Volume, Month, Year, Day)
larv$Date = dmy(larv$Date)
larv$Survey.No = as.factor(larv$Survey.No)
larv$Year = as.factor(larv$Year)
larv$category =  with(larv, ifelse(larv$Lengthmm < 8 , 1,
ifelse(larv$Lengthmm < 13 & larv$Lengthmm >= 8, 2,
ifelse(larv$Lengthmm >= 13  & larv$Lengthmm < 18, 3,
ifelse(larv$Lengthmm > 17 & larv$Lengthmm <= 27, 4, 5)))))
larv$category = as.factor(larv$category)
larv$hatchDate = larv$Date - 10 #incubation duration of 10 days
larv$hatchDate = ymd(larv$hatchDate)
#Calculating SE/mean/min/max of larval measurements
larv <- larv %>%
group_by(Survey.No, Year, Date) %>%
mutate(SD = sd(Lengthmm),
MinLength = min(Lengthmm),
MaxLength = max(Lengthmm),
MeanLength = mean(Lengthmm),
Abundance = length(Lengthmm),
X = ((Lon1 + Lon2)/2),
Y = ((Lat1 + Lat2)/2)) %>%
ungroup()
larvsummary <- larv %>% group_by(Ground, Survey.No, Year) %>%
summarize(MinLength = mean(MinLength, na.rm = TRUE),
MaxLength = mean(MaxLength, na.rm = TRUE),
MeanLength = mean(MeanLength, na.rm = TRUE),
SD = mean(SD, na.rm = TRUE),
Abundance = length(Lengthmm)) %>%
mutate(SE = SD/sqrt(Abundance))
?sqrt
#Calculating SE/mean/min/max of larval measurements
larv <- larv %>%
group_by(id, Year, Date) %>%
mutate(SD = sd(Lengthmm),
MinLength = min(Lengthmm),
MaxLength = max(Lengthmm),
MeanLength = mean(Lengthmm),
Abundance = length(Lengthmm),
X = ((Lon1 + Lon2)/2),
Y = ((Lat1 + Lat2)/2)) %>%
ungroup()
View(larv)
larvsummary <- larv %>% group_by(Ground, id, Year) %>%
summarize(MinLength = mean(MinLength, na.rm = TRUE),
MaxLength = mean(MaxLength, na.rm = TRUE),
MeanLength = mean(MeanLength, na.rm = TRUE),
SD = mean(SD, na.rm = TRUE),
Abundance = length(Lengthmm)) %>%
mutate(SE = SD/sqrt(Abundance))
surveysummary = survey %>% dplyr::select(Ground, Survey.No, Year) %>% group_by(Ground, Survey.No, Year) %>% summarize(Survey.No = mean(Survey.No), Year = mean(Year))
surveysummary$Year = as.factor(surveysummary$Year)
surveysummary$Survey.No = as.factor(surveysummary$Survey.No)
larvsummary = left_join(surveysummary, larvsummary)
View(larvsummary)
larv = larv %>%
mutate(Larv_per_jar = Abundance/No_jars) %>%
mutate(Volume = ifelse(Volume < 0.01, NA, Volume)) %>%
mutate(Density = Larv_per_jar/Volume)
View(larv)
?length
