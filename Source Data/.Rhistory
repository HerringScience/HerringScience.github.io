geom_polygon(data=SBout,aes(x=long, y=lat, group=group), fill = "gray") +
geom_polygon(data=SBplankton,aes(x=X, y=Y, group=PID),fill='white',col='black') +
geom_polygon(data=SBCTD,aes(x=X, y=Y, group=PID),fill='white',col='black') +
geom_segment(data=Plan2, aes(x = X, y = Y, xend = Xend, yend = Yend, colour = Vessel), size=0.5) +
coord_map() +
labs(x=NULL, y=NULL, caption = "Figure 1. Survey lines to be completed by participating vessels.")}
print(a)
a=if(surv=="SB"){
paste0(PlanktonVessel, " will complete both plankton towing (bottom left outer box) and CTD casts (inner box)")
}
b=if(surv=="GB"){
paste0(PlanktonVessel, " will complete both plankton towing and CTD casts (northern small box)")
}
if(surv=="SB"){
kables(list(
kable(CTDBox, caption = "CTD Box") %>%
kable_styling(full_width = FALSE, position = "float_left"),
kable(TowBox, caption = "Tow Box") %>%
kable_styling(full_width = FALSE, position = "right")))
}
if(surv=="GB"){
kbl(CTDBox, caption = "CTD Box") %>%
kable_styling(full_width = FALSE)
}
if(surv=="SB"){vessels2 = ifelse(is.na(EVessel) & is.na(NVessel), vessels,
ifelse(!is.na(EVessel) & is.na(NVessel), vessels-1,
ifelse(!is.na(EVessel) & !is.na(NVessel), vessels-2,
NA)))}
if(surv=="GB"){vessels2=vessels}
Main = read_csv(paste0("C:/Users/", Sys.info()[7], "/Documents/GitHub/HerringScience.github.io/Surveys/Survey Lines/", surv, "/C", vessels2, ".csv"))
if(surv=="SB"){
if(!is.na(NVessel)){North = read_csv(paste0("C:/Users/", Sys.info()[7], "/Documents/GitHub/HerringScience.github.io/Surveys/Survey Lines/", surv, "/North_Box.csv"))}
if(!is.na(EVessel)){East = read_csv(paste0("C:/Users/", Sys.info()[7], "/Documents/GitHub/HerringScience.github.io/Surveys/Survey Lines/", surv, "/East_Box.csv"))}
if(!is.na(NVessel) & is.na(EVessel)){Plan = full_join(Main, North)}
if(is.na(NVessel) & !is.na(EVessel)){Plan = full_join(Main, East)}
if(!is.na(NVessel) & !is.na(EVessel)){
Plan = full_join(Main, North)
Plan = full_join(Plan, East)}
if(is.na(NVessel) & is.na(EVessel)){Plan = Main}}
if(surv=="GB"){Plan=Main}
#Add vessel names to Plan
Plan = Plan %>%
mutate(Vessel = replace(Vessel, Vessel == "V1", V1)) %>%
mutate(Vessel = replace(Vessel, Vessel == "V2", V2)) %>%
mutate(Vessel = replace(Vessel, Vessel == "V3", V3)) %>%
mutate(Vessel = replace(Vessel, Vessel == "V4", V4)) %>%
mutate(Vessel = replace(Vessel, Vessel == "V5", V5)) %>%
mutate(Vessel = replace(Vessel, Vessel == "V6", V6)) %>%
mutate(Vessel = replace(Vessel, Vessel == "V7", V7)) %>%
mutate(Vessel = replace(Vessel, Vessel == "V8", V8)) %>%
mutate(Vessel = replace(Vessel, Vessel == "V9", V9)) %>%
mutate(Vessel = replace(Vessel, Vessel == "NVessel", NVessel)) %>%
mutate(Vessel = replace(Vessel, Vessel == "EVessel", EVessel))
Plan %>%
arrange(Vessel) %>%
kbl() %>%
kable_styling(full_width=FALSE)
b=surv.date+days(1)
c=substr(b,1,10)
d=paste0(Allocation, "mt/vessel.")
e=paste0(Allocation, "mt/vessel for German Bank and ", SIAllocation, "mt/vessel for Seal Island.")
i= "7. This is a non-fishing survey."
h=if(Allocation == 0){
print(i)
}
f=if(surv=="SB" & Allocation != 0){
paste0("7. Fishing to start on ", c, ", and allocation is ", d)
}
g=if(surv=="GB" & Allocation != 0){
paste0("7. Fishing to start on ", c, ", and allocation is ", e)
}
if(surv=="SB"){
cat("\n")
cat("### Tidal Charts", "\n")
cat("\n")
knitr::include_graphics(path=paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Surveys/", year, "/", surv, surv.no, "/Hourly.jpg"), rel_path = FALSE)
}
if(surv=="SB"){
cat("\n")
cat("### Tidal Charts", "\n")
cat("\n")
knitr::include_graphics(path=paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Surveys/", year, "/", surv, surv.no, "/Hourly.jpg"), rel_path = FALSE)
}
if(surv=="SB"){
knitr::include_graphics(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Surveys/", year, "/", surv, surv.no, "/Daily.jpg"), rel_path = FALSE)
}
#save all changes and information to a .csv for Update Data and results
CurrentData = tibble(FlowmeterType = "General Oceanics", TowType = "Surface Tow", Gear = "1/500", PlanktonVessel = PlanktonVessel, EVessel = EVessel, NVessel = NVessel, Survey.No = surv.no, Ground = surv, Vessel.No = vessels, Net = "1")
Month = substr(StartDate, 6,7)
Day = substr(StartDate, 9,10)
Year = substr(StartDate, 1,4)
CurrentData$Date = as.character(paste0(Day,"/",Month,"/",Year))
CurrentData$StartTime = as.character(StartTime)
CurrentData = CurrentData %>%
mutate(ExtraBox = ifelse(!is.na(EVessel) & is.na(NVessel), "East",
ifelse(is.na(EVessel) & !is.na(NVessel), "North",
ifelse(!is.na(EVessel) & !is.na(NVessel), "Both",
ifelse(is.na(EVessel) & is.na(NVessel), "None",
NA))))) %>%
mutate(Fishing = ifelse(Allocation > 0 | !is.na(Allocation), "Y", "N")) %>%
mutate(PlanktonVessel = ifelse(PlanktonVessel == "Lady Janice", "Lady Janice II", PlanktonVessel))
CurrentData %>% write_csv((paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Surveys/", year, "/", surv, surv.no, "/Plan Data.csv")))
# remove everything in the workspace
rm(list = ls())
library(lubridate)
library(tidyverse)
library(measurements)
# Set all tagging log data here
Tag_Num = c(521201:521545) #Can add any tag entries, including breaks/gaps in the sequences
Date = "2023-08-22" #"YYYY-MM-DD"
Lat = "43 23 00" #Degree-Min-Sec format from the boat but only the numbers written with spaces (e.g. "44 16 23")
Lon = "66 10 00"
Vessel = "Tasha Marie" #As written unless changed in script below: "Lady Melissa", "Sealife II", "Tasha Marie", "Lady Janice", "Morning Star"
Survey = NA #Survey number for Scots Bay or German Bank when tags were applied, otherwise "NA"
CTD = NA #Add the CTD id only if a TAGGER completed a cast (not the cast by the HSC tech)
# remove everything in the workspace
rm(list = ls())
library(lubridate)
library(tidyverse)
library(measurements)
# Set all tagging log data here
Tag_Num = c(521201:521545) #Can add any tag entries, including breaks/gaps in the sequences
Date = "2023-08-22" #"YYYY-MM-DD"
Lat = "43 23 00" #Degree-Min-Sec format from the boat but only the numbers written with spaces (e.g. "44 16 23")
Lon = "66 10 00"
Vessel = "Tasha Marie" #As written unless changed in script below: "Lady Melissa", "Sealife II", "Tasha Marie", "Lady Janice", "Morning Star"
Survey = NA #Survey number for Scots Bay or German Bank when tags were applied, otherwise "NA"
CTD = NA #Add the CTD id only if a TAGGER completed a cast (not the cast by the HSC tech)
##
###
### SCRIPT BELOW ###
###
##
# Load TaggingEvents.csv
#Tagging <- read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv"))
Tagging <- read_csv("/Users/tracey/Dropbox/Mac/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv")
# remove everything in the workspace
rm(list = ls())
library(lubridate)
library(tidyverse)
library(measurements)
# Set all tagging log data here
Tag_Num = c(521201:521545) #Can add any tag entries, including breaks/gaps in the sequences
Date = "2023-08-22" #"YYYY-MM-DD"
Lat = "43 23 00" #Degree-Min-Sec format from the boat but only the numbers written with spaces (e.g. "44 16 23")
Lon = "66 10 00"
Vessel = "Tasha Marie" #As written unless changed in script below: "Lady Melissa", "Sealife II", "Tasha Marie", "Lady Janice", "Morning Star"
Survey = NA #Survey number for Scots Bay or German Bank when tags were applied, otherwise "NA"
CTD = NA #Add the CTD id only if a TAGGER completed a cast (not the cast by the HSC tech)
##
###
### SCRIPT BELOW ###
###
##
# Load TaggingEvents.csv
#Tagging <- read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv"))
Tagging <- read_csv("/Users/tracey/Dropbox/Mac/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv")
# remove everything in the workspace
rm(list = ls())
library(lubridate)
library(tidyverse)
library(measurements)
# Set all tagging log data here
Tag_Num = c(521201:521545) #Can add any tag entries, including breaks/gaps in the sequences
Date = "2023-08-22" #"YYYY-MM-DD"
Lat = "43 23 00" #Degree-Min-Sec format from the boat but only the numbers written with spaces (e.g. "44 16 23")
Lon = "66 10 00"
Vessel = "Tasha Marie" #As written unless changed in script below: "Lady Melissa", "Sealife II", "Tasha Marie", "Lady Janice", "Morning Star"
Survey = NA #Survey number for Scots Bay or German Bank when tags were applied, otherwise "NA"
CTD = NA #Add the CTD id only if a TAGGER completed a cast (not the cast by the HSC tech)
##
###
### SCRIPT BELOW ###
###
##
# Load TaggingEvents.csv
Tagging <- read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv"))
#Tagging <- read_csv("/Users/tracey/Dropbox/Mac/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv")
Tagging$Date = ymd(Tagging$Date)
# Modify Data
Lon = conv_unit(Lon,"deg_min_sec","dec_deg")
Lon = as.numeric(Lon)
Lat = conv_unit(Lat, "deg_min_sec", "dec_deg")
Lat = as.numeric(Lat)
Lon = -1*Lon
Tags = tibble(Tag_Num, Date, Lon, Lat, Vessel, Survey, CTD)
Tags$Date = ymd(Tags$Date)
Tags = Tags %>%
mutate(Tagger = ifelse(Vessel == "Lady Melissa", "Joseph Nickerson",
ifelse(Vessel == "Sealife II", "Annik Doucette",
ifelse(Vessel == "Tasha Marie", "Dale Fitzgerald",
ifelse(Vessel == "Lady Janice", "Lee Surette",
ifelse(Vessel == "Morning Star", "Nicholas D'entremont",
ifelse(Vessel == "Fundy Monarch", "William Cusack",
ifelse(Vessel == "Canada 100", "William Cusack",
ifelse(Vessel == "Brunswick Provider", "William Cusack",
NA))))))))) %>%
mutate(Ground = ifelse(between(Lat, 45.02, 45.4) & between(Lon, -65.5, -64.5), "Scots Bay",
ifelse(between(Lat, 43.15, 43.7) & between(Lon, -66.75, -66.05), "German Bank", 'Other')))
# Bind Data and add Julian/Annual Tags
TaggingEvents = full_join(Tagging, Tags)
TaggingEvents = TaggingEvents %>%
mutate(Julian = yday(Date)) %>%
mutate(Year = as.numeric(substr(Date, 1, 4))) %>%
dplyr::select(-Tag_Annual)
Tag_Annual = TaggingEvents %>%
group_by(Tagger) %>%
mutate(count = n_distinct(Year)) %>%
summarize(n=n(), count2 = mean(count)) %>%
mutate(Tag_Annual = n/count2) %>%
dplyr::select(-n, -count2)
TaggingEvents = left_join(TaggingEvents, Tag_Annual, by = "Tagger")
# Save TaggingEvents.csv
TaggingEvents %>% write_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv"))
TaggingEvents %>% write_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/TaggingEvents.csv"))
#TaggingEvents %>% write_csv("/Users/tracey/Dropbox/Mac/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv")
#TaggingEvents %>% write_csv("/Users/tracey/Dropbox/Mac/Documents/GitHub/HerringScience.github.io/Main Data/TaggingEvents.csv")
# remove everything in the workspace
rm(list = ls())
library(lubridate)
library(tidyverse)
library(measurements)
# Set all tagging log data here
Tag_Num = c(563750:564000) #Can add any tag entries, including breaks/gaps in the sequences
Date = "2023-08-20" #"YYYY-MM-DD"
Lat = "45 07 18" #Degree-Min-Sec format from the boat but only the numbers written with spaces (e.g. "44 16 23")
Lon = "65 03 23"
Vessel = "Fundy Monarch" #As written unless changed in script below: "Lady Melissa", "Sealife II", "Tasha Marie", "Lady Janice", "Morning Star"
Survey = NA #Survey number for Scots Bay or German Bank when tags were applied, otherwise "NA"
CTD = NA #Add the CTD id only if a TAGGER completed a cast (not the cast by the HSC tech)
##
###
### SCRIPT BELOW ###
###
##
# Load TaggingEvents.csv
Tagging <- read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv"))
#Tagging <- read_csv("/Users/tracey/Dropbox/Mac/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv")
Tagging$Date = ymd(Tagging$Date)
# Modify Data
Lon = conv_unit(Lon,"deg_min_sec","dec_deg")
Lon = as.numeric(Lon)
Lat = conv_unit(Lat, "deg_min_sec", "dec_deg")
Lat = as.numeric(Lat)
Lon = -1*Lon
Tags = tibble(Tag_Num, Date, Lon, Lat, Vessel, Survey, CTD)
Tags$Date = ymd(Tags$Date)
Tags = Tags %>%
mutate(Tagger = ifelse(Vessel == "Lady Melissa", "Joseph Nickerson",
ifelse(Vessel == "Sealife II", "Annik Doucette",
ifelse(Vessel == "Tasha Marie", "Dale Fitzgerald",
ifelse(Vessel == "Lady Janice", "Lee Surette",
ifelse(Vessel == "Morning Star", "Nicholas D'entremont",
ifelse(Vessel == "Fundy Monarch", "William Cusack",
ifelse(Vessel == "Canada 100", "William Cusack",
ifelse(Vessel == "Brunswick Provider", "William Cusack",
NA))))))))) %>%
mutate(Ground = ifelse(between(Lat, 45.02, 45.4) & between(Lon, -65.5, -64.5), "Scots Bay",
ifelse(between(Lat, 43.15, 43.7) & between(Lon, -66.75, -66.05), "German Bank", 'Other')))
# Bind Data and add Julian/Annual Tags
TaggingEvents = full_join(Tagging, Tags)
TaggingEvents = TaggingEvents %>%
mutate(Julian = yday(Date)) %>%
mutate(Year = as.numeric(substr(Date, 1, 4))) %>%
dplyr::select(-Tag_Annual)
Tag_Annual = TaggingEvents %>%
group_by(Tagger) %>%
mutate(count = n_distinct(Year)) %>%
summarize(n=n(), count2 = mean(count)) %>%
mutate(Tag_Annual = n/count2) %>%
dplyr::select(-n, -count2)
TaggingEvents = left_join(TaggingEvents, Tag_Annual, by = "Tagger")
# Save TaggingEvents.csv
TaggingEvents %>% write_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv"))
TaggingEvents %>% write_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/TaggingEvents.csv"))
#TaggingEvents %>% write_csv("/Users/tracey/Dropbox/Mac/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv")
#TaggingEvents %>% write_csv("/Users/tracey/Dropbox/Mac/Documents/GitHub/HerringScience.github.io/Main Data/TaggingEvents.csv")
# remove everything in the workspace
rm(list = ls())
# remove everything in the workspace
rm(list = ls())
library(lubridate)
library(tidyverse)
library(measurements)
# Set all tagging log data here
Tag_Num = c(521201:521545) #Can add any tag entries, including breaks/gaps in the sequences
Date = "2023-08-23" #"YYYY-MM-DD"
Lat = "43 23 00" #Degree-Min-Sec format from the boat but only the numbers written with spaces (e.g. "44 16 23")
Lon = "66 10 00"
Vessel = "Tasha Marie" #As written unless changed in script below: "Lady Melissa", "Sealife II", "Tasha Marie", "Lady Janice", "Morning Star"
Survey = NA #Survey number for Scots Bay or German Bank when tags were applied, otherwise "NA"
CTD = NA #Add the CTD id only if a TAGGER completed a cast (not the cast by the HSC tech)
##
###
### SCRIPT BELOW ###
###
##
# Load TaggingEvents.csv
Tagging <- read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv"))
#Tagging <- read_csv("/Users/tracey/Dropbox/Mac/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv")
Tagging$Date = ymd(Tagging$Date)
# Modify Data
Lon = conv_unit(Lon,"deg_min_sec","dec_deg")
Lon = as.numeric(Lon)
Lat = conv_unit(Lat, "deg_min_sec", "dec_deg")
Lat = as.numeric(Lat)
Lon = -1*Lon
Tags = tibble(Tag_Num, Date, Lon, Lat, Vessel, Survey, CTD)
Tags$Date = ymd(Tags$Date)
Tags = Tags %>%
mutate(Tagger = ifelse(Vessel == "Lady Melissa", "Joseph Nickerson",
ifelse(Vessel == "Sealife II", "Annik Doucette",
ifelse(Vessel == "Tasha Marie", "Dale Fitzgerald",
ifelse(Vessel == "Lady Janice", "Lee Surette",
ifelse(Vessel == "Morning Star", "Nicholas D'entremont",
ifelse(Vessel == "Fundy Monarch", "William Cusack",
ifelse(Vessel == "Canada 100", "William Cusack",
ifelse(Vessel == "Brunswick Provider", "William Cusack",
NA))))))))) %>%
mutate(Ground = ifelse(between(Lat, 45.02, 45.4) & between(Lon, -65.5, -64.5), "Scots Bay",
ifelse(between(Lat, 43.15, 43.7) & between(Lon, -66.75, -66.05), "German Bank", 'Other')))
# Bind Data and add Julian/Annual Tags
TaggingEvents = full_join(Tagging, Tags)
TaggingEvents = TaggingEvents %>%
mutate(Julian = yday(Date)) %>%
mutate(Year = as.numeric(substr(Date, 1, 4))) %>%
dplyr::select(-Tag_Annual)
Tag_Annual = TaggingEvents %>%
group_by(Tagger) %>%
mutate(count = n_distinct(Year)) %>%
summarize(n=n(), count2 = mean(count)) %>%
mutate(Tag_Annual = n/count2) %>%
dplyr::select(-n, -count2)
TaggingEvents = left_join(TaggingEvents, Tag_Annual, by = "Tagger")
# Save TaggingEvents.csv
TaggingEvents %>% write_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv"))
TaggingEvents %>% write_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/TaggingEvents.csv"))
#TaggingEvents %>% write_csv("/Users/tracey/Dropbox/Mac/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv")
#TaggingEvents %>% write_csv("/Users/tracey/Dropbox/Mac/Documents/GitHub/HerringScience.github.io/Main Data/TaggingEvents.csv")
sessionInfo()
# remove everything in the workspace
rm(list = ls())
# IMPORTANT : SET GROUND, YEAR, AND SURVEY # HERE
surv="SB" #SB or GB
surv2="Scots Bay" #"German Bank" or "Scots Bay" as written
year="2023"
surv.no="8"
adhoc = "FALSE" #true or false if an adhoc survey was completed (and "adhoc.csv" exists)
Sample = "Y" #whether ("Y") or not ("N") they caught fish during this survey window
Tow = "Y" #whether or not plankton tow(s) were conducted
#(SB ONLY) Set main-box vessels
ids = c("C1", "FM", "LM", "LJ", "SL", "MS", "LB", "BP")
#Area and TS values - From table C
SB1= 661 #SB main area
SB2= 77 #SB north area
SB3= 115 #SB east area
GB1 = 796 #GB main area
GB2 = 272 #Seal Island area
GB3 = NA #Ad-hoc school survey area
##
###
##
#BELOW VALUES SHOULD RARELY CHANGE#
TS1 = -35.5 #TS38
#turnover calculation regression values
GB_y = 0.199392662629964
GB_x_var = 0.528381832773883
GB_days = 31
SB_y = 0.364102758434224
SB_x_var = 0.436969270679439
SB_days = 29
library(rlang)
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
library(weathercan)
library(GGally)
library(psych)
library(raster)
library(PBSmapping)
library(rgeos)
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
library(readxl)
library(hms)
library(measurements)
##Survey Data import and filtering
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Surveys/", year, "/", surv, surv.no))
Plankton = read_csv("PlanktonData.csv")
Plankton = Plankton %>%
mutate(Year = year,
Ground = surv,
Survey.No = surv.no,
TowTime = difftime(Time2, Time1, units = "mins"))
Plankton$Year = as.numeric(Plankton$Year)
Plankton$Swell = as.character(Plankton$Swell)
if(Sample == "Y"){Plankton$Sample = "Y"}
if(Sample == "N"){Plankton$Sample = "N"}
#get CTD data from Plankton
SurveyData = read_csv("Plan Data.csv")
SurveyData$StartDate = as.Date(SurveyData$Date, format = "%d/%m/%Y")
if(!is.na(first(Plankton$CTD_ID))){
CTDData = read_csv(paste0(Plankton$CTD_ID, ".csv"))
CTDData = CTDData %>%
dplyr::select(Pressure = "Pressure (Decibar)", Depth = "Depth (Meter)", Temperature = "Temperature (Celsius)",	Conductivity = "Conductivity (MicroSiemens per Centimeter)", Specific_conductance = "Specific conductance (MicroSiemens per Centimeter)",
Salinity = "Salinity (Practical Salinity Scale)", Sound_velocity = "Sound velocity (Meters per Second)", Density = "Density (Kilograms per Cubic Meter)")
CTDData = CTDData %>%
mutate(plankton_ID = paste0(first(Plankton$Set_Number), "/", last(Plankton$Set_Number)),
ground = surv2,
id = first(Plankton$CTD_ID),
Date = first(SurveyData$StartDate),
Lat = first(Plankton$CTD_Lat),
Lon = first(Plankton$CTD_Lon),
Year = first(year),
Survey = first(surv.no))
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data"))
CTDRaw = read_csv("CTD_Raw.csv")
CTDData$Year = as.numeric(CTDData$Year)
CTDData$Survey = as.numeric(CTDData$Survey)
CTDTotal = full_join(CTDRaw, CTDData)
CTDTotal %>% write_csv("CTD_Raw.csv")
Plankton = Plankton %>%
mutate(AvgTemp = mean(CTDData$Temperature),
AvgSalinity = mean(CTDData$Salinity))
}
if(is.na(first(Plankton$CTD_ID))){
Plankton = Plankton %>%
mutate(AvgTemp = NA,
AvgSalinity = NA)
}
#get Ruskin data
if(Tow == "Y"){
TowData = read_excel(path = paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Surveys/", year, "/", surv, surv.no, "/Ruskin.xlsx"), skip = 1, sheet = 'Data')
TowData$DateTime = TowData$Time
TowData$DateTime = TowData$DateTime-hours(3)
TowData$Date = substr(TowData$DateTime,1,10)
TowData$Time = substr(TowData$DateTime,12,19)
TowData$Time = hms::as_hms(TowData$Time)
#Filter tow data based on Time1 + Time2
Tow1 = TowData[TowData$Time >= first(Plankton$Time1) & TowData$Time <= first(Plankton$Time2),]
Tow2 = TowData[TowData$Time >= last(Plankton$Time1) & TowData$Time <= last(Plankton$Time2),]
#Calculate average and max tow depths for each
Tow1 = Tow1 %>%
mutate(AvgTowDepth = mean(Depth),
MaxTowDepth = max(Depth),
Tow_No = 1)
Tow2 = Tow2 %>%
mutate(AvgTowDepth = mean(Depth),
MaxTowDepth = max(Depth),
Tow_No = 2)
#ggplot the profiles for each tow
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Surveys/", year, "/", surv, surv.no))
Tow1 %>%
ggplot(aes(x = Time, y = Depth)) +
geom_path(linewidth = 1, colour = "blue") +
scale_y_reverse() +
labs(y = "Depth (m)")
ggsave("Tow 1.jpg")
Tow2 %>%
ggplot(aes(x = Time, y = Depth)) +
geom_path(linewidth = 1, colour = "blue") +
scale_y_reverse() +
labs(y = "Depth (m)")
ggsave("Tow 2.jpg")
#combine the avg and max values with plankton sheet
TowTbl1 = tibble_row(Tow_No = 1, AvgTowDepth = first(Tow1$AvgTowDepth), MaxTowDepth = first(Tow1$MaxTowDepth))
TowTbl2 = tibble_row(Tow_No = 2, AvgTowDepth = first(Tow2$AvgTowDepth), MaxTowDepth = first(Tow2$MaxTowDepth))
TowCalcs = full_join(TowTbl1, TowTbl2)
Plankton = full_join(Plankton, TowCalcs, by = "Tow_No")
#convert lat/lon before combining
Plankton$Lon1 = as.numeric(conv_unit(Plankton$Lon1, "deg_dec_min", "dec_deg"))*-1
Plankton$Lon2 = as.numeric(conv_unit(Plankton$Lon2, "deg_dec_min", "dec_deg"))*-1
Plankton$Lat1 = as.numeric(conv_unit(Plankton$Lat1, "deg_dec_min", "dec_deg"))
Plankton$Lat2 = as.numeric(conv_unit(Plankton$Lat2, "deg_dec_min", "dec_deg"))
Plankton = Plankton %>%
rename(id = Set_Number)
PlanData = read_csv((paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Surveys/", year, "/", surv, surv.no, "/Plan Data.csv")))
PlanData$Survey.No = as.character(PlanData$Survey.No)
SurveyTotal = full_join(Plankton, PlanData)
setwd(paste0("C:/Users/", Sys.info()[7], "/Documents/GitHub/HerringScience.github.io/Source Data/"))
Survey = read_csv("planktonsamplingData.csv")
SurveyTotal$TowTime = as.numeric(SurveyTotal$TowTime)
Total = full_join(Survey, SurveyTotal)
Total = Total %>%
mutate(Day = as.numeric(substr(Date, 1, 2)),
Month = as.numeric(substr(Date, 4, 5)),
Year = as.numeric(substr(Date, 7, 10)),
TowTime = difftime(Time2, Time1, units ="mins"),
NoRevs = FlowReading2-FlowReading1,
DistanceCalc = NoRevs*26873/1000000,
Volume = DistanceCalc*3.1415)
Total = Total %>%
dplyr::select(Year, Month, Day, Date, Ground, id, Survey.No, Fishing, Sample,
StartTime, Vessel.No, ExtraBox, EVessel, NVessel, PlanktonVessel,
Tow_No, Time1, Time2, TowTime, Lat1, Lon1, Lat2, Lon2, No_jars,
Speed, Heading, TideDirection, Swell, WindDirection, WindSpeed,
AirTemp, Observer, Net, Gear, TowType, FlowmeterType, FlowReading1,
FlowReading2, NoRevs, DistanceCalc, Volume, AvgTowDepth, MaxTowDepth,
DiscDepthD, DiscDepthA, CTD_ID, CTD_Lat, CTD_Lon, AvgTemp, AvgSalinity,
SurfaceTemp, WaterDepth1, WaterDepth2)
Total %>% write_csv("planktonsamplingData.csv")
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/"))
Total %>% write_csv("Survey Data.csv")}
