CTDAvgTemp,
Volume)
LarvalSum <- unique(LarvalSum)
View(larvsummary)
View(LarvalSum)
View(larv)
View(larvsummary)
larv <- larv %>%
group_by(id) %>%
arrange(LengthAdjustment) %>%
mutate(MeanLengthAdjustment = mean(LengthAdjustment)) %>%
mutate(AdjustedMeanAgeInDays = mean(AdjustedAgeInDays)) %>%
mutate(AdjustedMinDateOfSpawn = min(AdjustedSpawnDate)) %>%
mutate(AdjustedMaxDateOfSpawn = max(AdjustedSpawnDate)) %>%
mutate(MinLength = min(LengthAdjustment)) %>%
mutate(MaxLength = max(LengthAdjustment))
rm(list = ls())
#Import all the required libraries. The ones commented out have been discontinued, but left in in case something breaks and we need to find an alternative.
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(raster)
library(PBSmapping)
#library(rgeos)
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
LarvalSum = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/LarvalSum.csv"))
larv = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/Larval Measurements.csv"))
arc = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/ARC Data.csv"))
arc = arc %>% dplyr::select(id, Larvae_Count, Notes)
survey = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv"))
survey = survey %>% mutate(Ground = substr(id,1,2))
larv = left_join(larv, arc, by="id")
larv = left_join(larv, survey)
larv = larv %>% dplyr::select(Ground, id, Date, Survey.No, No_jars, Lengthmm, Condition, Yolk_sac, Preservative, TowReplicate, TowID, ARC_Count=Larvae_Count, ARC_Notes=Notes, Lon1, Lat1, Lon2, Lat2, TowTime, AvgTowDepth, MaxTowDepth, CTDAvgTemp=AvgTemp, Volume, Month, Year, Day)
larv$Date = dmy(larv$Date)
larv$Survey.No = as.factor(larv$Survey.No)
larv$Year = as.factor(larv$Year)
larv$category =  with(larv, ifelse(larv$Lengthmm < 8 , 1,
ifelse(larv$Lengthmm < 12 & larv$Lengthmm >= 8, 2,
ifelse(larv$Lengthmm >= 12  & larv$Lengthmm < 17, 3,
ifelse(larv$Lengthmm > 17 & larv$Lengthmm < 27, 4, 5)))))
larv$category = as.factor(larv$category)
# if preservative is formalin, apply L  = 0.984 + 0.993 x X1. (X1 = fixed/preserved length therefore Larval$Lengthmm, L = Live length.)
# if preservation is alcohol apply L = 0.532 + 0.989 x X1
#This is taken from Fox 1996 alcohol vs Formalin paper. They did 5% and 5 minute net capture simulation. They did suggest that this adjustment would be less accurate the longer the tow period.
# These equations are when the maximum shrinkage has occurred.
larv$LengthAdjustment = with(larv, ifelse(larv$Preservative == "4% formalin", (0.984 + 0.993* larv$Lengthmm),
ifelse(larv$Preservative == "70% alcohol", (0.532 + 0.989*larv$Lengthmm),NA)))
#'Exact' spawn date. Growth rate of .24mm/day based on Chenoweth 1989 paper.
# Paper says applies estimate growth rates to calculate the number of days back to 5mm. Took 5mm off total length to account for this.
# Assumes hatching length is 5mm, day of hatching = day 0
#Adjusted Spawn Date to account for incubation period. Using overall 10 days, as per NOAA info that says 7-10 days, and DFO stock assessment 2020 says 10-12 days.
#To get hatch date, remove the -10 that is there due to incubation period.
larv <- larv %>%
mutate(AdjustedAgeInDays = ((LengthAdjustment - 5)/0.24)) %>%
mutate(AdjustedSpawnDate = as.Date(Date) - AdjustedAgeInDays - 10) %>%
mutate(AdjustedJulianSpawnDate = yday(AdjustedSpawnDate)) %>%
mutate(Julian = yday(Date))
#Adding averages into the dataframe
larv <- larv %>%
group_by(id) %>%
arrange(LengthAdjustment) %>%
mutate(MeanLengthAdjustment = mean(LengthAdjustment)) %>%
mutate(AdjustedMeanAgeInDays = mean(AdjustedAgeInDays)) %>%
mutate(AdjustedMinDateOfSpawn = min(AdjustedSpawnDate)) %>%
mutate(AdjustedMaxDateOfSpawn = max(AdjustedSpawnDate)) %>%
mutate(MinLength = min(LengthAdjustment)) %>%
mutate(MaxLength = max(LengthAdjustment))
View(larv)
larv <- larv %>%
group_by(Ground, Survey.No, Year) %>%
mutate(SD = sd(Lengthmm), MinLength = min(Lengthmm), MaxLength = max(Lengthmm), MeanLength = mean(Lengthmm), Abundance = length(Lengthmm)) %>%
ungroup()
View(larv)
larv <- larv %>%
group_by(id) %>%
arrange(LengthAdjustment) %>%
mutate(MeanLengthAdjustment = mean(LengthAdjustment)) %>%
mutate(AdjustedMeanAgeInDays = mean(AdjustedAgeInDays)) %>%
mutate(AdjustedMinDateOfSpawn = min(AdjustedSpawnDate)) %>%
mutate(AdjustedMaxDateOfSpawn = max(AdjustedSpawnDate)) %>%
mutate(MinLength = min(LengthAdjustment)) %>%
mutate(MaxLength = max(LengthAdjustment)) %>%
mutate(SD = sd(LengthAdjustment))
View(larv)
larv <- larv %>%
group_by(id) %>%
arrange(LengthAdjustment) %>%
mutate(MeanLengthAdjustment = mean(LengthAdjustment)) %>%
mutate(AdjustedMeanAgeInDays = mean(AdjustedAgeInDays)) %>%
mutate(AdjustedMinDateOfSpawn = min(AdjustedSpawnDate)) %>%
mutate(AdjustedMaxDateOfSpawn = max(AdjustedSpawnDate)) %>%
mutate(MinLength = min(LengthAdjustment)) %>%
mutate(MaxLength = max(LengthAdjustment)) %>%
mutate(SD = sd(LengthAdjustment)) %>%
mutate(Abundance = length(LengthAdjustment))
View(larv)
rm(list = ls())
#Import all the required libraries. The ones commented out have been discontinued, but left in in case something breaks and we need to find an alternative.
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(raster)
library(PBSmapping)
#library(rgeos)
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
LarvalSum = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/LarvalSum.csv"))
larv = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/Larval Measurements.csv"))
arc = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/ARC Data.csv"))
arc = arc %>% dplyr::select(id, Larvae_Count, Notes)
survey = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv"))
survey = survey %>% mutate(Ground = substr(id,1,2))
larv = left_join(larv, arc, by="id")
larv = left_join(larv, survey)
larv = larv %>% dplyr::select(Ground, id, Date, Survey.No, No_jars, Lengthmm, Condition, Yolk_sac, Preservative, TowReplicate, TowID, ARC_Count=Larvae_Count, ARC_Notes=Notes, Lon1, Lat1, Lon2, Lat2, TowTime, AvgTowDepth, MaxTowDepth, CTDAvgTemp=AvgTemp, Volume, Month, Year, Day)
larv$Date = dmy(larv$Date)
larv$Survey.No = as.factor(larv$Survey.No)
larv$Year = as.factor(larv$Year)
larv$category =  with(larv, ifelse(larv$Lengthmm < 8 , 1,
ifelse(larv$Lengthmm < 12 & larv$Lengthmm >= 8, 2,
ifelse(larv$Lengthmm >= 12  & larv$Lengthmm < 17, 3,
ifelse(larv$Lengthmm > 17 & larv$Lengthmm < 27, 4, 5)))))
larv$category = as.factor(larv$category)
# if preservative is formalin, apply L  = 0.984 + 0.993 x X1. (X1 = fixed/preserved length therefore Larval$Lengthmm, L = Live length.)
# if preservation is alcohol apply L = 0.532 + 0.989 x X1
#This is taken from Fox 1996 alcohol vs Formalin paper. They did 5% and 5 minute net capture simulation. They did suggest that this adjustment would be less accurate the longer the tow period.
# These equations are when the maximum shrinkage has occurred.
larv$LengthAdjustment = with(larv, ifelse(larv$Preservative == "4% formalin", (0.984 + 0.993* larv$Lengthmm),
ifelse(larv$Preservative == "70% alcohol", (0.532 + 0.989*larv$Lengthmm),NA)))
#'Exact' spawn date. Growth rate of .24mm/day based on Chenoweth 1989 paper.
# Paper says applies estimate growth rates to calculate the number of days back to 5mm. Took 5mm off total length to account for this.
# Assumes hatching length is 5mm, day of hatching = day 0
#Adjusted Spawn Date to account for incubation period. Using overall 10 days, as per NOAA info that says 7-10 days, and DFO stock assessment 2020 says 10-12 days.
#To get hatch date, remove the -10 that is there due to incubation period.
larv <- larv %>%
mutate(AdjustedAgeInDays = ((LengthAdjustment - 5)/0.24)) %>%
mutate(AdjustedSpawnDate = as.Date(Date) - AdjustedAgeInDays - 10) %>%
mutate(AdjustedJulianSpawnDate = yday(AdjustedSpawnDate)) %>%
mutate(Julian = yday(Date))
#Adding averages into the dataframe
larv <- larv %>%
group_by(id) %>%
arrange(LengthAdjustment) %>%
mutate(MeanLengthAdjustment = mean(LengthAdjustment)) %>%
mutate(AdjustedMeanAgeInDays = mean(AdjustedAgeInDays)) %>%
mutate(AdjustedMinDateOfSpawn = min(AdjustedSpawnDate)) %>%
mutate(AdjustedMaxDateOfSpawn = max(AdjustedSpawnDate)) %>%
mutate(MinLength = min(LengthAdjustment)) %>%
mutate(MaxLength = max(LengthAdjustment)) %>%
mutate(SD = sd(LengthAdjustment)) %>%
mutate(Abundance = length(LengthAdjustment))
larv = larv %>%
dplyr::select(Ground,
id,
Date,
Survey.No,
No_jars,
Abundance,
Lengthmm,
category,
MinLength,
MaxLength,
MeanLength,
SD,
Larv_per_jar,
Density,
Julian,
Day,
Month,
Year,
Condition,
Yolk_sac,
Preservative,
ARC_Count,
ARC_Notes,
Lon1,
Lat1,
Lon2,
Lat2,
TowTime,
AvgTowDepth,
MaxTowDepth,
CTDAvgTemp,
Volume,
TowID,
TowReplicate,
LengthAdjustment,
AdjustedSpawnDate,
AdjustedJulianSpawnDate,
MeanLengthAdjustment,
AdjustedMeanAgeInDays,
AdjustedMinDateOfSpawn,
AdjustedMaxDateOfSpawn
)
larv = larv %>%
dplyr::select(Ground,
id,
Date,
Survey.No,
No_jars,
Abundance,
Lengthmm,
category,
#MinLength,
#MaxLength,
#MeanLength,
SD,
Larv_per_jar,
Density,
Julian,
Day,
Month,
Year,
Condition,
Yolk_sac,
Preservative,
ARC_Count,
ARC_Notes,
Lon1,
Lat1,
Lon2,
Lat2,
TowTime,
AvgTowDepth,
MaxTowDepth,
CTDAvgTemp,
Volume,
TowID,
TowReplicate,
LengthAdjustment,
AdjustedSpawnDate,
AdjustedJulianSpawnDate,
MeanLengthAdjustment,
AdjustedMeanAgeInDays,
AdjustedMinDateOfSpawn,
AdjustedMaxDateOfSpawn
)
larv <- larv %>%
group_by(id) %>%
arrange(LengthAdjustment) %>%
mutate(MeanLengthAdjustment = mean(LengthAdjustment)) %>%
mutate(AdjustedMeanAgeInDays = mean(AdjustedAgeInDays)) %>%
mutate(AdjustedMinDateOfSpawn = min(AdjustedSpawnDate)) %>%
mutate(AdjustedMaxDateOfSpawn = max(AdjustedSpawnDate)) %>%
mutate(MinLength = min(LengthAdjustment)) %>%
mutate(MaxLength = max(LengthAdjustment)) %>%
mutate(SD = sd(LengthAdjustment)) %>%
mutate(Abundance = length(LengthAdjustment)) %>%
mutate(Larv_per_jar = Abundance/No_jars) %>%
mutate(Volume = ifelse(Volume < 0.01, NA, Volume)) %>%
mutate(Density = Larv_per_jar/Volume)
larv = larv %>%
dplyr::select(Ground,
id,
Date,
Survey.No,
No_jars,
Abundance,
Lengthmm,
category,
#MinLength,
#MaxLength,
#MeanLength,
SD,
Larv_per_jar,
Density,
Julian,
Day,
Month,
Year,
Condition,
Yolk_sac,
Preservative,
ARC_Count,
ARC_Notes,
Lon1,
Lat1,
Lon2,
Lat2,
TowTime,
AvgTowDepth,
MaxTowDepth,
CTDAvgTemp,
Volume,
TowID,
TowReplicate,
LengthAdjustment,
AdjustedSpawnDate,
AdjustedJulianSpawnDate,
MeanLengthAdjustment,
AdjustedMeanAgeInDays,
AdjustedMinDateOfSpawn,
AdjustedMaxDateOfSpawn
)
View(larv)
rm(list = ls())
#Import all the required libraries. The ones commented out have been discontinued, but left in in case something breaks and we need to find an alternative.
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(raster)
library(PBSmapping)
#library(rgeos)
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
LarvalSum = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/LarvalSum.csv"))
larv = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/Larval Measurements.csv"))
arc = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Larval Data/ARC Data.csv"))
arc = arc %>% dplyr::select(id, Larvae_Count, Notes)
survey = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv"))
survey = survey %>% mutate(Ground = substr(id,1,2))
larv = left_join(larv, arc, by="id")
larv = left_join(larv, survey)
larv = larv %>% dplyr::select(Ground, id, Date, Survey.No, No_jars, Lengthmm, Condition, Yolk_sac, Preservative, TowReplicate, TowID, ARC_Count=Larvae_Count, ARC_Notes=Notes, Lon1, Lat1, Lon2, Lat2, TowTime, AvgTowDepth, MaxTowDepth, CTDAvgTemp=AvgTemp, Volume, Month, Year, Day)
larv$Date = dmy(larv$Date)
larv$Survey.No = as.factor(larv$Survey.No)
larv$Year = as.factor(larv$Year)
larv$category =  with(larv, ifelse(larv$Lengthmm < 8 , 1,
ifelse(larv$Lengthmm < 12 & larv$Lengthmm >= 8, 2,
ifelse(larv$Lengthmm >= 12  & larv$Lengthmm < 17, 3,
ifelse(larv$Lengthmm > 17 & larv$Lengthmm < 27, 4, 5)))))
larv$category = as.factor(larv$category)
# if preservative is formalin, apply L  = 0.984 + 0.993 x X1. (X1 = fixed/preserved length therefore Larval$Lengthmm, L = Live length.)
# if preservation is alcohol apply L = 0.532 + 0.989 x X1
#This is taken from Fox 1996 alcohol vs Formalin paper. They did 5% and 5 minute net capture simulation. They did suggest that this adjustment would be less accurate the longer the tow period.
# These equations are when the maximum shrinkage has occurred.
larv$LengthAdjustment = with(larv, ifelse(larv$Preservative == "4% formalin", (0.984 + 0.993* larv$Lengthmm),
ifelse(larv$Preservative == "70% alcohol", (0.532 + 0.989*larv$Lengthmm),NA)))
#'Exact' spawn date. Growth rate of .24mm/day based on Chenoweth 1989 paper.
# Paper says applies estimate growth rates to calculate the number of days back to 5mm. Took 5mm off total length to account for this.
# Assumes hatching length is 5mm, day of hatching = day 0
#Adjusted Spawn Date to account for incubation period. Using overall 10 days, as per NOAA info that says 7-10 days, and DFO stock assessment 2020 says 10-12 days.
#To get hatch date, remove the -10 that is there due to incubation period.
larv <- larv %>%
mutate(AdjustedAgeInDays = ((LengthAdjustment - 5)/0.24)) %>%
mutate(AdjustedSpawnDate = as.Date(Date) - AdjustedAgeInDays - 10) %>%
mutate(AdjustedJulianSpawnDate = yday(AdjustedSpawnDate)) %>%
mutate(Julian = yday(Date))
#Adding averages into the dataframe
larv <- larv %>%
group_by(id) %>%
arrange(LengthAdjustment) %>%
mutate(MeanLengthAdjustment = mean(LengthAdjustment)) %>%
mutate(AdjustedMeanAgeInDays = mean(AdjustedAgeInDays)) %>%
mutate(AdjustedMinDateOfSpawn = min(AdjustedSpawnDate)) %>%
mutate(AdjustedMaxDateOfSpawn = max(AdjustedSpawnDate)) %>%
mutate(MinLength = min(LengthAdjustment)) %>%
mutate(MaxLength = max(LengthAdjustment)) %>%
mutate(SD = sd(LengthAdjustment)) %>%
mutate(Abundance = length(LengthAdjustment)) %>%
mutate(Larv_per_jar = Abundance/No_jars) %>%
mutate(Volume = ifelse(Volume < 0.01, NA, Volume)) %>%
mutate(Density = Larv_per_jar/Volume)
#####Calculating SE/mean/min/max of larval measurements.
##### This is Darren's old code. Do we still need all this?
# larv <- larv %>%
#   group_by(Ground, Survey.No, Year) %>%
#   mutate(SD = sd(Lengthmm), MinLength = min(Lengthmm), MaxLength = max(Lengthmm), MeanLength = mean(Lengthmm), Abundance = length(Lengthmm)) %>%
#   ungroup()
#
# larv$SD[is.na(larv$SD)] <- 0
# larv$SD <- as.numeric(larv$SD)
#
# larvsummary <- larv %>% group_by(Ground, Survey.No, Year) %>%
#   summarize(MinLength = mean(MinLength, na.rm = TRUE),
#             MaxLength = mean(MaxLength, na.rm = TRUE),
#             MeanLength = mean(MeanLength, na.rm = TRUE),
#             SD = mean(SD, na.rm = TRUE),
#             Abundance = length(Lengthmm)) %>%
#   mutate(SE = SD/sqrt(Abundance))
# surveysummary = survey %>% dplyr::select(id, Ground, Survey.No, Year) %>% group_by(id, Ground, Survey.No, Year) %>% summarize(Survey.No = Survey.No, Year = Year)
# surveysummary$Year = as.factor(surveysummary$Year)
# surveysummary$Survey.No = as.factor(surveysummary$Survey.No)
# larvsummary = left_join(surveysummary, larvsummary)
#
# larv = larv %>%
#   mutate(Larv_per_jar = Abundance/No_jars) %>%
#   mutate(Volume = ifelse(Volume < 0.01, NA, Volume)) %>%
#   mutate(Density = Larv_per_jar/Volume)
###Calculating AVERAGE SE/mean/min/max of larval measurements.
### This is all Darren's old code. Do we still need this?
# larv <- larv %>%
#   group_by(Ground, Survey.No, Year) %>%
#   mutate(AdjSD = sd(LengthAdjustment), AdjustedMinLength = min(LengthAdjustment), AdjustedMaxLength = max(LengthAdjustment), MeanLengthAdjustment = MeanLengthAdjustment, Abundance = length(LengthAdjustment)) %>%
#   ungroup()
#
# larv$AdjSD[is.na(larv$AdjSD)] <- 0
# larv$AdjSD <- as.numeric(larv$AdjSD)
#
# larvsummary <- larv %>% group_by(Ground, Survey.No, Year) %>%
#   summarize(MeanAdjustedMinLength = mean(AdjustedMinLength, na.rm = TRUE),
#             MeanAdjustedMaxLength = mean(AdjustedMaxLength, na.rm = TRUE),
#             MeanAdjustedSD = mean(AdjSD, na.rm = TRUE),
#             Abundance = length(LengthAdjustment)) %>%
#   mutate(SE =  MeanAdjustedSD/sqrt(Abundance))
# surveysummary = survey %>% dplyr::select(id, Ground, Survey.No, Year) %>% group_by(id, Ground, Survey.No, Year) %>% summarize(Survey.No = Survey.No, Year = Year)
# surveysummary$Year = as.factor(surveysummary$Year)
# surveysummary$Survey.No = as.factor(surveysummary$Survey.No)
# larvsummary = left_join(surveysummary, larvsummary)
#
#
# larv = larv %>%
#   mutate(Larv_per_jar = Abundance/No_jars) %>%
#   mutate(Volume = ifelse(Volume < 0.01, NA, Volume)) %>%
#   mutate(Density = Larv_per_jar/Volume)
larv = larv %>%
dplyr::select(Ground,
id,
Date,
Survey.No,
No_jars,
Abundance,
Lengthmm,
category,
#MinLength,
#MaxLength,
#MeanLength,
SD,
Larv_per_jar,
Density,
Julian,
Day,
Month,
Year,
Condition,
Yolk_sac,
Preservative,
ARC_Count,
ARC_Notes,
Lon1,
Lat1,
Lon2,
Lat2,
TowTime,
AvgTowDepth,
MaxTowDepth,
CTDAvgTemp,
Volume,
TowID,
TowReplicate,
LengthAdjustment,
AdjustedSpawnDate,
AdjustedJulianSpawnDate,
MeanLengthAdjustment,
AdjustedMeanAgeInDays,
AdjustedMinDateOfSpawn,
AdjustedMaxDateOfSpawn
)
LarvalSum <- larv %>%
dplyr::select(Ground,
Date,
Year,
id,
TowReplicate,
TowID,
Survey.No,
Abundance,
Density,
Volume,
Preservative,
MeanLengthAdjustment,
AdjustedMeanAgeInDays,
AdjustedMinDateOfSpawn,
AdjustedMaxDateOfSpawn,
Lon1,
Lat1,
Lon2,
Lat2,
TowTime,
AvgTowDepth,
MaxTowDepth,
CTDAvgTemp,
Volume)
LarvalSum <- unique(LarvalSum)
