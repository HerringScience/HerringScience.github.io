Tag$Year = as.factor(Tag$Year)
Tag$Vessel = as.factor(Tag$Vessel)
Tag$Survey = as.factor(Tag$Survey)
Tag$Tagger = as.factor(Tag$Tagger)
#CTD Data
SST = read_csv("CTD SST.csv") #SST
polysT = read_csv("timGrounds.csv") #coloured ground maps
CTD = read_csv("CTD Full.csv") #All Data
atDepth = read_csv("CTD 30m.csv") #At 30m Depth > This one contains all Stratified Temp + Salinity data as well
SST$Year <- as.factor(SST$Year)
SST$Month <- as.factor(SST$Month)
atDepth$Year <- as.factor(atDepth$Year)
atDepth$Month <- as.factor(atDepth$Month)
CTD$Year <- as.factor(CTD$Year)
CTD$Month <- as.factor(CTD$Month)
CTD$Survey <- as.factor(CTD$Survey)
CTD <- CTD %>%
mutate(Julian_factor = Julian)
CTD$Julian_factor <- as.factor(CTD$Julian_factor)
#SSB Data
SSB = read_csv("SSB Estimates.csv")
SSB$Year <- as.factor(SSB$Year)
SSB$Survey_Number <- as.factor(SSB$Survey_Number)
SSB$Ground <- as.factor(SSB$Ground)
#LRP Data
LRP2 = read_csv("LRP Data.csv")
LRP2 = LRP2 %>% rename(ThreeYear = "3yr Avg")
#Fat Data
FatData = read_csv("Total Fat Data.csv")
#Larval Data
#All Adjusted Ages and Dates are originally added in Larval QC script.
#All preservative length adjustments added in in Larval QC script.
#Changed code within compendium from Lengthmm to LengthAdjustment
Larval = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/Full Larval Jan 2025.csv"))
LarvalSum = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/LarvalSum Jan 2025.csv"))
LarvalSum$Year <- as.factor(LarvalSum$Year)
Larval$Date <- lubridate::ymd(Larval$Date)
Larval <- dplyr::arrange(Larval, Date)
Larval$Year <- as.factor(Larval$Year)
Larval$category <- as.factor(Larval$category)
Larval$Survey.No <- as.factor(Larval$Survey.No)
Larval$MonthDay <- format(Larval$Date, "%m-%d")
#Fix this
#Larval$AdjustedJulianSpawnDate <- as.numeric(Larval$AdjustedJulianSpawnDate) #AdjustedJulianSpawnDate is the median of the min and the max spawn date provided.
#Changed to X and Y to fit in better with compendium code. These are the tow start and finish coordinates.
names(Larval)[names(Larval) =="Lon1"] <- "X"
names(Larval)[names(Larval) =="Lat1"] <- "Y"
names(Larval)[names(Larval) =="Lon2"] <- "Xend"
names(Larval)[names(Larval) =="Lat2"] <- "Yend"
#Seal Island Larval
LarvalSI = filter(Larval, Ground == "SI")
LarvalSI = merge(LarvalSI, LarvalSum[,c("id", "TowReplicate", "TowID")], by = "id")
Larval = merge(Larval, LarvalSum[,c("id", "TowReplicate", "TowID")], by = "id")
#options(geodata_default_path = "c:/you/geodata/path")
#Land Data
#can<-getData('GADM', country="CAN", level=1) #getData is discontinued
can<-gadm(country='CAN', level=1, path = "geodata_default_path",version="latest", resolution = 1, regions = c("New Brunswick", "Nova Scotia", "Prince Edward Island", "Newfoundland and Labrador", "Québec"))
#us = getData('GADM', country = "USA", level = 1) # getData is discontinued
us<-gadm(country='USA', level=1, path = "geodata_default_path",version="latest", resolution = 1, regions = c("Maine"))
can1 = rbind(can,us)
NBNS = can1
#NBNS <- can1[can1@data$NAME_1%in%c("New Brunswick","Nova Scotia","Prince Edward Island","Newfoundland and Labrador","Québec", "Maine"),]
NBNS <- as(NBNS, "Spatial") #This causes it to run very slowly - takes a few minutes to process.
#Trying new map to run faster
#Import All Boxes
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Box Coordinates/"))
boxes = read.csv("surveyBoxes.csv")
# Scots Bay plankton and CTD box
SBplankton=boxes[which(boxes$Box == "SBPlanktonBox"), ]
SBCTD=boxes[which(boxes$Box == "SBocean"), ]
# Scots Bay
SUA = read.csv("polygon_SBEastern.csv")
polyEastern = as.PolySet(SUA, projection="LL")
SUA = read.csv("polygon_SBNorthern.csv")
polyNorthern = as.PolySet(SUA, projection="LL")
SUA = read.csv("polygon_SB.csv")
polySB_main = as.PolySet(SUA, projection="LL")
#German Bank CTD box
GBCTD=boxes[which(boxes$Box == "GBocean"), ]
# German Bank
SUA = read.csv("polygon_GB.csv")
polyGB = as.PolySet(SUA, projection="LL")
# Seal Island
SUA = read.csv("polygon_SI.csv")
polySI = as.PolySet(SUA, projection="LL")
# can<-getData('GADM', country="CAN", level=1)
# us = getData('GADM', country = "USA", level = 1)
# can1 = rbind(can,us)
# NBNS <- can1[can1@data$NAME_1%in%c("New Brunswick","Nova Scotia","Prince Edward Island","Newfoundland and Labrador","Québec", "Maine", "New Hampshire", "Massachusetts", "Connecticut", "Rhode Island", "New York", "Vermont", "New Jersey"),]
# CP <- as(extent(-73, -61, 40.5, 46), "SpatialPolygons")
# proj4string(CP) <- CRS(proj4string(NBNS))
# out <- crop(NBNS, CP, byid=TRUE)
FatData$Fat <- as.numeric(FatData$Fat)
strpal <- colorNumeric(
palette = "Reds",
domain = FatData$Fat)
FatDataSum = FatData %>%
group_by(Date, Lat, Lon) %>%
summarize(Fat = mean(Fat))
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds()# %>%
FatDataSum = FatData %>%
group_by(Date, Lat, Lon) %>%
summarize(Fat = mean(Fat))
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
#addLegend("bottomright", pal = pal, values = ~Fat,
addLegend("bottomright", labels = (FatData$Fat), colors = (FatData$Fat), values = FatData$Fat,
scale_colour_continuous(),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", pal = pal, values = ~Fat,
#addLegend("bottomright", labels = (FatData$Fat), colors = (FatData$Fat), values = FatData$Fat,
scale_colour_continuous(),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", pal = pal, values = ~Fat,
#addLegend("bottomright", labels = (FatData$Fat), colors = (FatData$Fat), values = FatData$Fat,
scale_colour_continuous(),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
#addLegend("bottomright", pal = pal, values = ~Fat,
addLegend("bottomright", labels = (FatData$Fat), colors = (FatData$Fat), values = FatData$Fat,
scale_colour_continuous(),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
#addLegend("bottomright", pal = pal, values = ~Fat,
addLegend("bottomright", labels = FatData$Fat, colors = FatData$Fat, values = FatData$Fat,
scale_colour_continuous(),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
FatDataSum = FatData %>%
group_by(Date, Lat, Lon) %>%
summarize(Fat = mean(Fat))
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", pal = pal, values = ~Fat,
# addLegend("bottomright", labels = FatData$Fat, colors = FatData$Fat, values = FatData$Fat,
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", pal, values = ~Fat,
# addLegend("bottomright", labels = FatData$Fat, colors = FatData$Fat, values = FatData$Fat,
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", values = ~Fat,
# addLegend("bottomright", labels = FatData$Fat, colors = FatData$Fat, values = FatData$Fat,
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
#addLegend("bottomright", pal = pal, values = ~Fat,
addLegend("bottomright", labels = FatData$Fat, colors = FatData$Fat, values = FatData$Fat,
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
#addLegend("bottomright", pal = pal, values = ~Fat,
addLegend("bottomright", labels = scale_continuous(FatData$Fat), colors = FatData$Fat, values = FatData$Fat,
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
#addLegend("bottomright", pal = pal, values = ~Fat,
addLegend("bottomright", labels = scale_x_continuous(FatData$Fat), colors = FatData$Fat, values = FatData$Fat,
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
View(FatDataSum)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
#addLegend("bottomright", pal = pal, values = ~Fat,
addLegend("bottomright", labels = FatData$Fat, colors = FatDataSum$Fat, values = FatDataSum$Fat,
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
#addLegend("bottomright", pal = pal, values = ~Fat,
addLegend(FatDataSum, "bottomright", labels = FatData$Fat, colors = FatDataSum$Fat, values = FatDataSum$Fat,
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
#addLegend("bottomright", pal = pal, values = ~Fat,
addLegend( "bottomright", labels = FatData$Fat, colors = FatDataSum$Fat, values = FatDataSum$Fat,
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
#addLegend("bottomright", pal = pal, values = ~Fat,
addLegend( "bottomright", labels = FatDataSum$Fat, colors = FatDataSum$Fat, values = FatDataSum$Fat,
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
#addLegend("bottomright", pal = pal, values = ~Fat,
addLegend( "bottomright", labels = FatDataSum$Fat, colors = FatDataSum$Fat, values = FatDataSum$Fat,
scale_fill_gradientn(),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
#addLegend("bottomright", pal = pal, values = ~Fat,
addLegend( "bottomright", labels = FatDataSum$Fat, colors = FatDataSum$Fat, values = FatDataSum$Fat,
scale_fill_gradientn(colours = "Reds"),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
str(FatDataSum)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", pal = pal, values = ~Fat,
scale_fill_gradientn(colours = "Reds"),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", pal = pal, values = ~Fat,
scale_fill_gradientn(colours = "Reds"),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
FatDataSum = FatData %>%
group_by(Date, Lat, Lon) %>%
summarize(Fat = mean(Fat))
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~palette(Fat), popup = ~as.character(Fat)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", pal = pal, values = ~Fat,
scale_fill_gradientn(colours = "Reds"),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
strpal <- colorNumeric(
pal = "Reds",
domain = FatData$Fat)
FatDataSum = FatData %>%
group_by(Date, Lat, Lon) %>%
summarize(Fat = mean(Fat))
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", pal = pal, values = ~Fat,
scale_fill_gradientn(colours = "Reds"),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
strpal <- colorNumeric(
palette = "Reds",
domain = FatData$Fat)
strpal <- colorNumeric(
palette = "Reds",
domain = FatDataSum$Fat)
FatDataSum = FatData %>%
group_by(Date, Lat, Lon) %>%
summarize(Fat = mean(Fat))
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
# addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", pal = pal, values = ~Fat,
scale_fill_gradientn(colours = "Reds"),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
# strpal <- colorNumeric(
pal <- colorNumeric(
palette = "Reds",
domain = FatData$Fat)
FatDataSum = FatData %>%
group_by(Date, Lat, Lon) %>%
summarize(Fat = mean(Fat))
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
#addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", pal = pal, values = ~Fat,
scale_fill_gradientn(colours = "Reds"),
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
pal <- colorNumeric(
palette = "Reds",
domain = FatData$Fat)
# strpal <- colorNumeric(
pal <- colorNumeric(
palette = "Reds",
domain = FatData$Fat)
FatDataSum = FatData %>%
group_by(Date, Lat, Lon) %>%
summarize(Fat = mean(Fat))
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", pal = pal, values = ~Fat,
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
# can<-getData('GADM', country="CAN", level=1)
# us = getData('GADM', country = "USA", level = 1)
# can1 = rbind(can,us)
# NBNS <- can1[can1@data$NAME_1%in%c("New Brunswick","Nova Scotia","Prince Edward Island","Newfoundland and Labrador","Québec", "Maine", "New Hampshire", "Massachusetts", "Connecticut", "Rhode Island", "New York", "Vermont", "New Jersey"),]
# CP <- as(extent(-73, -61, 40.5, 46), "SpatialPolygons")
# proj4string(CP) <- CRS(proj4string(NBNS))
# out <- crop(NBNS, CP, byid=TRUE)
FatData$Fat <- as.numeric(FatData$Fat)
pal <- colorNumeric(
palette = "Reds",
domain = FatData$Fat)
FatDataSum = FatData %>%
group_by(Date, Lat, Lon) %>%
summarize(Fat = mean(Fat))
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>%
addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
clearBounds() %>%
addLegend("bottomright", pal = pal, values = ~Fat,
title = "Fat Percent (%)",
labFormat = labelFormat(suffix = "%"),
opacity = 1)
for(i in unique(FatData$Year)) {
cat("\n")
cat("######", i, "\n")
cat("\n")
FatData1 = FatData %>% filter(Month == 1)
print(FatData1 %>%
ggplot(aes(x=Lon, y=Lat)) +
geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
scale_color_viridis_c(direction=-1) +
geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
coord_map() +
theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))
cat("\n")
}
for(i in unique(FatData$Year)) {
cat("\n")
cat("######", i, "\n")
cat("\n")
FatData1 = FatData %>% filter(Month == 2)
print(FatData1 %>%
ggplot(aes(x=Lon, y=Lat)) +
geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
scale_color_viridis_c(direction=-1) +
geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
coord_map() +
theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))
cat("\n")
}
for(i in unique(FatData$Year)) {
cat("\n")
cat("######", i, "\n")
cat("\n")
FatData1 = FatData %>% filter(Month == 3)
print(FatData1 %>%
ggplot(aes(x=Lon, y=Lat)) +
geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
scale_color_viridis_c(direction=-1) +
geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
coord_map() +
theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))
cat("\n")
}
```{r, results = "asis", fig.align='center', fig.width = 14}
for(i in unique(FatData$Year)) {
cat("\n")
cat("######", i, "\n")
cat("\n")
FatData1 = FatData %>% filter(Month == 4)
print(FatData1 %>%
ggplot(aes(x=Lon, y=Lat)) +
geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
scale_color_viridis_c(direction=-1) +
geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
coord_map() +
theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))
cat("\n")
}
for(i in unique(FatData$Year)) {
cat("\n")
cat("######", i, "\n")
cat("\n")
FatData1 = FatData %>% filter(Month == 5)
print(FatData1 %>%
ggplot(aes(x=Lon, y=Lat)) +
geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
scale_color_viridis_c(direction=-1) +
geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
coord_map() +
theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))
cat("\n")
}
for(i in unique(FatData$Year)) {
cat("\n")
cat("######", i, "\n")
cat("\n")
FatData1 = FatData %>% filter(Month == 6)
print(FatData1 %>%
ggplot(aes(x=Lon, y=Lat)) +
geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
scale_color_viridis_c(direction=-1) +
geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
coord_map() +
theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))
cat("\n")
}
# can<-getData('GADM', country="CAN", level=1)
# us = getData('GADM', country = "USA", level = 1)
# can1 = rbind(can,us)
# NBNS <- can1[can1@data$NAME_1%in%c("New Brunswick","Nova Scotia","Prince Edward Island","Newfoundland and Labrador","Québec", "Maine", "New Hampshire", "Massachusetts", "Connecticut", "Rhode Island", "New York", "Vermont", "New Jersey"),]
CP <- as(extent(-73, -61, 40.5, 46), "SpatialPolygons")
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)
