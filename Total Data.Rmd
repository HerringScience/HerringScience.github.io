---
title: "HSC Data Compendium"
date: "`r Sys.Date()`"
output:
  rmdformats::html_clean:
    highlight: kate
---

```{r setup, include=FALSE}
year= substr(Sys.Date(),1,4)
knitr::opts_knit$set(root.dir = paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/"))
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE, fig.align='center')
```

```{r Data Import, include=FALSE}
#Import all packages, CTD data, and land data

local({r <- getOption("repos")
       r["CRAN"] <- "https://cran.r-project.org" 
       options(repos=r)
})

#Packages
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/"))
library(ggplot2)
library(patchwork)
library(scales)
library(cli)
library(lubridate)
library(reprex)
library(tidyverse)
library(geosphere)
library(reshape2)
library(moderndive)
library(skimr)
library(ggridges)
#library(weathercan)
library(GGally)
library(psych)
library(raster)
library(PBSmapping)
#library(rgeos)
library(sf)
library(terra)
library(knitr)
library(kableExtra)
library(grid)
library(gridExtra)
library(cowplot)
library(DT)
library(dygraphs)
library(leaflet)
library(rmapshaper)
library(plotly)
library(mapproj)
library(oce) #new CTD Data package
library(pander)
library(geodata)
library(pacman)
library(rnaturalearth)
library(rnaturalearthdata)
library(raster)
library(devtools)
library(maps)
library(dplyr)
devtools::install_github("ropensci/rnaturalearthhires")

install.packages('GADMTools')
install.packages("Rtools44")


state_prov <- rnaturalearth::ne_states(c("united states of america", "canada"))

#Survey Data
surveyData <- read_csv("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Main Data/Survey Data.csv")

#Tagging Data
Tag = read_csv("TaggingEvents.csv") #Tagging Data
polysT = read_csv("timGrounds.csv") #Coloured ground maps
Tag$Year = as.factor(Tag$Year)
Tag$Vessel = as.factor(Tag$Vessel)
Tag$Survey = as.factor(Tag$Survey)
Tag$Tagger = as.factor(Tag$Tagger)

#CTD Data
SST = read_csv("CTD SST.csv") #SST
polysT = read_csv("timGrounds.csv") #coloured ground maps
CTD = read_csv("CTD Full.csv") #All Data
atDepth = read_csv("CTD 30m.csv") #At 30m Depth > This one contains all Stratified Temp + Salinity data as well
SST$Year <- as.factor(SST$Year)
SST$Month <- as.factor(SST$Month)
atDepth$Year <- as.factor(atDepth$Year)
atDepth$Month <- as.factor(atDepth$Month)
CTD$Year <- as.factor(CTD$Year)
CTD$Month <- as.factor(CTD$Month)
CTD$Survey <- as.factor(CTD$Survey)
CTD <- CTD %>%
  mutate(Julian_factor = Julian)
CTD$Julian_factor <- as.factor(CTD$Julian_factor)

#SSB Data
SSB = read_csv("SSB Estimates.csv")
SSB$Year <- as.factor(SSB$Year)
SSB$Survey_Number <- as.factor(SSB$Survey_Number)
SSB$Ground <- as.factor(SSB$Ground)

#LRP Data
LRP2 = read_csv("LRP Data.csv")
LRP2 = LRP2 %>% rename(ThreeYear = "3yr Avg")

#Fat Data
FatData = read_csv("Total Fat Data.csv")

#Larval Data
#All Adjusted Ages and Dates are originally added in Larval QC script.
#All preservative length adjustments added in in Larval QC script.
#Changed code within compendium from Lengthmm to LengthAdjustment

Larval = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/Full Larval Jan 2025.csv"))
LarvalSum = read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Main Data/LarvalSum Jan 2025.csv"))
LarvalSum$Year <- as.factor(LarvalSum$Year)

Larval$Date <- lubridate::ymd(Larval$Date)
  Larval <- dplyr::arrange(Larval, Date)
Larval$Year <- as.factor(Larval$Year)
Larval$category <- as.factor(Larval$category)
Larval$Survey.No <- as.factor(Larval$Survey.No)
Larval$MonthDay <- format(Larval$Date, "%m-%d")

#Fix this
#Larval$AdjustedJulianSpawnDate <- as.numeric(Larval$AdjustedJulianSpawnDate) #AdjustedJulianSpawnDate is the median of the min and the max spawn date provided.

#Changed to X and Y to fit in better with compendium code. These are the tow start and finish coordinates.

names(Larval)[names(Larval) =="Lon1"] <- "X"
names(Larval)[names(Larval) =="Lat1"] <- "Y"
names(Larval)[names(Larval) =="Lon2"] <- "Xend"
names(Larval)[names(Larval) =="Lat2"] <- "Yend"

#Seal Island Larval
LarvalSI = filter(Larval, Ground == "SI")
LarvalSI = merge(LarvalSI, LarvalSum[,c("id", "TowReplicate", "TowID")], by = "id")



Larval = merge(Larval, LarvalSum[,c("id", "TowReplicate", "TowID")], by = "id")

#options(geodata_default_path = "c:/you/geodata/path")
#Land Data
#can<-getData('GADM', country="CAN", level=1) #getData is discontinued
can<-gadm(country='CAN', level=1, path = "geodata_default_path",version="latest", resolution = 1, regions = c("New Brunswick", "Nova Scotia", "Prince Edward Island", "Newfoundland and Labrador", "Québec"))
#us = getData('GADM', country = "USA", level = 1) # getData is discontinued
us<-gadm(country='USA', level=1, path = "geodata_default_path",version="latest", resolution = 1, regions = c("Maine"))
can1 = rbind(can,us)
NBNS = can1


#NBNS <- can1[can1@data$NAME_1%in%c("New Brunswick","Nova Scotia","Prince Edward Island","Newfoundland and Labrador","Québec", "Maine"),]
NBNS <- as(NBNS, "Spatial") #This causes it to run very slowly - takes about 20 minutes to process.


#For Tag Returns


completeReturns <- read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Tag Returns/complete.returns.csv"))
TaggingEvents <- read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/TaggingEvents.csv"))
    # TaggingEvents <- TaggingEvents %>%  
    #      rename(Tag_Num = TAG_NUMBER)

names(TaggingEvents)[names(TaggingEvents) == 'Tag_Num'] <- 'TAG_NUMBER'

rawReturn <- read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Tag Returns/rawReturn.csv"))
relINFO <- read_csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Tag Returns/relINFO.csv"))
polysNAFO <- read_csv(paste0("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Main Data/NAFO_subunits.csv"))
polysT <- read_csv(paste0("C:/Users/herri/Documents/GitHub/HerringScience.github.io/Main Data/timGrounds.csv"))

                           
#Combining complete Returns and Tagging events by tag number
TagReturns <- merge(TaggingEvents, completeReturns, by = "TAG_NUMBER")




# Assigning of Grounds

area1=polysT[which(polysT$Box == "NB Coastal"), ]
area2=polysT[which(polysT$Box == "Grand Manan"), ]
area3=polysT[which(polysT$Box == "Grand Manan Banks"), ]
area4=polysT[which(polysT$Box == "Long Island"), ]
area5=polysT[which(polysT$Box == "German Bank"), ]
area6=polysT[which(polysT$Box == "Seal Island"), ]
area7=polysT[which(polysT$Box == "Scots Bay"), ]
area8=polysT[which(polysT$Box == "Yankee Bank"), ]
area9=polysT[which(polysT$Box == "Trinity"), ]
area10=polysT[which(polysT$Box == "Browns Bank"), ]
area11=polysT[which(polysT$Box == "SW Grounds"), ]
area12=polysT[which(polysT$Box == "Gannet Dry Ledge"), ]
area13=polysT[which(polysT$Box == "Lurcher"), ]


ids = (TaggingEvents$TAG_NUMBER)
r = data.frame( TAG_NUMBER=ids, 
                X = NA, 
                Y = NA, 
                NB_Coastal = NA, 
                Grand_Manan = NA, 
                Grand_Manan_Banks = NA,
                Long_Island = NA, 
                German_Bank = NA, 
                Seal_Island = NA, 
                Scots_Bay = NA,
                Yankee_Bank = NA,
                Trinity = NA,
                Browns_Bank = NA,
                SW_Grounds = NA,
                Gannet_Dry_Ledge = NA,
                Lurcher = NA) 


#This part takes a really long time to run.

# Assigning fishing grounds to sets. This takes  a few minutes to run through.
for (i in 1:nrow(r)){
  test = which(TaggingEvents$TAG_NUMBER==r[i, "TAG_NUMBER"])
  test1 = TaggingEvents[test, ]
  r$Y[i] = test1$Lat
  r$X[i] = test1$Lon
  r$NB_Coastal[i] = point.in.polygon(r$Y[i], r$X[i], area1$Y, area1$X, mode.checked=FALSE)
  r$Grand_Manan[i] = point.in.polygon(r$Y[i], r$X[i], area2$Y, area2$X, mode.checked=FALSE)
  r$Grand_Manan_Banks[i] = point.in.polygon(r$Y[i], r$X[i], area3$Y, area3$X, mode.checked=FALSE)
  r$Long_Island[i] = point.in.polygon(r$Y[i], r$X[i], area4$Y, area4$X, mode.checked=FALSE)
  r$German_Bank[i] = point.in.polygon(r$Y[i], r$X[i], area5$Y, area5$X, mode.checked=FALSE)
  r$Seal_Island[i] = point.in.polygon(r$Y[i], r$X[i], area6$Y, area6$X, mode.checked=FALSE)
  r$Scots_Bay[i] = point.in.polygon(r$Y[i], r$X[i], area7$Y, area7$X, mode.checked=FALSE)
  r$Yankee_Bank[i] = point.in.polygon(r$Y[i], r$X[i], area8$Y, area8$X, mode.checked=FALSE)
  r$Trinity[i] = point.in.polygon(r$Y[i], r$X[i], area9$Y, area9$X, mode.checked=FALSE)
  r$Browns_Bank[i] = point.in.polygon(r$Y[i], r$X[i], area10$Y, area10$X, mode.checked=FALSE)
  r$SW_Grounds[i] = point.in.polygon(r$Y[i], r$X[i], area11$Y, area11$X, mode.checked=FALSE)
  r$Gannet_Dry_Ledge[i] = point.in.polygon(r$Y[i], r$X[i], area12$Y, area12$X, mode.checked=FALSE)
  r$Lurcher[i] = point.in.polygon(r$Y[i], r$X[i], area13$Y, area13$X, mode.checked=FALSE)
  
}


# Ground                        
r$FishingGround = NA        
         
r$FishingGround = with(r, ifelse(r$NB_Coastal > 0, "NB Coastal",
                          ifelse(r$Grand_Manan > 0, "Grand Manan",
                          ifelse(r$Grand_Manan_Banks > 0, "Grand Manan Banks",
                          ifelse(r$Long_Island > 0, "Long Island", 
                           ifelse(r$German_Bank > 0, "German Bank", 
                          ifelse(r$Seal_Island > 0, "Seal Island",
                          ifelse(r$Scots_Bay > 0, "Scots Bay",
                          ifelse(r$Yankee_Bank > 0, "Yankee Bank",
                          ifelse(r$Trinity > 0, "Trinity",
                          ifelse(r$Browns_Bank > 0, "Brown Bank",
                          ifelse(r$SW_Grounds > 0, "SW Grounds",
                          ifelse(r$Gannet_Dry_Ledge > 0, "Gannet Dry Ledge",
                          ifelse(r$Lurcher > 0, "Lurcher", 
                                                "Other"))))))))))))))

TaggingEvents <- merge(TaggingEvents, r[, c("TAG_NUMBER", "FishingGround")], by = "TAG_NUMBER")
#TaggingSubset <- TaggingEvents[sample(1:nrow(TaggingEvents), 25, replace = FALSE),]


#Combining complete Returns and Tagging events by tag number
TagReturns <- merge(TaggingEvents, completeReturns, by = "TAG_NUMBER")

# Histogram showing average time differences between tagging in Days. Split into categories.
# Category 1 = 0 to 2 days. These should mostly be removed from analysis due to them being caught almost instantly.
# Category 2 = 3 to 10 days. This is the period that the survey window covers.
# Cat. 3 = 11 to 30 days. Rest of the first month.
# Cat. 4 = 31 to 183 days. Caught after the first month, before the 6 month mark.
# Cat. 5 = 184 to 365. Minimum time of 6 months between tagging event and being recaptured.
# Cat. 6 = 366 to 730. Caught a minimum of a year, up to two years after the tagging event.
# Cat. 7 = Anything after two years since tagging event.

TagReturns$timeDifference <- TagReturns$DATE - TagReturns$Date
  TagReturns$timeDifference <- as.numeric(TagReturns$timeDifference)
  TagReturns <- TagReturns[TagReturns$timeDifference >= 0,]
TagReturns$category = with(TagReturns, ifelse(TagReturns$timeDifference < 3, 1,
                                       ifelse(TagReturns$timeDifference < 11 & TagReturns$timeDifference >= 3, 2,
                                       ifelse(TagReturns$timeDifference < 31 & TagReturns$timeDifference >= 11, 3,
                                       ifelse(TagReturns$timeDifference < 184 & TagReturns$timeDifference >= 31, 4,
                                       ifelse(TagReturns$timeDifference < 366 & TagReturns$timeDifference >= 184, 5,
                                       ifelse(TagReturns$timeDifference < 731 & TagReturns$timeDifference >= 366, 6,
                                       ifelse(TagReturns$timeDifference < 1095 & TagReturns$timeDifference >= 731, 7, 8))))))))
                                                   
  
TagReturns$category <- as.numeric(TagReturns$category)
TagReturns$Count <- 1



```

```{r Box Import}
#Import All Boxes
setwd(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Box Coordinates/"))
boxes = read.csv("surveyBoxes.csv")

# Scots Bay plankton and CTD box
SBplankton=boxes[which(boxes$Box == "SBPlanktonBox"), ]
SBCTD=boxes[which(boxes$Box == "SBocean"), ]

# Scots Bay
SUA = read.csv("polygon_SBEastern.csv")
polyEastern = as.PolySet(SUA, projection="LL")

SUA = read.csv("polygon_SBNorthern.csv")
polyNorthern = as.PolySet(SUA, projection="LL")

SUA = read.csv("polygon_SB.csv")
polySB_main = as.PolySet(SUA, projection="LL")

#German Bank CTD box
GBCTD=boxes[which(boxes$Box == "GBocean"), ]

# German Bank      
SUA = read.csv("polygon_GB.csv")
polyGB = as.PolySet(SUA, projection="LL")

# Seal Island      
SUA = read.csv("polygon_SI.csv")
polySI = as.PolySet(SUA, projection="LL")
```

# {.tabset}

## SSB Estimates

### LRP Data {.tabset}

#### Total

```{r echo=FALSE}
LRP2 %>% dplyr::select(Year, Biomass, LRP, ThreeYear) %>%
  dygraph(ylab = "Biomass (mt)", xlab = "Year") %>%
  dyOptions(drawPoints = TRUE, pointSize = 2) %>%
  dyHighlight(highlightCircleSize = 5, 
              highlightSeriesBackgroundAlpha = 0.8,
              hideOnMouseOut = FALSE)
```

```{r echo=FALSE}
LRP3 = LRP2 %>%
  dplyr::select(Year, Scots, German, Seal, Biomass, LRP, ThreeYear="ThreeYear") %>%
  mutate(Difference = ThreeYear-LRP)

LRP3 %>% arrange(desc(Year)) %>%
  datatable(colnames = c("Year", "Scots Bay", "German Bank", "Seal Isl.", "Biomass (mt)", "LRP", "3yr Avg", "Difference"),
  extensions = 'Buttons',
  options = list(
  pageLength = 5,
  dom = 'lfrtiBp', 
  buttons = c('copy', 'csv', 'excel', 'pdf', 'print'))) %>%
  formatStyle(columns = "Difference", color = styleInterval(cuts = 0, values = c("red", "green")))
```

#### Scots Bay

```{r}
LRP3 %>% dplyr::select(Year, Scots) %>% 
  dygraph(ylab = "Biomass (mt)", xlab = "Year") %>%
  dyOptions(drawPoints = TRUE, pointSize = 2) %>%
  dyHighlight(highlightCircleSize = 5, 
              highlightSeriesBackgroundAlpha = 0.8,
              hideOnMouseOut = FALSE)
```

```{r echo=FALSE}
LRP3 %>%
  dplyr::select(Year, Scots) %>%
  arrange(desc(Year)) %>%
  datatable(colnames = c("Year", "Scots Bay"),
          extensions = 'Buttons',
          options = list(
            pagelength = 5,
            dom = 'lfrtiBp',
            buttons = c('copy', 'csv', 'excel', 'pdf', 'print')))
```

#### German Bank

```{r}
LRP3 %>% dplyr::select(Year, German) %>% 
  dygraph(ylab = "Biomass (mt)", xlab = "Year") %>%
  dyOptions(drawPoints = TRUE, pointSize = 2) %>%
  dyHighlight(highlightCircleSize = 5, 
              highlightSeriesBackgroundAlpha = 0.8,
              hideOnMouseOut = FALSE)
```

```{r echo=FALSE}
LRP3 %>%
  dplyr::select(Year, German, Seal) %>%
  arrange(desc(Year)) %>%
  datatable(colnames = c("Year", "German Bank", "Seal Isl."),
          extensions = 'Buttons',
          options = list(
            pagelength = 5,
            dom = 'lfrtiBp',
            buttons = c('copy', 'csv', 'excel', 'pdf', 'print')))
```

#### Seal Island

```{r}

LRP3 %>% filter(Year > 2017) %>%
  dplyr::select(Year, Seal) %>%
  dygraph(ylab = "Biomass (mt)", xlab = "Year") %>%
  #breaks=unique(as.integer("x")) %>% #use as as.integer for x axis to reformat to full years?
  dyOptions(drawPoints = TRUE, pointSize = 2, digitsAfterDecimal = 0) %>%
  dyHighlight(highlightCircleSize = 5, 
              highlightSeriesBackgroundAlpha = 0.8,
              hideOnMouseOut = FALSE)
```

```{r echo=FALSE}
LRP3 %>% filter(Year > 2017) %>%
  dplyr::select(Year, Seal) %>%
  arrange(desc(Year)) %>%
  datatable(colnames = c("Year", "Seal Isl."),
          extensions = 'Buttons',
          options = list(
            pagelength = 5,
            dom = 'lfrtiBp',
            buttons = c('copy', 'csv', 'excel', 'pdf', 'print')))
```


### Total SSB Summaries {.tabset}

#### Total

```{r echo=FALSE}
Plot_Summary = SSB %>%
  filter(Ground == "Scots Bay" | Ground == "German Bank" | Ground == "Seal Island") %>%
  filter(!is.na(DFO_Turnover_Adjusted)) %>%
  group_by(Year) %>%
  summarize(Biomass = sum(DFO_Turnover_Adjusted), na.rm = FALSE)

p = ggplot(data=Plot_Summary,  aes(x=Year, y=Biomass)) +
  geom_col(fill = "darkblue") +
  scale_y_continuous(labels=scales::comma) +
  labs(x="Year", y = "DFO Estimate w/ Turnover") +
  theme(axis.text.x = element_text(angle = 55), legend.position = "none")

ggplotly(p)
```

```{r echo=FALSE}
Table = SSB %>%
  filter(Ground == "Scots Bay" | Ground == "German Bank" | Ground == "Seal Island") %>%
  filter(!is.na(DFO_Turnover_Adjusted)) %>%
  group_by(Year) %>%
  summarize(HSC_Estimate = sum(HSC_Estimate),
            HSC_Turnover_Adjusted = sum(HSC_Turnover_Adjusted),
            DFO_Estmate = sum(DFO_Estimate),
            DFO_Turnover_Adjusted = sum(DFO_Turnover_Adjusted)) %>%
  arrange(desc(Year))

datatable(Table, 
          colnames = c("Year", "HSC Estimate", "HSC w/ Turnover", "DFO Estimate", "DFO w/ Turnover"), 
          extensions = 'Buttons',
  options = list(
  pageLength = 5,
  dom = 'lfrtiBp', 
  buttons = c('copy', 'csv', 'excel', 'pdf', 'print')))
```

#### Scots Bay

```{r echo=FALSE}
p = ggplot(data=subset(SSB, Ground == "Scots Bay"),  aes(x=Year, y=DFO_Turnover_Adjusted, fill= Survey_Number)) +
  geom_col() +
  scale_y_continuous(labels=scales::comma) +
  labs(x="Year", y = "DFO Estimate w/ Turnover") +
  theme(axis.text.x = element_text(angle = 55), legend.position = "none")

ggplotly(p)
```

```{r echo=FALSE}
Table = SSB %>%
  filter(Ground == "Scots Bay") %>%
  group_by(Year) %>%
  summarize(HSC_Estimate = sum(HSC_Estimate),
            HSC_Turnover_Adjusted = sum(HSC_Turnover_Adjusted),
            DFO_Estmate = sum(DFO_Estimate),
            DFO_Turnover_Adjusted = sum(DFO_Turnover_Adjusted)) %>%
  ungroup() %>%
  arrange(desc(Year))

datatable(Table, colnames = c("Year", "HSC Estimate", "HSC w/ Turnover", "DFO Estimate", "DFO w/ Turnover"),
          extensions = 'Buttons',
  options = list(
  pageLength = 5,
  dom = 'lfrtiBp', 
  buttons = c('copy', 'csv', 'excel', 'pdf', 'print')))

```


#### German Bank

```{r echo=FALSE}
p = ggplot(data=subset(SSB, Ground == "German Bank"),  aes(x=Year, y=DFO_Turnover_Adjusted, fill= Survey_Number)) +
  geom_col() +
  scale_y_continuous(labels=scales::comma) +
  labs(x="Year", y = "DFO Estimate w/ Turnover") +
  theme(axis.text.x = element_text(angle = 55), legend.position = "none")

ggplotly(p)
```

```{r echo=FALSE}
Table = SSB %>%
  filter(Ground == "German Bank") %>%
  group_by(Year) %>%
  summarize(HSC_Estimate = sum(HSC_Estimate),
            HSC_Turnover_Adjusted = sum(HSC_Turnover_Adjusted),
            DFO_Estmate = sum(DFO_Estimate),
            DFO_Turnover_Adjusted = sum(DFO_Turnover_Adjusted)) %>%
  ungroup() %>%
  arrange(desc(Year))

datatable(Table, colnames = c("Year", "HSC Estimate", "HSC w/ Turnover", "DFO Estimate", "DFO w/ Turnover"),
          extensions = 'Buttons',
  options = list(
  pageLength = 5,
  dom = 'lfrtiBp', 
  buttons = c('copy', 'csv', 'excel', 'pdf', 'print')))
```

#### Seal Island

```{r echo=FALSE}
p = ggplot(data=subset(SSB, Ground == "Seal Island"),  aes(x=Year, y=DFO_Turnover_Adjusted, fill= Survey_Number)) +
  geom_col() +
  scale_y_continuous(labels=scales::comma) +
  labs(x="Year", y = "DFO Estimate w/ Turnover") +
  theme(axis.text.x = element_text(angle = 55), legend.position = "none")

ggplotly(p)
```

```{r echo=FALSE}
Table = SSB %>%
  filter(Ground == "Seal Island") %>%
  group_by(Year) %>%
  summarize(HSC_Estimate = sum(HSC_Estimate),
            HSC_Turnover_Adjusted = sum(HSC_Turnover_Adjusted),
            DFO_Estmate = sum(DFO_Estimate),
            DFO_Turnover_Adjusted = sum(DFO_Turnover_Adjusted)) %>%
  ungroup() %>%
  arrange(desc(Year))

datatable(Table, colnames = c("Year", "HSC Estimate", "HSC w/ Turnover", "DFO Estimate", "DFO w/ Turnover"),
          extensions = 'Buttons',
  options = list(
  pageLength = 5,
  dom = 'lfrtiBp', 
  buttons = c('copy', 'csv', 'excel', 'pdf', 'print')))


```


### Annual SSB Estimates {.tabset}

#### Scots Bay {.tabset .tabset-pills}

```{r, results = "asis", fig.align='center'}
DFOSSB = SSB %>% dplyr::select(Year, Ground, Survey_Number, DFO_Turnover_Adjusted)
for(i in unique(SSB$Year)) {
  cat("\n")
  cat("##### ", i, "\n")
  cat("\n")
  
  
print(ggplot(data=subset(SSB, Ground == "Scots Bay" & Year == i), aes(x=Survey_Number, y=DFO_Turnover_Adjusted, group=1)) +
  geom_point(stat='summary', fun.y=sum) +
  stat_summary(fun.y=sum, geo="line") +
  labs(x="Survey Number", y="DFO Biomass w/ Turnover"))
  cat("\n")
  print(kbl(x=subset(DFOSSB, Ground == "Scots Bay" & Year == i), align = "c", col.names = c("Year", "Ground", "Survey Number", "DFO (Turnover Adjusted)")) %>%
          kable_paper("striped", full_width = F))
  cat("\n")
}
```

#### German Bank {.tabset .tabset-pills}

```{r, results = "asis", fig.align='center'}
DFOSSB = SSB %>% dplyr::select(Year, Ground, Survey_Number, DFO_Turnover_Adjusted)
for(i in unique(SSB$Year)) {
  cat("\n")
  cat("##### ", i, "\n")
  cat("\n")
  
print(ggplot(data=subset(SSB, Ground == "German Bank" & Year == i), aes(x=Survey_Number, y=DFO_Turnover_Adjusted, group=1)) +
  geom_point(stat='summary', fun.y=sum) +
  stat_summary(fun.y=sum, geo="line") +
  labs(x="Survey Number", y="DFO Biomass w/ Turnover"))
  cat("\n")
  print(kbl(x=subset(DFOSSB, Ground == "German Bank" & Year == i), align = "c", col.names = c("Year", "Ground", "Survey Number", "DFO (Turnover Adjusted)")) %>%
          kable_paper("striped", full_width = F))
  cat("\n")
}
```

#### Seal Island {.tabset .tabset-pills}

```{r, results = "asis", fig.align='center'}
DFOSSB = SSB %>%
  dplyr::select(Year, Ground, Survey_Number, DFO_Turnover_Adjusted)

SSB1 <- subset(SSB, Year == 2018:2024 )
  
for(i in unique(SSB1$Year)) {
  cat("\n")
  cat("##### ", i, "\n")
  cat("\n")
  
  print(ggplot(data=subset(SSB, Ground == "Seal Island" & Year == i), aes(x=Survey_Number, y=DFO_Turnover_Adjusted, group=1)) +
  geom_point(stat='summary', fun.y=sum) +
  stat_summary(fun.y=sum, geo="line") +
  labs(x="Survey Number", y="DFO Biomass w/ Turnover"))
  cat("\n")
  print(kbl(x=subset(DFOSSB, Ground == "Seal Island" & Year == i), align = "c", col.names = c("Year", "Ground", "Survey Number", "DFO (Turnover Adjusted)")) %>%
          kable_paper("striped", full_width = F))
  cat("\n")
}
```
## Tagging Project

### Current Tag Data {.tabset}

#### Scots Bay {.tabset .tabset-pills}

```{r}
CP <- as(extent(-65.5, -64.5, 45, 45.5), "SpatialPolygons") #set boundaries for Scots Bay before plotting
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)
```

##### Total

```{r echo=FALSE}

Plot = Tag %>% subset(Ground == "Scots Bay" & Year == year) %>% group_by(Survey) %>% mutate(group2=paste0(Survey,", n=",length(Survey))) %>% ungroup() #Line for when using system year.
#Plot = Tag %>% subset(Ground == "Scots Bay" & Year == 2023) %>% group_by(Survey) %>% mutate(group2=paste0(Survey,", n=",length(Survey))) %>% ungroup() #Line for previous year when it does not match system year. Used for before the season starts.

ggplot(data = Plot, aes(x=Lon, y=Lat)) + 
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=polySB_main,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=SBplankton,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=SBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_polygon(data=polyNorthern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polyEastern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_point(aes(fill = group2), pch=21, size = 2) +
  coord_map() + 
  labs(x=NULL, y=NULL, fill="Survey, # of Tags")
```

```{r, results = "asis"}
Tag1 = Tag %>% 
  filter(Year == year & Ground == "Scots Bay") %>%
  arrange(Survey) %>%
  group_by(Vessel, Survey) %>%
  mutate(group2=paste0(Vessel, ", n=", length(Vessel))) %>%
  ungroup()

for(i in unique(Tag1$Survey)) {
  cat("\n")
  cat("##### Survey", i, "\n")
  cat("\n")
  
  print(ggplot(data = subset(Tag1, Survey == i), aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polySB_main,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=SBplankton,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=SBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_polygon(data=polyNorthern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polyEastern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_point(aes(fill = group2), pch=21, size = 2) +
  coord_map() + 
  labs(x=NULL, y=NULL, fill = "Vessel, # of Tags"))
  cat("\n")
}
```

#### German Bank {.tabset .tabset-pills}

```{r message=FALSE, warning=FALSE}
CP <- as(extent(-66.5, -65.5, 43, 44), "SpatialPolygons") #set boundaries for German Bank before plotting
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)
```

##### Total

```{r echo=FALSE, fig.align='center'}
Plot = Tag %>% subset(Ground == "German Bank" & Year == year) %>% group_by(Survey) %>% mutate(group2=paste0(Survey,", n=",length(Survey))) %>% ungroup() #To use when you are currently in a survey period
#Plot = Tag %>% subset(Ground == "German Bank" & Year == 2023) %>% group_by(Survey) %>% mutate(group2=paste0(Survey,", n=",length(Survey))) %>% ungroup() #Set previous survey year when you are between survey periods.

ggplot(data = Plot, aes(x=Lon, y=Lat)) + 
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=polyGB,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polySI,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=GBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_point(aes(fill = group2), pch=21, size = 2) +
  coord_map() + 
  labs(x=NULL, y=NULL, fill="Survey, # of Tags")
```

```{r, results = "asis"}
Tag1 = Tag %>% 
  filter(Year == year & Ground == "German Bank") %>%
  arrange(Survey) %>%
  group_by(Vessel, Survey) %>%
  mutate(group2=paste0(Vessel, ", n=", length(Vessel))) %>%
  ungroup()

for(i in unique(Tag1$Survey)) {
  cat("\n")
  cat("##### Survey", i, "\n")
  cat("\n")
  
  print(ggplot(data = subset(Tag1, Survey == i), aes(x=Lon, y=Lat)) + 
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=polyGB,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polySI,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=GBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_point(aes(fill = group2), pch=21, size = 2) +
  coord_map() + 
  labs(x=NULL, y=NULL, fill="Vessel, # of Tags"))
  cat("\n")
}
```

### Tag Summaries {.tabset}

#### Annual Summary

::: row
::: col-md-6
```{r echo=FALSE, message=FALSE, warning=FALSE}
#Reset spatial extent back to full view
CP <- as(extent(-69, -63, 42, 45.5), "SpatialPolygons")
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)

ggplot(data = subset(Tag, Lon < -64.1), aes(x=Lon, y=Lat)) + 
 geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") + 
 geom_polygon(data=out,aes(x=long, y=lat, group=group),fill='burlywood4',col='black') +
 geom_point(pch=21, size = 2, fill = "White") + 
 ggtitle("Tagging Locations") + 
 labs(x=NULL, y=NULL) + 
 coord_map() + 
 theme(panel.background = element_rect(fill = "grey68"))
```
:::

::: col-md-6
```{r}
Annual_Table = Tag %>%
  group_by(Year) %>%
  summarise(n=n()) %>%
  rename(Tags = n)

kbl(Annual_Table) %>%
  kable_paper("striped", full_width = F)
```
:::
:::

#### Tagger Summary

::: row
::: col-md-6
```{r echo=FALSE}
#Reset spatial extent back to full view
CP <- as(extent(-69, -61.5, 42, 45.5), "SpatialPolygons")
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)

ggplot(data = Tag, aes(x=Lon, y=Lat)) + 
 geom_polygon(data=out,aes(x=long, y=lat, group=group),fill='burlywood4',col='black') +
 geom_point(data = Tag, aes(fill = Tagger), pch=21, size = 2)+ 
  ggtitle("Tagging Locations") + 
 labs(x=NULL, y=NULL) + 
 coord_map() + 
 theme(panel.background = element_rect(fill = "grey68"))
```
:::

::: col-md-6
```{r}
Tagger_Table = Tag %>%
  group_by(Tagger) %>%
  summarise(Tag_Annual = mean(Tag_Annual)) %>%
  mutate_if(is.numeric, format, digits=1)

kbl(Tagger_Table, col.names = c("Tagger", "Average Tags/Year")) %>%
  kable_paper("striped", full_width = F)
```
:::
:::

### Tag Returns {.tabset}

Could show a table of annual return rates, a map of linked returns by year, etc.

Whatever summarized data the tagger tech has.

``` {css, echo = FALSE}
.scoll-100 {
max-height: 100px;
overflow-y: auto;
background-colour: inherit;
}

```

#### Average Time Difference Across All Grounds  {.tabset .tabset-fade .tabset-pills}


```{r, results = "asis", fig.align='center', class.output= "scoll-100"}

TagReturns = TagReturns %>%
  group_by(category) %>%
  mutate(AvgtimeDifference = mean(timeDifference)) %>%
  mutate(No.InCategory = length(category)) %>%
  mutate(timeDifferenceMin =min(timeDifference)) %>%
  mutate(timeDifferenceMax= max(timeDifference)) %>%
  mutate_if(is.numeric, format, digits = 2)

TagReturns$timeDifferenceMax <- factor(TagReturns$timeDifferenceMax, levels=c('2', '10', '30', '133', '365', '715', '743'))

ggplot(data = TagReturns, (aes(category, fill = timeDifferenceMax))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Category", y="Count") +
        scale_fill_discrete(name = "Max. number of days to recapture")

TagReturns = TagReturns %>%
  group_by(timeDifference) %>%
  mutate(No.ofSameNumberOfDays = length(timeDifference)) %>%
  mutate_if(is.numeric, format, digits = 2)


Table <- TagReturns %>% 
  dplyr::select(category,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(category)

 Table1 <- unique(Table) %>%
             arrange(category)

kbl(Table1, col.names=c("Category", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F) %>%
  kable_styling(full_width = F, fixed_thead = T, )

Table1 %>% write.csv(paste0("C:/Users/", Sys.info()[7],"/Documents/GitHub/HerringScience.github.io/Source Data/Tag Returns/tagReturnsTracey.csv"))

SummaryTable <- subset(Table1, select = -c(timeDifference, No.ofSameNumberOfDays))
 SummaryTable <- unique(SummaryTable) %>%
   arrange(category)
 
kbl(SummaryTable, col.names=c("Category", "Average Time Difference (days)", "Minimum Time Difference (Days)", "Maximum Time Difference (Days)", "Category Abundance"), align = "c")

Cat1 <- subset(TagReturns, category == "1")
Cat1 <- subset(Cat1, subset = (catchAREA == "German Bank" |
                               catchAREA == "German Bank (Area 7)" |
                               catchAREA == "Lurcher" |
                                 catchAREA == "NB Coastal" |
                                 catchAREA =="Grand Manan" |
                                 catchAREA == "Grand Manan Banks" |
                                 catchAREA =="Long Island"|
                                 catchAREA =="Seal Island"|
                                 catchAREA == "Scots Bay"|
                                 catchAREA =="Yankee Bank"|
                                 catchAREA =="Trinity"|
                                 catchAREA =="Brown Bank"|
                                 catchAREA =="SW Grounds"|
                                 catchAREA =="Gannet Dry Ledge" ))

ggplot(data = Cat1, (aes(FishingGround, fill = catchAREA))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tagging Ground", y="Count") +
        scale_fill_discrete(name = "Recapture area")


```

#### Scots Bay, German Bank and Seal Island Tags {.tabset .tabset-fade .tabset-pills}

##### Tag Returns between German Bank and Scots Bay

```{r, results = "asis", fig.align='center'}
#TagReturnsSubset <- TagReturns[sample(1:nrow(TagReturns), 100, replace = FALSE),]

GBtoSB <- subset(TagReturns, subset = (FishingGround == "Scots Bay" & catchAREA == "German Bank" |
                                       FishingGround == "German Bank" & catchAREA == "Scots Bay" |
                                       FishingGround == "Scots Bay" & catchAREA == "German Bank (Area 7)" |
                                       FishingGround == "German Bank" & catchAREA == "Scots Bay (Area 8)" ))


GBtoSB$TagLocation <- with(GBtoSB, ifelse(GBtoSB$FishingGround == "Scots Bay", "SB to GB",
                                          ifelse(GBtoSB$FishingGround == "German Bank", "GB to SB","Other")))

GBtoSB$timeDifference <- as.numeric(GBtoSB$timeDifference)

GBSB <- subset(GBtoSB, TagLocation == "GB to SB" )
#  GBSB$timeDifference <- as.numeric(GBSB$timeDifference)

SBGB <- subset(GBtoSB, TagLocation == "SB to GB")
#  SBGB$timeDifference <- as.numeric(GBSB$timeDifference)

ggplot(GBSB, aes(x=category, y = Count, fill = factor(timeDifference))) +
        geom_bar(stat="identity") +
        labs(y = "Number of Events", x = "Category") +
        ggtitle("Tag Returns that started in German Bank and were retrieved in Scots Bay") +
        labs(fill = "Days between tagging event and tag return")

TableGBSB <- GBSB %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)

kbl(TableGBSB, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- subset(TableGBSB, select = -c(timeDifference, Date, DATE,  No.ofSameNumberOfDays))
SummaryTable <- unique(SummaryTable) %>%
  arrange(category)

ggplot(SBGB, aes(x=category, y = Count, fill = factor(timeDifference))) +
        geom_bar(stat="identity") +
        labs(y = "Number of Events", x = "Category") +
        ggtitle("Tag Returns that started in Scots Bay and were retrieved in German Bank") +
        labs(fill = "Days between tagging event and tag return")


TableSBGB <- SBGB %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)

kbl(TableSBGB, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- subset(TableSBGB, select = -c(timeDifference, Date, DATE,  No.ofSameNumberOfDays))
SummaryTable <- unique(SummaryTable) %>%
  arrange(category)


```
##### Tag returns that started in either German Bank or Scots Bay

```{r, results = "asis", fig.align='center'}

# Missing GB to SB now, not sure why. When removing category 1 items for GB to SB show up. Possibly it's because there is more category difference when going from GB to SB, so it ends up not showing?

TagReturns$TagLocation <- with(TagReturns, ifelse(TagReturns$FishingGround == "Scots Bay" & TagReturns$catchAREA == "German Bank" |
                                                  TagReturns$FishingGround == "Scots Bay" & TagReturns$catchAREA == "German Bank (Area 7)"  , "SB to GB",
                                           ifelse(TagReturns$FishingGround == "German Bank" & TagReturns$catchAREA == "Scots Bay" |
                                                  TagReturns$FishingGround == "German Bank" & TagReturns$catchAREA == "Scots Bay (Area 8)", "GB to SB",
                                           ifelse(TagReturns$FishingGround == "German Bank" & TagReturns$catchAREA == "German Bank", "GB to GB",
                                           ifelse(TagReturns$FishingGround == "Scots Bay" & TagReturns$catchAREA == "Scots Bay", "SB to SB",
                                           ifelse(TagReturns$FishingGround == "Scots Bay" & TagReturns$catchAREA != "Scots Bay" | 
                                                  TagReturns$FishingGround == "Scots Bay" & TagReturns$catchAREA != "German Bank", "SB to Other",
                                           ifelse(TagReturns$FishingGround == "German Bank" & TagReturns$catchAREA != "Scots Bay" |
                                                  TagReturns$FishingGround == "German Bank" & TagReturns$catchAREA != "German Bank", "GB to Other", "Other")))))))

TagReturns1 <- subset(TagReturns, TagLocation != "Other")
TagReturns1 <- subset(TagReturns1, TagLocation != "SB to Other")
TagReturns1 <- subset(TagReturns1, TagLocation != "GB to Other")

ggplot(data = TagReturns1, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Category", y="Count")+
        scale_y_continuous(breaks= pretty_breaks())


Table <- TagReturns1 %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)


```
##### Tag Returns between German Bank and Seal Island

```{r, results = "asis", fig.align='center'}
TagReturnsGBSI <- subset(TagReturns, subset = (FishingGround == "German Bank" | FishingGround == "Seal Island"))
TagReturnsGBSI <- subset(TagReturnsGBSI, subset = (catchAREA == "German Bank") | catchAREA == "Seal Island" | catchAREA == "German Bank (Area 7)")

TagReturnsGBSI$TagLocation <- with(TagReturnsGBSI, ifelse(TagReturnsGBSI$FishingGround == "German Bank" & TagReturnsGBSI$catchAREA == "German Bank" |
                                                        TagReturnsGBSI$FishingGround == "German Bank" & TagReturnsGBSI$catchAREA == "German Bank (Area 7)", "GB to GB",
                                                 ifelse(TagReturnsGBSI$FishingGround == "German Bank" & TagReturnsGBSI$catchAREA == "Seal Island", "GB to SI", 
                                                 ifelse(TagReturnsGBSI$FishingGround == "Seal Island" & TagReturnsGBSI$catchAREA == "Seal Island", "SI to SI",
                                                 ifelse(TagReturnsGBSI$FishingGround == "Seal Island" & TagReturnsGBSI$catchAREA == "German Bank" |
                                                        TagReturnsGBSI$FishingGround == "Seal Island" & TagReturnsGBSI$catchAREA == "German Bank (Area 7)", "SI to GB", "Other")))))
                                                 
TagReturnsGBSI <- subset(TagReturnsGBSI, subset = (TagLocation == "GB to SI" | TagLocation == "SI to GB"))

ggplot(data = TagReturnsGBSI, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Category", y="Count") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsGBSI %>% 
  group_by(timeDifference) %>%
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays) %>%
  arrange(timeDifference)

kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

```


#### By Ground {.tabset .tabset-fade .tabset-pills}

##### German Bank 

```{r, results = "asis", fig.align='center'}
TagReturnsGB <- subset(TagReturns, subset = (FishingGround == "German Bank"))

TagReturnsGB$TagLocation <- with(TagReturnsGB, ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "German Bank" |
                                                      TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "German Bank (Area 7)", "GB to GB",
                                               ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "Scots Bay" |
                                                      TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "Scots Bay (Area 8)", "GB to SB",
                                               ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "NB Coastal", "GB to NBC",
                                               ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "Grand Manan", "GB to GM",
                                               ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "Grand Manan Banks", "GB to GMB",
                                               ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "Long Island", "GB to LI",
                                               ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "Seal Island", "GB to SI",
                                               ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "Yankee Bank", "GB to YB",
                                               ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "Trinity", "GB to T",
                                               ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "Browns Bank", "GB to BB",
                                               ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "SW Grounds", "GB to SWG",
                                               ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "Gannet Dry Ledge", "GB to GDL",
                                               ifelse(TagReturnsGB$FishingGround == "German Bank" & TagReturnsGB$catchAREA == "Lurcher", "GB to L","Other" ))))))))))))))


TagReturnsGB  <- subset(TagReturnsGB, TagLocation != "Other")

ggplot(data = TagReturnsGB, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Category", y="Count") +
        ggtitle("German Bank Tag Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsGB %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

#Removed category 1 larvae - any caught within 2 days of tagging.

TagReturnsGB <- subset(TagReturnsGB, subset = (category != "1"))


ggplot(data = TagReturnsGB, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(y = "Number of Events", x = "Tag to Catch Location") +
        ggtitle("German Bank Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsGB %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsGB %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)

```

##### NB Coastal

```{r, results = "asis", fig.align='center'}

#NB Coastal
TagReturnsNBC <- subset(TagReturns, subset = (FishingGround == "NB Coastal"))

TagReturnsNBC$TagLocation <- with(TagReturnsNBC, ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "German Bank" |
                                                        TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "German Bank (Area 7)", "NBC to GB",
                                                 ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "Scots Bay" |
                                                        TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "Scots Bay (Area 8)", "NBC to SB",
                                                 ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "NB Coastal", "NBC to NBC",
                                                 ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "Grand Manan", "NBC to GM",
                                                 ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "Grand Manan Banks", "NBC to GMB",
                                                 ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "Long Island", "NBC to LI",
                                                 ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "Seal Island", "NBC to SI",
                                                 ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "Yankee Bank", "NBC to YB",
                                                 ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "Trinity", "NBC to T",
                                                 ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "Browns Bank", "NBC to BB",
                                                 ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "SW Grounds", "NBC to SWG",
                                                 ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "Gannet Dry Ledge", "NBC to GDL",
                                                 ifelse(TagReturnsNBC$FishingGround == "NB Coastal" & TagReturnsNBC$catchAREA == "Lurcher", "NBC to L","Other"
                                                 ))))))))))))))

TagReturnsNBC  <- subset(TagReturnsNBC, TagLocation != "Other")

ggplot(data = TagReturnsNBC, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch location", y="Number of Events") +
        ggtitle("NB Coastal Tag Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsNBC %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)
 
#Removed category 1 larvae - any caught within 2 days of tagging.

TagReturnsNBC <- subset(TagReturnsNBC, subset = (category != "1"))

ggplot(data = TagReturnsNBC, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("NB Coastal Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())


Table <- TagReturnsNBC %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsNBC %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)

```

##### Grand Manan

```{r, results = "asis", fig.align='center'}

TagReturnsGM <- subset(TagReturns, subset = (FishingGround == "Grand Manan"))

TagReturnsGM$TagLocation <- with(TagReturnsGM, ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "German Bank" |
                                                      TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "German Bank (Area 7)", "GM to GB",
                                               ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "Scots Bay" |
                                                      TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "Scots Bay (Area 8)", "GM to SB",
                                               ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "NB Coastal", "GM to NBC",
                                               ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "Grand Manan", "GM to GM",
                                               ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "Grand Manan Banks", "GM to GMB",
                                               ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "Long Island", "GM to LI",
                                               ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "Seal Island", "GM to SI",
                                               ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "Yankee Bank", "GM to YB",
                                               ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "Trinity", "GM to T",
                                               ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "Browns Bank", "GM to BB",
                                               ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "SW Grounds", "GM to SWG",
                                               ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "Gannet Dry Ledge", "GM to GDL",
                                               ifelse(TagReturnsGM$FishingGround == "Grand Manan" & TagReturnsGM$catchAREA == "Lurcher", "GM to L", "Other"
                                                                                                                                     ))))))))))))))
TagReturnsGM  <- subset(TagReturnsGM, TagLocation != "Other")

ggplot(data = TagReturnsGM, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Grand Manan Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsGM %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

#Removed category 1 larvae - any caught within 2 days of tagging.

TagReturnsGM <- subset(TagReturnsGM, subset = (category != "1"))

ggplot(data = TagReturnsGM, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Grand Manan Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsGM %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsGM %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)

```

##### Grand Manan Banks

```{r, results = "asis", fig.align='center'}

TagReturnsGMB <- subset(TagReturns, subset = (FishingGround == "Grand Manan Banks"))

TagReturnsGMB$TagLocation <- with(TagReturnsGMB, ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "German Bank" |
                                                        TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "German Bank (Area 7)", "GMB to GB",
                                                 ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "Scots Bay" |
                                                        TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "Scots Bay (Area 8)", "GMB to SB",
                                                 ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "NB Coastal", "GMB to NBC",
                                                 ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "Grand Manan", "GMB to GM",
                                                 ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "Grand Manan Banks", "GMB to GMB",
                                                 ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "Long Island", "GMB to LI",
                                                 ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "Seal Island", "GMB to SI",
                                                 ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "Yankee Bank", "GMB to YB",
                                                 ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "Trinity", "GMB to T",
                                                 ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "Browns Bank", "GMB to BB",
                                                 ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "SW Grounds", "GMB to SWG",
                                                 ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "Gannet Dry Ledge", "GMB to GDL",
                                                 ifelse(TagReturnsGMB$FishingGround == "Grand Manan Banks" & TagReturnsGMB$catchAREA == "Lurcher", "GMB to L","Other"
                                                                                                                                   ))))))))))))))
TagReturnsGMB <- subset(TagReturnsGMB, TagLocation != "Other")

ggplot(data = TagReturnsGMB, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Grand Manan Banks Tag Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsGMB %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

#Removed category 1 larvae - any caught within 2 days of tagging.

TagReturnsGMB <- subset(TagReturnsGMB, subset = (category != "1"))

ggplot(data = TagReturnsGMB, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Grand Manan Banks Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsGMB %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsGMB %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)

```

##### Long Island

```{r, results = "asis", fig.align='center'}
TagReturnsLI <- subset(TagReturns, subset = (FishingGround == "Long Island"))

TagReturnsLI$TagLocation <- with(TagReturnsLI, ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "German Bank" |
                                                      TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "German Bank (Area 7)", "LI to GB",
                                               ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "Scots Bay" |
                                                      TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "Scots Bay (Area 8)", "LI to SB",
                                               ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "NB Coastal", "LI to NBC",
                                               ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "Grand Manan", "LI to GM",
                                               ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "Grand Manan Banks", "LI to GMB",
                                               ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "Long Island", "LI to LI",
                                               ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "Seal Island", "LI to SI",
                                               ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "Yankee Bank", "LI to YB",
                                               ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "Trinity", "LI to T",
                                               ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "Browns Bank", "LI to BB",
                                               ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "SW Grounds", "LI to SWG",
                                               ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "Gannet Dry Ledge", "LI to GDL",
                                               ifelse(TagReturnsLI$FishingGround == "Long Island" & TagReturnsLI$catchAREA == "Lurcher", "LI to L","Other"
                                                                                                                                     ))))))))))))))

TagReturnsLI <- subset(TagReturnsLI, TagLocation != "Other")

ggplot(data = TagReturnsLI, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Long Island Tag Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsLI %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

#Removed category 1 larvae - any caught within 2 days of tagging.

TagReturnsLI <- subset(TagReturnsLI, subset = (category != "1"))

ggplot(data = TagReturnsLI, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Long Island Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsLI %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsLI %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)
```

##### Seal Island

```{r, results = "asis", fig.align='center'}
TagReturnsSI <- subset(TagReturns, subset = (FishingGround == "Seal Island"))

TagReturnsSI$TagLocation <- with(TagReturnsSI, ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "German Bank" |
                                                      TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "German Bank (Area 7)", "SI to GB",
                                               ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "Scots Bay" |
                                                      TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "Scots Bay (Area 8)", "SI to SB",
                                               ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "NB Coastal", "SI to NBC",
                                               ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "Grand Manan", "SI to GM",
                                               ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "Grand Manan Banks", "SI to GMB",
                                               ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "Long Island", "SI to LI",
                                               ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "Seal Island", "SI to SI",
                                               ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "Yankee Bank", "SI to YB",
                                               ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "Trinity", "SI to T",
                                               ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "Browns Bank", "SI to BB",
                                               ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "SW Grounds", "SI to SWG",
                                               ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "Gannet Dry Ledge", "SI to GDL",
                                               ifelse(TagReturnsSI$FishingGround == "Seal Island" & TagReturnsSI$catchAREA == "Lurcher", "SI to L", "Other"
                                                                                                                                   ))))))))))))))

TagReturnsSI <- subset(TagReturnsSI, TagLocation != "Other")

ggplot(data = TagReturnsSI, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Seal Island Tag Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsSI %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

#Removed category 1 larvae - any caught within 2 days of tagging.

TagReturnsSI <- subset(TagReturnsSI, subset = (category != "1"))

ggplot(data = TagReturnsSI, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Seal Island Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsSI %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsSI %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)

```

##### Scots Bay

```{r, results = "asis", fig.align='center'}
TagReturnsSB <- subset(TagReturns, subset = (FishingGround == "Scots Bay"))

TagReturnsSB$TagLocation <- with(TagReturnsSB, ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "German Bank" |
                                                        TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "German Bank (Area 7)", "SB to GB",
                                               ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "Scots Bay" |
                                                      TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "Scots Bay (Area 8)", "SB to SB",
                                               ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "NB Coastal", "SB to NBC",
                                               ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "Grand Manan", "SB to GM",
                                               ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "Grand Manan Banks", "SB to GMB",
                                               ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "Long Island", "SB to LI",
                                               ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "Seal Island", "SB to SI",
                                               ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "Yankee Bank", "SB to YB",
                                               ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "Trinity", "SB to T",
                                               ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "Browns Bank", "SB to BB",
                                               ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "SW Grounds", "SB to SWG",
                                               ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "Gannet Dry Ledge", "SB to GDL",
                                               ifelse(TagReturnsSB$FishingGround == "Scots Bay" & TagReturnsSB$catchAREA == "Lurcher", "SB to L","Other"
                                                                                                                            ))))))))))))))

TagReturnsSB <- subset(TagReturnsSB, TagLocation != "Other")

ggplot(data = TagReturnsSB, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Scots Bay Tag Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsSB %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

#Removed category 1 larvae - any caught within 2 days of tagging.

TagReturnsSB <- subset(TagReturnsSB, subset = (category != "1"))

ggplot(data = TagReturnsSB, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Scots Bay Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsSB %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsSB %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)

```

##### Yankee Bank

```{r, results = "asis", fig.align='center'}
TagReturnsYB <- subset(TagReturns, subset = (FishingGround == "Yankee Bank"))

TagReturnsYB$TagLocation <- with(TagReturnsYB, ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "German Bank" |
                                                      TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "German Bank (Area 7)", "YB to GB",
                                               ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "Scots Bay" |
                                                      TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "Scots Bay (Area 8)", "YB to SB",
                                               ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "NB Coastal", "YB to NBC",
                                               ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "Grand Manan", "YB to GM",
                                               ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "Grand Manan Banks", "YB to GMB",
                                               ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "Long Island", "YB to LI",
                                               ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "Seal Island", "YB to SI",
                                               ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "Yankee Bank", "YB to YB",
                                               ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "Trinity", "YB to T",
                                               ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "Browns Bank", "YB to BB",
                                               ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "SW Grounds", "YB to SWG",
                                               ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "Gannet Dry Ledge", "YB to GDL",
                                               ifelse(TagReturnsYB$FishingGround == "Yankee Bank" & TagReturnsYB$catchAREA == "Lurcher", "YB to L", "Other"
                                                                                                                            ))))))))))))))

TagReturnsYB <- subset(TagReturnsYB, TagLocation != "Other")

ggplot(data = TagReturnsYB, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Yankee Bank Tag Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsYB %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

#Removed category 1 larvae - any caught within 2 days of tagging.

TagReturnsYB <- subset(TagReturnsYB, subset = (category != "1"))

ggplot(data = TagReturnsYB, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Yankee Bank Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsYB %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsYB %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)


```

##### Trinity

```{r, results = "asis", fig.align='center'}
TagReturnsT <- subset(TagReturns, subset = (FishingGround == "Trinity"))

TagReturnsT$TagLocation <- with(TagReturnsT, ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "German Bank" |
                                                    TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "German Bank (Area 7)", "T to GB",
                                             ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "Scots Bay" |
                                                    TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "Scots Bay (Area 8)", "T to SB",
                                             ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "NB Coastal", "T to NBC",
                                             ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "Grand Manan", "T to GM",
                                             ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "Grand Manan Banks", "T to GMB",
                                             ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "Long Island", "T to LI",
                                             ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "Seal Island", "T to SI",
                                             ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "Yank", "T to YB",
                                             ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "Trinity", "T to T",
                                             ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "Browns Bank", "T to BB",
                                             ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "SW Grounds", "T to SWG",
                                             ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "Gannet Dry Ledge", "T to GDL",
                                             ifelse(TagReturnsT$FishingGround == "Trinity" & TagReturnsT$catchAREA == "Lurcher", "T to L","Other"
                                                                                                                            ))))))))))))))

TagReturnsT <- subset(TagReturnsT, TagLocation != "Other")

ggplot(data = TagReturnsT, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Trinity Tag Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsT %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

#Removed category 1 larvae - any caught within 2 days of tagging.

TagReturnsT <- subset(TagReturnsT, subset = (category != "1"))

ggplot(data = TagReturnsT, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Trinity Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsT %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsT %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)

```

##### Browns Bank

```{r, results = "asis", fig.align='center'}
TagReturnsBB <- subset(TagReturns, subset = (FishingGround == "Browns Bank"))

TagReturnsBB$TagLocation <- with(TagReturnsBB, ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "German Bank" |
                                                      TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "German Bank (Area 7)", "BB to GB",
                                               ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "Scots Bay" |
                                                      TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "Scots Bay (Area 8)", "BB to SB",
                                               ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "NB Coastal", "BB to NBC",
                                               ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "Grand Manan", "BB to GM",
                                               ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "Grand Manan Banks", "BB to GMB",
                                               ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "Long Island", "BB to LI",
                                               ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "Seal Island", "BB to SI",
                                               ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "Yank", "BB to YB",
                                               ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "Trinity", "BB to T",
                                               ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "Browns Bank", "BB to BB",
                                               ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "SW Grounds", "BB to SWG",
                                               ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "Gannet Dry Ledge", "BB to GDL",
                                               ifelse(TagReturnsBB$FishingGround == "Browns Bank" & TagReturnsBB$catchAREA == "Lurcher", "BB to L", "Other"
                                                                                                                          ))))))))))))))


TagReturnsBB <- subset(TagReturnsBB, TagLocation != "Other")

ggplot(data = TagReturnsBB, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Browns Bank Tag Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsBB %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

#Removed category 1 larvae - any caught within 2 days of tagging.

TagReturnsBB <- subset(TagReturnsBB, subset = (category != "1"))

ggplot(data = TagReturnsBB, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Browns Bank Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsBB %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsBB %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)
```

##### SW Ground

```{r, results = "asis", fig.align='center'}
TagReturnsSWG <- subset(TagReturns, subset = (FishingGround == "SW Grounds"))

TagReturnsSWG$TagLocation <- with(TagReturnsSWG, ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "German Bank" |
                                                        TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "German Bank (Area 7)", "SWG to GB",
                                                 ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "Scots Bay" |
                                                        TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "Scots Bay (Area 8)", "SWG to SB",
                                                 ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "NB Coastal", "SWG to NBC",
                                                 ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "Grand Manan", "SWG to GM",
                                                 ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "Grand Manan Banks", "SWG to GMB",
                                                 ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "Long Island", "SWG to LI",
                                                 ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "Seal Island", "SWG to SI",
                                                 ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "Yank", "SWG to YB",
                                                 ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "Trinity", "SWG to T",
                                                 ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "Browns Bank", "SWG to BB",
                                                 ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "SW Grounds", "SWG to SWG",
                                                 ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "Gannet Dry Ledge", "SWG to GDL",
                                                 ifelse(TagReturnsSWG$FishingGround == "SW Grounds" & TagReturnsSWG$catchAREA == "Lurcher", "GDL to L","Other"
                                                                                                                            ))))))))))))))

TagReturnsSWG <- subset(TagReturnsSWG, TagLocation != "Other")

ggplot(data = TagReturnsSWG, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("SW Grounds Tag Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsSWG %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

#Removed category 1 larvae - any caught within 2 days of tagging.
#Not sure why an NA has popped up

TagReturnsSWG <- subset(TagReturnsSWG, subset = (category != "1"))

ggplot(data = TagReturnsSWG, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("SW Grounds Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsSWG %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsSWG %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)
```

##### Gannet Dry Ledge

```{r, results = "asis", fig.align='center'}
TagReturnsGDL <- subset(TagReturns, subset = (FishingGround == "Gannet Dry Ledge"))

TagReturnsGDL$TagLocation <- with(TagReturnsGDL, ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "German Bank" |
                                                        TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "German Bank (Area 7)", "GDL to GB",
                                                 ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "Scots Bay" |
                                                        TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "Scots Bay (Area 8)", "GDL to SB",
                                                 ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "NB Coastal", "GDL to NBC",
                                                 ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "Grand Manan", "GDL to GM",
                                                 ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "Grand Manan Banks", "GDL to GMB",
                                                 ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "Long Island", "GDL to LI",
                                                 ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "Seal Island", "GDL to SI",
                                                 ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "Yank", "GDL to YB",
                                                 ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "Trinity", "GDL to T",
                                                 ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "Browns Bank", "GDL to BB",
                                                 ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "SW Grounds", "GDL to SWG",
                                                 ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "Gannet Dry Ledge", "GDL to GDL",
                                                 ifelse(TagReturnsGDL$FishingGround == "Gannet Dry Ledge" & TagReturnsGDL$catchAREA == "Lurcher", "GDL to L","Other"
                                                                                                                              ))))))))))))))


TagReturnsGDL <- subset(TagReturnsGDL, TagLocation != "Other")

ggplot(data = TagReturnsGDL, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Gannet Dry Ledge Tag Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsGDL %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

#Removed category 1 larvae - any caught within 2 days of tagging.

TagReturnsGDL <- subset(TagReturnsGDL, subset = (category != "1"))

ggplot(data = TagReturnsGDL, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Gannet Dry Ledget Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsGDL %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsGDL %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)

```

##### Lurcher

```{r, results = "asis", fig.align='center'}
TagReturnsL <- subset(TagReturns, subset = (FishingGround == "Lurcher"))

TagReturnsL$TagLocation <- with(TagReturnsL, ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "German Bank" |
                                                    TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "German Bank (Area 7)", "L to GB",
                                             ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "Scots Bay" |
                                                    TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "Scots Bay (Area 8)", "L to SB",
                                             ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "NB Coastal", "L to NBC",
                                             ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "Grand Manan", "L to GM",
                                             ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "Grand Manan Banks", "L to GMB",
                                             ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "Long Island", "L to LI",
                                             ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "Seal Island", "L to SI",
                                             ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "Yank", "L to YB",
                                             ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "Trinity", "L to T",
                                             ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "Browns Bank", "L to BB",
                                             ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "SW Grounds", "L to SWG",
                                             ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "Gannet Dry Ledge", "L to GDL",
                                             ifelse(TagReturnsL$FishingGround == "Lurcher" & TagReturnsL$catchAREA == "Lurcher", "L to L", "Other"
                                                                                                                              ))))))))))))))


TagReturnsL <- subset(TagReturnsL, TagLocation != "Other")

ggplot(data = TagReturnsL, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Lurcher Tag Returns") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsL %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)

kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

#Removed category 1 larvae - any caught within 2 days of tagging.

TagReturnsL <- subset(TagReturnsL, subset = (category != "1"))

ggplot(data = TagReturnsL, (aes(TagLocation, fill = category))) + 
        geom_histogram(binwidth=1, colour = "white", stat = "count") + 
        theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
        labs(x = "Tag to Catch Location", y="Number of Events") +
        ggtitle("Lurcher Tag Returns excluding fish caught within 2 days of being tagged") +
        scale_y_continuous(breaks= pretty_breaks())

Table <- TagReturnsL %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)


kbl(Table, col.names=c("Tag Number", "Category", "Tagged Date", "Tagged Ground", "Catch Date", "Catch Area", "Time Difference (days)", "Average Time Difference (days)", "Minimum Time Difference", "Maximum Time Difference", "Amount in the Same Category", "Amount with the same number of Days"), align = "c") %>%
  kable_paper("striped", full_width = F)

SummaryTable <- TagReturnsL %>%
  group_by(TagLocation, category) %>%
  count()

kbl(SummaryTable, col.names = c("Tag Location", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)

```

#### Gear Types {.tabset .tabset-fade .tabset-pills}

##### All Gear

```{r, results = "asis", fig.align='center'}

GearTable <- TagReturns %>% 
  dplyr::select(TAG_NUMBER,
                category,
                Date,
                FishingGround,
                DATE,
                catchAREA,
                GearType,
                timeDifference,
                AvgtimeDifference,
                timeDifferenceMin,
                timeDifferenceMax,
                No.InCategory,
                No.ofSameNumberOfDays)%>%
  arrange(timeDifference)

GearTable$Count = 1
GearTable<-subset(GearTable, subset = (GearType != "N/A"))

ggplot(GearTable, aes(x=GearType, y = Count, fill = factor(category))) +
  geom_bar(stat="identity") +
  labs(y = "Number of Events", x = "Gear Type") +
  ggtitle("Tag Return") +
  labs(fill = "Category")

GearWithout1 <- subset(GearTable, subset = (category != 1))

ggplot(GearWithout1, aes(x=GearType, y = Count, fill = factor(category))) +
  geom_bar(stat="identity") +
  labs(y = "Number of Events", x = "Gear Type") +
  ggtitle("Tag Return") +
  labs(fill = "Category")

SummaryTable <- GearWithout1 %>%
  group_by(GearType, category) %>%
  count()

kbl(SummaryTable, col.names = c("Gear Type", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)


```

##### Removal of Purse Seine 

```{r, results = "asis", fig.align='center'}

WeirTable <- subset(GearTable, subset = (GearType != "Purse Seine"))
WeirTable <- subset(WeirTable, subset = (GearType != "Mid Water Trawl"))

ggplot(WeirTable, aes(x=GearType, y = Count, fill = factor(category))) +
  geom_bar(stat="identity") +
  labs(y = "Number of Events", x = "Gear Type") +
  ggtitle("Tag Return to Gear Type") +
  labs(fill = "Category")

ggplot(WeirTable, aes(x=GearType, y = Count, fill = factor(FishingGround))) +
  geom_bar(stat="identity") +
  labs(y = "Number of Events", x = "Gear Type") +
  ggtitle("Tag Return to gear type from specific tagging ground") +
  labs(fill = "Tagging Ground")

SummaryTable <-WeirTable %>%
  group_by(GearType, category) %>%
  count()

kbl(SummaryTable, col.names = c("Gear Type", "Category", "Abundance in Category"), align = "c") %>%
  kable_paper("striped", full_width = F)

```





## Oceanographic Project

### Current CTD Data {.tabset}

#### Scots Bay {.tabset .tabset-pills}

##### Total

```{r message=FALSE, warning=FALSE}
CP <- as(extent(-65.5, -64.5, 45, 45.5), "SpatialPolygons") #set boundaries for Scots Bay before plotting
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)
```

```{r echo=FALSE}

ggplot(data = subset(CTD, Ground == "Scots Bay" & Year == year & In_Box == "1"), aes(x=Lon, y=Lat)) + #To use if within the survey season

#ggplot(data = subset(CTD, Ground == "Scots Bay" & Year == 2023 & In_Box == "1"), aes(x=Lon, y=Lat)) + #To use if outside of the survey season. Reset year.
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=polySB_main,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=SBplankton,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=SBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_polygon(data=polyNorthern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polyEastern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_point(aes(fill = Survey), pch=21, size = 2) +
  coord_map() + 
  labs(x=NULL, y=NULL)

ggplot(data = subset(CTD, Ground == "Scots Bay" & Year == year), aes(x=Temperature, y=Depth, colour = Julian_factor)) + #To use if within the survey season
#ggplot(data = subset(CTD, Ground == "Scots Bay" & Year == 2023), aes(x=Temperature, y=Depth, colour = Julian_factor)) + #To use if outside of the survey season. Reset year.
geom_path(size = 1.5) + 
scale_y_reverse() + 
labs(x="Temperature (°C)", y = "Depth (m)", colour='Julian Day', title = "Temperature (°C) vs. Depth (m)")
```

```{r, results = "asis"}
#CTD1 = CTD %>% 
  # filter(Year == year & Ground == "Scots Bay") %>%
  # arrange(Survey)                                          # To use within the survey window

CTD1 = CTD %>% 
   filter(Year == 2023 & Ground == "Scots Bay") %>%
   arrange(Survey)                                           # To use outside of Survey window. Reset year.

for(i in unique(CTD1$Survey)) {
  
  cat("\n")
  cat("##### Survey", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(CTD1, Survey == i), aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polySB_main,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=SBplankton,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=SBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_polygon(data=polyNorthern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polyEastern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_point(pch=21, size = 2, fill = "red") +
  coord_map() + 
  labs(x=NULL, y=NULL))
  cat("\n")
  
print(ggplot(data = subset(CTD1, Survey == i), aes(x=Temperature, y=Depth)) + 
geom_path(size = 1.5) + 
scale_y_reverse() + 
labs(x="Temperature (°C)", y = "Depth (m)", title = "Temperature (°C) vs. Depth (m)"))
  cat("\n")
}
```

#### German Bank {.tabset .tabset-pills}

##### Total

```{r message=FALSE, warning=FALSE}
CP <- as(extent(-66.5, -65.5, 43, 44), "SpatialPolygons") #set boundaries for German Bank before plotting
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)
```

```{r echo=FALSE}
# ggplot(data = subset(CTD, Ground == "German Bank" & Year == year & In_Box == "1"), aes(x=Lon, y=Lat)) + #To use within the survey window
ggplot(data = subset(CTD, Ground == "German Bank" & Year == 2023 & In_Box == "1"), aes(x=Lon, y=Lat)) +  #To use outside of the survey window. Reset Year. 
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=polyGB,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polySI,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=GBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_point(aes(fill = Survey), pch=21, size = 2) +
  coord_map() + 
  labs(x=NULL, y=NULL)

#ggplot(data = subset(CTD, Ground == "German Bank" & Year == year), aes(x=Temperature, y=Depth, colour = Julian_factor)) +  #To use within the survey window
ggplot(data = subset(CTD, Ground == "German Bank" & Year == 2023), aes(x=Temperature, y=Depth, colour = Julian_factor)) +   # To use outside of the survey window. Reset Year.
geom_path(size = 1.5) + 
scale_y_reverse() + 
labs(x="Temperature (°C)", y = "Depth (m)", colour='Julian Day', title = "Temperature (°C) vs. Depth (m)")
```

```{r, results = "asis"}
CTD1 = CTD %>% 
  filter(Year == year & Ground == "German Bank") %>%
  arrange(Survey)

for(i in unique(CTD1$Survey)) {
  
  cat("\n")
  cat("##### Survey", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(CTD1, Survey == i), aes(x=Lon, y=Lat)) + 
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=polyGB,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polySI,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=GBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_point(pch=21, size = 2, fill = "red") +
  coord_map() + 
  labs(x=NULL, y=NULL))
  cat("\n")
  
print(ggplot(data = subset(CTD1, Survey == i), aes(x=Temperature, y=Depth)) + 
geom_path(size = 1.5) + 
scale_y_reverse() + 
labs(x="Temperature (°C)", y = "Depth (m)", title = "Temperature (°C) vs. Depth (m)"))
  cat("\n")
}
```

### Annual CTD Data {.tabset}

#### Scots Bay {.tabset}

##### Sea Surface Temperatures (SST) {.tabset .tabset-pills}

###### Total

```{r out.width="30%", fig.show="hold"}
ggplot(data = subset(SST, Ground == "Scots Bay" & In_Box == "1"), aes(x = Julian, y = Temperature, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Sea Surface Temperature") +
  xlab("Julian Day") +
  ggtitle("Scots Bay")

Summer = SST %>% 
  subset(Ground == "Scots Bay" & In_Box == "1" & Month == "8")

ggplot(data = Summer, aes(x=Year, y=Temperature, group = Year, colour = Year))+
  geom_boxplot() +
  ylab("Average Sea Surface Temperature") +
  ggtitle("August SST") +
  stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(8.5,16.5)

ggplot(data = subset(SST, Ground == "Scots Bay" & In_Box == "1"), aes(x=Year, y=Temperature, group = Year, colour = Year)) +
  geom_boxplot() + 
  facet_wrap(~Month) + 
  ylim(7.5, 15.5) + 
  stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -1) +
  labs(x="Year", y = "Sea Surface Temperature (SST) (C)", title = "Scots Bay: Monthly SST vs. Year") +
  theme(axis.text.x = element_text(angle = 55))
```

```{r, results = "asis"}
SST1 = SST %>% 
  filter(Ground == "Scots Bay" & In_Box == "1") %>%
  arrange(Survey) %>%
  arrange(Year)

for(i in unique(SST1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(SST1, Year == i), aes(x = Julian, y = Temperature)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Sea Surface Temperature") +
  xlab("Julian Day") +
  ylim(NA, 16) +
  ggtitle("Scots Bay"))
  cat("\n")
}
```

##### At Depth Temperatures (30m) {.tabset .tabset-pills}

###### Total

```{r out.width="30%", fig.show="hold"}
ggplot(data = subset(atDepth, Ground == "Scots Bay" & In_Box == "1"), aes(x = Julian, y = Temperature, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Temperature at 30m Depth") + 
  xlab("Julian Day") + 
  ggtitle("Scots Bay")

Summer = atDepth %>% 
  subset(Ground == "Scots Bay" & In_Box == "1" & Month == "8")

ggplot(data = Summer, aes(x=Year, y=Temperature, group = Year, colour = Year))+
  geom_boxplot() +
  ylab("Average Temperature at 30m Depth") +
  stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(9,15) +
  ggtitle("August At-Depth Temperature")

ggplot(data = subset(atDepth, Ground == "Scots Bay" & In_Box == "1"), aes(x=Year, y=Temperature, group = Year, colour = Year)) + 
  geom_boxplot() + 
  facet_wrap(~Month) + 
  ylim(7.5, 14.5) + 
  stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -1) +
  labs(x="Year", y = "Temperature (C) at 30m Depth", title = "Scots Bay: Monthly 30m Temperature vs. Year") +
  theme(axis.text.x = element_text(angle = 55))
```


```{r, results = "asis"}
atDepth1 = atDepth %>% 
  filter(Ground == "Scots Bay" & In_Box == "1") %>%
  arrange(Survey)

for(i in unique(atDepth1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(atDepth1, Year == i), aes(x = Julian, y = Temperature)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Temperature at 30m Depth") +
  xlab("Julian Day") +
  ylim(NA, 16) +
  ggtitle("Scots Bay"))
  cat("\n")
}
```

##### Stratified Temperatures {.tabset .tabset-pills}

###### Total

```{r}
ggplot(data = subset(atDepth, Ground == "Scots Bay" & In_Box == "1"), aes(x = Julian, y = StratTemp, colour = Year)) + 
  geom_point() + 
  ylab("Temperature Difference") + 
  xlab("Julian Day") + 
  ylim(NA, 1.7) +
  ggtitle("Scots Bay")

ggplot(data = subset(atDepth, Ground == "Scots Bay" & In_Box == "1"), aes(x=Year, y=StratTemp, group = Year, colour = Year)) + 
  geom_boxplot() +   
  stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(NA,1.7) +
  labs(x="Year", y = "Temperature Difference (C)", title = "Temperature Difference (Stratification) vs. Year")
```

```{r, results = "asis"}
atDepth1 = atDepth %>% 
  filter(Ground == "Scots Bay" & In_Box == "1") %>%
  arrange(Survey)

for(i in unique(atDepth1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(atDepth1, Year == i), aes(x = Julian, y = StratTemp, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Temperature Difference") + 
  xlab("Julian Day") +
  ylim(NA, 1.7) +
  ggtitle("Scots Bay"))
  cat("\n")
}
```

##### Stratified Salinity {.tabset .tabset-pills}

###### Total

```{r}
ggplot(data = subset(atDepth, Ground == "Scots Bay" & In_Box == "1"), aes(x = Julian, y = StratSalt, colour = Year)) + 
  geom_point() + 
  ylab("Salinity Difference") + 
  xlab("Julian Day") +
  ylim(c(0, 0.7)) +
  ggtitle("Scots Bay")

ggplot(data = subset(atDepth, Ground == "Scots Bay" & In_Box == "1"), aes(x=Year, y=StratSalt, group = Year, colour = Year)) + 
  geom_boxplot() + 
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(NA,0.75)
  labs(x="Year", y = "Salinity Difference (PSS)", title = "Salinity Difference (Stratification) vs. Year")
```

```{r, results = "asis"}
atDepth1 = atDepth %>% 
  filter(Ground == "Scots Bay" & In_Box == "1") %>%
  arrange(Survey)

for(i in unique(atDepth1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(atDepth1, Year == i), aes(x = Julian, y = StratSalt, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Salinity Difference") + 
  xlab("Julian Day") +
  ylim(NA, 0.7) +
  ggtitle("Scots Bay"))
  cat("\n")
}
```

#### German Bank {.tabset}

##### Sea Surface Temperatures (SST) {.tabset .tabset-pills}

###### Total

```{r out.width="30%", fig.show="hold"}
ggplot(data = subset(SST, Ground == "German Bank" & In_Box == "1"), aes(x = Julian, y = Temperature, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Sea Surface Temperature") + 
  xlab("Julian Day") +
  ggtitle("German Bank")

Summer = SST %>% 
  subset(Ground == "German Bank" & In_Box == "1" & Month == "8")

ggplot(data = Summer, aes(x=Year, y=Temperature, group = Year, colour = Year))+
  geom_boxplot() +
  ylab("Average Sea Surface Temperature") +
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(9.5,18) +
  ggtitle("August SST") 
  
ggplot(data = subset(SST, Ground == "German Bank" & In_Box == "1"), aes(x=Year, y=Temperature, group = Year, colour = Year)) + 
  geom_boxplot() + 
  facet_wrap(~Month) + 
  ylim(9.5, 18) + 
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -1) +
  labs(x="Year", y = "Sea Surface Temperature (SST) (C)", title = "German Bank: Monthly SST vs. Year") +
  theme(axis.text.x = element_text(angle = 55))
```

```{r, results = "asis"}
SST1 = SST %>% 
  filter(Ground == "German Bank" & In_Box == "1") %>%
  arrange(Survey)

for(i in unique(SST1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(SST1, Year == i), aes(x = Julian, y = Temperature)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Sea Surface Temperature") + 
  xlab("Julian Day") +
  ylim(NA, 18) +
  ggtitle("German Bank"))
  cat("\n")
}
```

##### At Depth Temperatures (30m) {.tabset .tabset-pills}

###### Total

```{r out.width="30%", fig.show="hold", fig.align='center'}
ggplot(data = subset(atDepth, Ground == "German Bank" & In_Box == "1"), aes(x = Julian, y = Temperature, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Temperature at 30m Depth") + 
  xlab("Julian Day") +
  ggtitle("German Bank")

Summer = atDepth %>% 
  subset(Ground == "German Bank" & In_Box == "1" & Month == "8")

ggplot(data = Summer, aes(x=Year, y=Temperature, group = Year, colour = Year))+
  geom_boxplot() +
  ylab("Average Temperature at 30m Depth") +
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(9,14)+
  ggtitle("August At-Depth Temperature")

ggplot(data = subset(atDepth, Ground == "German Bank" & In_Box == "1"), aes(x=Year, y=Temperature, group = Year, colour = Year)) + 
  geom_boxplot() + 
  facet_wrap(~Month) + 
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -1) +
  ylim(10,13.5) +
  labs(x="Year", y = "Temperature (C) at 30m Depth", title = "German Bank: Monthly 30m Temperature vs. Year") +
  theme(axis.text.x = element_text(angle = 55))
```

```{r, results = "asis", fig.align='center'}
atDepth1 = atDepth %>% 
  filter(Ground == "German Bank" & In_Box == "1") %>%
  arrange(Survey)

for(i in unique(atDepth1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(atDepth1, Year == i), aes(x = Julian, y = Temperature)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Temperature at 30m Depth") + 
  xlab("Julian Day") +
  ylim(NA, 14.5) +
  ggtitle("German Bank"))
  cat("\n")
}
```

##### Stratified Temperatures {.tabset .tabset-pills}

###### Total

```{r, fig.align='center'}
ggplot(data = subset(atDepth, Ground == "German Bank" & In_Box == "1"), aes(x = Julian, y = StratTemp, colour = Year)) + 
  geom_point() + 
  ylab("Temperature Difference") + 
  xlab("Julian Day") + 
  ylim(c(0, 8)) +
  ggtitle("German Bank")

ggplot(data = subset(atDepth, Ground == "German Bank" & In_Box == "1"), aes(x=Year, y=StratTemp, group = Year, colour = Year)) + 
  geom_boxplot() + 
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(NA, 6.5)+
  labs(x="Year", y = "Temperature Difference (C)", title = "Temperature Difference (Stratification) vs. Year")
```

```{r, results = "asis", fig.align='center'}
atDepth1 = atDepth %>% 
  filter(Ground == "German Bank" & In_Box == "1") %>%
  arrange(Survey)

for(i in unique(atDepth1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(atDepth1, Year == i), aes(x = Julian, y = StratTemp, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Temperature Difference") + 
  xlab("Julian Day") +
  ylim(c(0, 8)) +
  ggtitle("German Bank"))
  cat("\n")
}
```

##### Stratified Salinity {.tabset .tabset-pills}

###### Total

```{r, fig.align='center'}
ggplot(data = subset(atDepth, Ground == "German Bank" & In_Box == "1"), aes(x = Julian, y = StratSalt, colour = Year)) + 
  geom_point() + 
  ylab("Salinity Difference") + 
  xlab("Julian Day") + 
  ylim(c(0, 1.8)) +
  ggtitle("German Bank")

ggplot(data = subset(atDepth, Ground == "German Bank" & In_Box == "1"), aes(x=Year, y=StratSalt, group = Year, colour = Year)) + 
  geom_boxplot() + 
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -1) +
  ylim(NA,1.6) +
  labs(x="Year", y = "Salinity Difference (PSS)", title = "Salinity Difference (Stratification) vs. Year")
```

```{r, results = "asis", fig.align='center'}
atDepth1 = atDepth %>% 
  filter(Ground == "German Bank" & In_Box == "1") %>%
  arrange(Survey)

for(i in unique(atDepth1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(atDepth1, Year == i), aes(x = Julian, y = StratSalt, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Salinity Difference") + 
  xlab("Julian Day") +
  ylim(c(0, 1.8)) +
  ggtitle("German Bank"))
  cat("\n")
}
```

### All CTD Data (incl. Out-Box) {.tabset}

#### Scots Bay {.tabset}

##### Sea Surface Temperatures (SST) {.tabset .tabset-pills}

###### Total

```{r out.width="30%", fig.show="hold"}
ggplot(data = subset(SST, Ground == "Scots Bay"), aes(x = Julian, y = Temperature, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Sea Surface Temperature") +
  xlab("Julian Day") +
  ggtitle("Scots Bay")

Summer = SST %>% 
  subset(Ground == "Scots Bay" & Month == "8")

ggplot(data = Summer, aes(x=Year, y=Temperature, group = Year, colour = Year))+
  geom_boxplot() +
  ylab("Average Sea Surface Temperature") +
  ggtitle("August SST") +
  stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(8.5,16.5)

ggplot(data = subset(SST, Ground == "Scots Bay"), aes(x=Year, y=Temperature, group = Year, colour = Year)) +
  geom_boxplot() + 
  facet_wrap(~Month) + 
  ylim(7.5, 15.5) + 
  stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -1) +
  labs(x="Year", y = "Sea Surface Temperature (SST) (C)", title = "Scots Bay: Monthly SST vs. Year") +
  theme(axis.text.x = element_text(angle = 55))
```

```{r, results = "asis"}
SST1 = SST %>% 
  filter(Ground == "Scots Bay") %>%
  arrange(Survey)

for(i in unique(SST1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(SST1, Year == i), aes(x = Julian, y = Temperature)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Sea Surface Temperature") +
  xlab("Julian Day") +
  ylim(NA, 16) +
  ggtitle("Scots Bay"))
  cat("\n")
}
```

##### At Depth Temperatures (30m) {.tabset .tabset-pills}

###### Total

```{r out.width="30%", fig.show="hold"}
ggplot(data = subset(atDepth, Ground == "Scots Bay"), aes(x = Julian, y = Temperature, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Temperature at 30m Depth") + 
  xlab("Julian Day") + 
  ggtitle("Scots Bay")

Summer = atDepth %>% 
  subset(Ground == "Scots Bay" & Month == "8")

ggplot(data = Summer, aes(x=Year, y=Temperature, group = Year, colour = Year))+
  geom_boxplot() +
  ylab("Average Temperature at 30m Depth") +
  stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(9,15) +
  ggtitle("August At-Depth Temperature")

ggplot(data = subset(atDepth, Ground == "Scots Bay"), aes(x=Year, y=Temperature, group = Year, colour = Year)) + 
  geom_boxplot() + 
  facet_wrap(~Month) + 
  ylim(7.5, 14.5) + 
  stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -1) +
  labs(x="Year", y = "Temperature (C) at 30m Depth", title = "Scots Bay: Monthly 30m Temperature vs. Year") +
  theme(axis.text.x = element_text(angle = 55))
```

```{r, results = "asis"}
atDepth1 = atDepth %>% 
  filter(Ground == "Scots Bay") %>%
  arrange(Survey)

for(i in unique(atDepth1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(atDepth1, Year == i), aes(x = Julian, y = Temperature)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Temperature at 30m Depth") +
  xlab("Julian Day") +
  ylim(NA, 16) +
  ggtitle("Scots Bay"))
  cat("\n")
}
```

##### Stratified Temperatures {.tabset .tabset-pills}

###### Total

```{r}
ggplot(data = subset(atDepth, Ground == "Scots Bay"), aes(x = Julian, y = StratTemp, colour = Year)) + 
  geom_point() + 
  ylab("Temperature Difference") + 
  xlab("Julian Day") + 
  ylim(NA, 1.7) +
  ggtitle("Scots Bay")

ggplot(data = subset(atDepth, Ground == "Scots Bay"), aes(x=Year, y=StratTemp, group = Year, colour = Year)) + 
  geom_boxplot() +   
  stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(NA,1.7) +
  labs(x="Year", y = "Temperature Difference (C)", title = "Temperature Difference (Stratification) vs. Year")
```

```{r, results = "asis"}
atDepth1 = atDepth %>% 
  filter(Ground == "Scots Bay") %>%
  arrange(Survey)

for(i in unique(atDepth1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(atDepth1, Year == i), aes(x = Julian, y = StratTemp, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Temperature Difference") + 
  xlab("Julian Day") +
  ylim(NA, 1.7) +
  ggtitle("Scots Bay"))
  cat("\n")
}
```

##### Stratified Salinity {.tabset .tabset-pills}

###### Total

```{r}
ggplot(data = subset(atDepth, Ground == "Scots Bay"), aes(x = Julian, y = StratSalt, colour = Year)) + 
  geom_point() + 
  ylab("Salinity Difference") + 
  xlab("Julian Day") +
  ylim(c(0, 0.7)) +
  ggtitle("Scots Bay")

ggplot(data = subset(atDepth, Ground == "Scots Bay"), aes(x=Year, y=StratSalt, group = Year, colour = Year)) + 
  geom_boxplot() + 
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(NA,0.75) +
  labs(x="Year", y = "Salinity Difference (PSS)", title = "Salinity Difference (Stratification) vs. Year")
```

```{r, results = "asis"}
atDepth1 = atDepth %>% 
  filter(Ground == "Scots Bay") %>%
  arrange(Survey)

for(i in unique(atDepth1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(atDepth1, Year == i), aes(x = Julian, y = StratSalt, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Salinity Difference") + 
  xlab("Julian Day") +
  ylim(NA, 0.7) +
  ggtitle("Scots Bay"))
  cat("\n")
}
```

#### German Bank {.tabset}

##### Sea Surface Temperatures (SST) {.tabset .tabset-pills}

###### Total

```{r out.width="30%", fig.show="hold"}
ggplot(data = subset(SST, Ground == "German Bank"), aes(x = Julian, y = Temperature, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Sea Surface Temperature") + 
  xlab("Julian Day") +
  ggtitle("German Bank")

Summer = SST %>% 
  subset(Ground == "German Bank" & Month == "8")

ggplot(data = Summer, aes(x=Year, y=Temperature, group = Year, colour = Year))+
  geom_boxplot() +
  ylab("Average Sea Surface Temperature") +
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(9.5,18) +
  ggtitle("August SST") 
  
ggplot(data = subset(SST, Ground == "German Bank"), aes(x=Year, y=Temperature, group = Year, colour = Year)) + 
  geom_boxplot() + 
  facet_wrap(~Month) + 
  ylim(9.5, 18) + 
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -1) +
  labs(x="Year", y = "Sea Surface Temperature (SST) (C)", title = "German Bank: Monthly SST vs. Year") +
  theme(axis.text.x = element_text(angle = 55))
```

```{r, results = "asis"}
SST1 = SST %>% 
  filter(Ground == "German Bank") %>%
  arrange(Survey)

for(i in unique(SST1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(SST1, Year == i), aes(x = Julian, y = Temperature)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Sea Surface Temperature") + 
  xlab("Julian Day") +
  ylim(NA, 18) +
  ggtitle("German Bank"))
  cat("\n")
}
```

##### At Depth Temperatures (30m) {.tabset .tabset-pills}

###### Total

```{r out.width="30%", fig.show="hold", fig.align='center'}
ggplot(data = subset(atDepth, Ground == "German Bank"), aes(x = Julian, y = Temperature, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Temperature at 30m Depth") + 
  xlab("Julian Day") +
  ggtitle("German Bank")

Summer = atDepth %>% 
  subset(Ground == "German Bank" & Month == "8")

ggplot(data = Summer, aes(x=Year, y=Temperature, group = Year, colour = Year))+
  geom_boxplot() +
  ylab("Average Temperature at 30m Depth") +
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(9,14)+
  ggtitle("August At-Depth Temperature")

ggplot(data = subset(atDepth, Ground == "German Bank"), aes(x=Year, y=Temperature, group = Year, colour = Year)) + 
  geom_boxplot() + 
  facet_wrap(~Month) + 
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -1) +
  ylim(10,13.5) +
  labs(x="Year", y = "Temperature (C) at 30m Depth", title = "German Bank: Monthly 30m Temperature vs. Year") +
  theme(axis.text.x = element_text(angle = 55))
```

```{r, results = "asis", fig.align='center'}
atDepth1 = atDepth %>% 
  filter(Ground == "German Bank") %>%
  arrange(Survey)

for(i in unique(atDepth1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(atDepth1, Year == i), aes(x = Julian, y = Temperature)) + 
  geom_point() + 
  geom_line() +
  ylab("Average Temperature at 30m Depth") + 
  xlab("Julian Day") +
  ylim(NA, 14.5) +
  ggtitle("German Bank"))
  cat("\n")
}
```

##### Stratified Temperatures {.tabset .tabset-pills}

###### Total

```{r, fig.align='center'}
ggplot(data = subset(atDepth, Ground == "German Bank"), aes(x = Julian, y = StratTemp, colour = Year)) + 
  geom_point() + 
  ylab("Temperature Difference") + 
  xlab("Julian Day") + 
  ylim(c(0, 8)) +
  ggtitle("German Bank")

ggplot(data = subset(atDepth, Ground == "German Bank"), aes(x=Year, y=StratTemp, group = Year, colour = Year)) + 
  geom_boxplot() + 
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -0.5) +
  ylim(NA, 6.5)+
  labs(x="Year", y = "Temperature Difference (C)", title = "Temperature Difference (Stratification) vs. Year")
```

```{r, results = "asis", fig.align='center'}
atDepth1 = atDepth %>% 
  filter(Ground == "German Bank") %>%
  arrange(Survey)

for(i in unique(atDepth1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(atDepth1, Year == i), aes(x = Julian, y = StratTemp, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Temperature Difference") + 
  xlab("Julian Day") +
  ylim(c(0, 8)) +
  ggtitle("German Bank"))
  cat("\n")
}
```

##### Stratified Salinity {.tabset .tabset-pills}

###### Total

```{r, fig.align='center'}
ggplot(data = subset(atDepth, Ground == "German Bank"), aes(x = Julian, y = StratSalt, colour = Year)) + 
  geom_point() + 
  ylab("Salinity Difference") + 
  xlab("Julian Day") + 
  ylim(c(0, 1.8)) +
  ggtitle("German Bank")

ggplot(data = subset(atDepth, Ground == "German Bank"), aes(x=Year, y=StratSalt, group = Year, colour = Year)) + 
  geom_boxplot() + 
    stat_summary(fun.y = median, fun.ymax = length,
               geom = "text", aes(label = ..ymax..), vjust = -1) +
  ylim(NA,1.6) +
  labs(x="Year", y = "Salinity Difference (PSS)", title = "Salinity Difference (Stratification) vs. Year")
```

```{r, results = "asis", fig.align='center'}
atDepth1 = atDepth %>% 
  filter(Ground == "German Bank") %>%
  arrange(Survey)

for(i in unique(atDepth1$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
print(ggplot(data = subset(atDepth1, Year == i), aes(x = Julian, y = StratSalt, colour = Year)) + 
  geom_point() + 
  geom_line() +
  ylab("Salinity Difference") + 
  xlab("Julian Day") +
  ylim(c(0, 1.8)) +
  ggtitle("German Bank"))
  cat("\n")
}
```

#### Maps {.tabset}

##### Scots Bay

```{r message=FALSE, warning=FALSE, fig.align='center'}
CP <- as(extent(-65.5, -64.5, 45, 45.5), "SpatialPolygons")
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)

ggplot(data = subset(CTD, Ground == "Scots Bay"), aes(x=Lon, y=Lat)) + 
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=polySB_main,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=SBplankton,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=SBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_polygon(data=polyNorthern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polyEastern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_point(aes(fill = Year), pch=21, size = 2) +
  coord_map() + 
  labs(x=NULL, y=NULL)
```

##### German Bank

```{r message=FALSE, warning=FALSE, fig.align='center'}
CP <- as(extent(-66.5, -65.5, 43, 44), "SpatialPolygons")
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)

ggplot(data = subset(CTD, Ground == "German Bank" & In_Box == "1"), aes(x=Lon, y=Lat)) + 
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=polyGB,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polySI,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=GBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_point(aes(fill = Year), pch=21, size = 2) +
  coord_map() + 
  labs(x=NULL, y=NULL)
```

##### All Casts

```{r echo=FALSE, fig.height=9, fig.width=15, message=FALSE, warning=FALSE}
#Reset spatial extent back to full view
CP <- as(extent(-69, -63, 42, 45.5), "SpatialPolygons")
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)

ggplot(data = CTD, aes(x=Lon, y=Lat)) + 
 geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") + 
 geom_polygon(data=out,aes(x=long, y=lat, group=group),fill='burlywood4',col='black') +
 geom_point(pch=21, size = 2, fill = "White")+ ggtitle("CTD Cast Locations") + 
 labs(x=NULL, y=NULL) + 
 coord_map() + 
 theme(panel.background = element_rect(fill = "grey68"))
```

## Larval Project {.tabset}

### Scots Bay {.tabset}

#### Length Data {.tabset .tabset-pills}

##### Total 

```{r, results = "asis", fig.align='center'}
Larval1 <- subset.data.frame(Larval, Ground == "SB")

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=Julian, colour = Year)) +
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  labs(y="Length (mm)", x="Julian Date")

ggplot(Larval1, aes(Year, LengthAdjustment, colour = Year)) + 
  geom_boxplot() +
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  labs(y="Length (mm)")

Table = Larval1 %>%
  group_by(Year) %>%
  summarize(MinLength = min(LengthAdjustment),
            MaxLength = max(LengthAdjustment),
            AvgLength = mean(LengthAdjustment),
            AvgSD = mean(SD),
            Abundance = n()) %>%
  mutate_if(is.numeric, format, digits=2)

kbl(Table, col.names=c("Year", "Min Length (mm)", "Max Length (mm)", "Mean Length (mm)", "+/- SD (mm)", "Abundance"), align = "c") %>%
  kable_paper("striped", full_width = F)

TotalCategories <- Larval1 %>%
  group_by(category) %>%
  dplyr::summarize(n = n()) %>%
  mutate(Percentage = (n/sum(n))*100) %>%
  mutate_if(is.numeric, format, digits = 1) %>%
  mutate(Length = ifelse(category==1, "<8", 
                  ifelse(category==2, "8-12",
                  ifelse(category==3, "13-17",
                  ifelse(category==4, "18-27",
                  ifelse(category==5, ">28", NA)))))) %>%
  relocate(Length, .after = category) %>%
    mutate(Age = ifelse(category==1, "<2 weeks", 
                  ifelse(category==2, "2-5 weeks",
                  ifelse(category==3, "5-8 weeks",
                  ifelse(category==4, "8-14 weeks",
                  ifelse(category==5, ">14 weeks", NA)))))) %>%
  relocate(Age, .after = Length)

kbl(TotalCategories, col.names=c("Category", "Length (mm)", "Age", "Abundance", "%"), align = "c") %>%
  kable_paper("striped", full_width = F)
  
```


```{r, results = "asis", fig.align='center'}
for(i in unique(Larval$Year)) {
  
# In histogram, count is the number of individuals that fall into that length category over the whole year. It is split by colour into each individual survey. Each length category is therefore split up by number of individuals per survey.
  
  cat("\n")
  cat("#####", i, "\n")
  cat("\n")

Larval1 <- subset.data.frame(Larval, Ground == "SB")
Larval1 = Larval1 %>% filter(Year == i)

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=Julian, colour = id)) + 
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  labs(y="Length (mm)", x="Julian Day")

print(ggplot(data = subset(Larval1, Year == i), aes(x = Julian, y = LengthAdjustment, colour = id)) +
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  ylab("Length (mm)") + 
  xlab("Julian Day") +
  scale_y_continuous(limits = c(0, max(Larval1$LengthAdjustment))) + 
  scale_x_continuous(breaks = seq(from = 150, to = 270, by = 20)) +
  ggtitle(paste(i, "Scots Bay")))
  cat("\n")
  
print(ggplot(data = Larval1, (aes(LengthAdjustment, fill = id))) + 
  geom_histogram(binwidth=0.5, colour = "white") + 
  theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
  labs(x = "Length (mm)", y="Count"))
  cat("\n")
  
  Table = Larval1 %>% 
  group_by(Survey.No) %>%
  summarize(AvgLength = mean(LengthAdjustment),
            AvgSD = mean(SD),
            Abundance = n()) %>%
  mutate_if(is.numeric, format, digits=2)

print(kbl(Table, col.names=c("Survey #", "Mean Length (mm)", "+/- SD (mm)", "Abundance"), align = "c") %>%
  kable_paper("striped", full_width = F))
  cat("\n")
  
  TotalCategories <- Larval1 %>%
  group_by(category) %>%
  dplyr::summarize(n = n()) %>%
  mutate(Percentage = (n/sum(n))*100) %>%
  mutate_if(is.numeric, format, digits = 1) %>%
  mutate(Length = ifelse(category==1, "<8", 
                  ifelse(category==2, "8-12",
                  ifelse(category==3, "13-17",
                  ifelse(category==4, "18-27",
                  ifelse(category==5, ">28", NA)))))) %>%
  relocate(Length, .after = category) %>%
    mutate(Age = ifelse(category==1, "<2 weeks", 
                  ifelse(category==2, "2-5 weeks",
                  ifelse(category==3, "5-8 weeks",
                  ifelse(category==4, "8-14 weeks",
                  ifelse(category==5, ">14 weeks", NA)))))) %>%
  relocate(Age, .after = Length)

print(kbl(TotalCategories, col.names=c("Category", "Length (mm)", "Age", "Abundance", "%"), align = "c") %>%
  kable_paper("striped", full_width = F))
  cat("\n")
}
```

#### Mapped Data {.tabset .tabset-pills}

```{r message=FALSE, warning=FALSE}

CP <- as(extent(-66.5, -64.5, 44.5, 45.5), "SpatialPolygons") #set boundaries for Scots Bay before plotting
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)

```

##### Total

```{r echo=FALSE, fig.align='center'}
Larval2 <- subset(Larval, Ground == 'SB')
#Larval2 <- subset(Larval2, X > -66)

ggplot(Larval2, aes(x=X, y=Y)) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=polySB_main,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=SBplankton,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=SBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_polygon(data=polyNorthern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polyEastern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) + 
  geom_point(data=Larval2, aes(fill = Year), pch=21, alpha = 0.6) +
  labs(x=NULL, y=NULL) + 
  coord_map()
```

```{r, results = "asis", fig.align='center'}
for(i in unique(Larval$Year)) {
  
  cat("\n")
  cat("#####", i, "\n")
  cat("\n")

Larval1 = Larval %>% filter(Year == i) %>% filter(Ground == "SB")
Larval1 <- subset(Larval1, X > -66)
 
print(ggplot(Larval1, aes(x=X, y=Y)) + 
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=polySB_main,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=SBplankton,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=SBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_polygon(data=polyNorthern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polyEastern,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) + 
  geom_point(data=Larval1, aes(fill = category), pch=21, alpha = 0.6) +
  labs(x=NULL, y=NULL) + 
  coord_map())
  cat("\n")
  
  TotalCategories <- Larval1 %>%
  group_by(category) %>%
  dplyr::summarize(n = n()) %>%
  mutate(Percentage = (n/sum(n))*100) %>%
  mutate_if(is.numeric, format, digits = 1)

print(kbl(TotalCategories, col.names=c("Category", "Abundance", "%"), align = "c") %>%
  kable_paper("striped", full_width = F))
  cat("\n")
}
```

#### Depth Data {.tabset .tabset-pills}
##### Total

```{r echo=FALSE, fig.align='center'}

Larval1 = Larval %>% filter(Ground == "SB")

Larval1 %>% 
  ggplot(aes(AvgTowDepth, LengthAdjustment, colour = Year)) + 
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") + 
  scale_y_reverse() +
  labs(x = "Average Tow Depth (m)", y = "Larval Length (mm)", colour = "Category")

TotalCategories <- Larval1 %>%
  group_by(category) %>%
  summarize(n = n(),
            MeanDepth = mean(AvgTowDepth, na.rm = TRUE)) %>%
  mutate(Percentage = (n/sum(n))*100) %>%
  mutate_if(is.numeric, format, digits = 1) %>%
  relocate(MeanDepth, .after= Percentage)

kbl(TotalCategories, col.names=c("Category", "Abundance", "%", "Avg Tow Depth (m)"), align = "c") %>%
  kable_paper("striped", full_width = F)
```

```{r, results = "asis", fig.align='center'}
for(i in unique(Larval$Year)) {
  
  cat("\n")
  cat("#####", i, "\n")
  cat("\n")

Larval1 = Larval %>% filter(Year == i)
Larval1 = Larval1 %>% filter(Ground == "SB")
 
print(ggplot(data=Larval1, (aes(AvgTowDepth, LengthAdjustment, colour = id))) + 
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") + 
  scale_y_reverse() +
  labs(x = "Average Tow Depth (m)", y = "Larval Length (mm)", colour = "id")) 
  cat("\n")
  
  TotalCategories <- Larval1 %>%
  group_by(category) %>%
  summarize(n = n(),
            MeanDepth = mean(AvgTowDepth, na.rm = TRUE)) %>%
  mutate(Percentage = (n/sum(n))*100) %>%
  mutate_if(is.numeric, format, digits = 1) %>%
  relocate(MeanDepth, .after= Percentage)

print(kbl(TotalCategories, col.names=c("Category", "Abundance", "%", "Avg Tow Depth (m)"), align = "c") %>%
  kable_paper("striped", full_width = F))
  cat("\n")
}
```

#### Spawning Modes {.tabset .tabset-pills}

##### Total

Growth applied to compare spawning modes.

```{r, fig.align='center'}

# The following survey's did not use a flowmeter, therefore does not have water volume or larval density. This is only applicable to surveys that larvae were caught.
# Scots Bay 2017 Survey 1, 2, 6 & 7
# Scots Bay 2019 Survey 8
# Scots Bay 2020 Survey 7
# Scots Bay 2021 Survey 9 & 10
# German Bank 2021 Survey 4 & 5
# Seal Island 2019 Survey unknown, no record in raw data of this survey.
# Overall summary can be found in Volume and Density Investigation - NAs in Full Larval Spreadsheet. Saved under science team, larval project. 


Larval1 = LarvalSum %>% filter(Ground == "SB")

print(ggplot(Larval1, aes(x = Survey.No, y = Density, colour = Year)) + 
  geom_point() + 
  ylab("Density (Abundance/Volume)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(Larval1$Density))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle("Larval Density "))

print(ggplot(Larval1, aes(x = Survey.No, y = Abundance, colour = Year)) + 
  geom_point() + 
  ylab("Abundance (Count/Tow)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(Larval1$Abundance))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle("Larval Abundance"))

print(ggplot(Larval1, aes(x = Survey.No, y = MeanAgeInDays, colour = Year)) + 
  geom_point() + 
  ylab("Mean Age (days)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(Larval1$MeanAgeInDays))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle("Mean Larval Age of Each Individual Tow"))

```

```{r, results='asis', fig.align='center'}
 
for(i in unique(Larval$Year)) {
  cat("\n")
  cat("#####", i, "\n")
  cat("\n")

Larval1 = Larval %>% filter(Ground == "SB")
Larval1 = Larval1 %>% filter(Year == i)

Larval1$MonthDay <- format(Larval1$Date, "%m-%d")

  
print(ggplot(data = subset(Larval1, Year == i), aes(x = as.numeric(Survey.No), y = Density, colour = MonthDay)) + 
  geom_point() + 
  ylab("Density (Abundance/Volume)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(Larval1$Density))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle(paste(i, "Larval Density ")))
  cat("\n")

print(ggplot(Larval1, aes(x = as.numeric(Survey.No), y = Abundance, colour = MonthDay)) + 
  geom_point() + 
  ylab("Abundance (Larvae/Tow)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(Larval1$Abundance))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle(paste(i, "Larval Abundance ")))
  cat("\n")

print(ggplot(Larval1, aes(x = as.numeric(Survey.No), y = MeanAgeInDays, colour = MonthDay)) + 
  geom_point() + 
  ylab("Mean Age (days)") + 
  xlab("Survey Number") +
  xlim(0, 10) + 
  scale_y_continuous(limits = c(0, max(Larval1$MeanAgeInDays))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle(paste(i, " Mean Larval Age of Each Individual Tow")))
  cat("\n")
}
```

#### Individual Spawn Dates {.tabset}

##### Total

Dates individual larvae were spawned. Used an incubation period of 14 days.

```{r, results = 'asis', echo=FALSE, fig.align='center'}
# Changed AdjustedJulianSpawnDate to JulianSpawnDate

Larval1 <- Larval %>% filter(Ground == "SB")

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=JulianSpawnDate, colour = Year)) +
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  labs(y="Length (mm)", x="Spawn Date(Julian)")

#Possibly summarize this table? Use individual points for other graphs?


TotalCategories <- Larval1 %>% select("id", "Date", "Survey.No", "LengthAdjustment", "JulianSpawnDate", "TowReplicate", "TowID")

print(kbl(TotalCategories, align = "c") %>%
      kable_paper("striped", full_width = F))

```

##### Year {.tabset}

```{r, results = 'asis', echo=FALSE, fig.align='center'}

for(i in unique(Larval$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
  
Larval1 <- subset.data.frame(Larval, Ground == "SB")
Larval1 = Larval1 %>% filter(Year == i)
TotalCategories <- Larval1 %>% select("id", "Date", "Survey.No", "LengthAdjustment", "JulianSpawnDate", "TowReplicate", "TowID") 

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=JulianSpawnDate, colour = id)) + 
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  labs(y="Length (mm)", x="Spawn Date (Julian)")

print(ggplot(data = subset(Larval1, Year == i), aes(x = JulianSpawnDate, y = LengthAdjustment, colour = id))+
        geom_jitter(size = 1.25, width = 3) + 
        geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
        geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
        geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
        geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
        ylab("Length (mm)") + 
        xlab("Spawn Date (Julian)") +
        scale_y_continuous(limits = c(0,32)) + 
        scale_x_continuous(breaks = seq(from = 100, to = 300, by = 20)) +
        ggtitle(paste(i, "Scots Bay")))
        cat("\n")
  
print(kbl(TotalCategories, align = "c") %>%
      kable_paper("striped", full_width = F))
    
}
```


##### Tow ID {.tabset .tabset-fade .tabset-pills}

```{r, results = 'asis', echo=FALSE, fig.align='center'}
Larval1 <- subset(Larval, Ground == "SB")

for(i in unique(Larval1$TowID)) {
  
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=JulianSpawnDate, colour = id)) +
    geom_jitter(size = 1.25, width = 3) +
    geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  +
    geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  +
    geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") +
    geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
    labs(y="Length (mm)", x="Spawn Date (Julian)")

#when putting in the y_continuous max it drops a point. So have set to 32 and that seems to have solved the problem. Figure out a solution that can be more long term.
print(ggplot(data = subset(Larval1, TowID == i), aes(x = JulianSpawnDate, y = LengthAdjustment, colour = id))+
          geom_jitter(size = 1.25, width = 3) + 
          geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
          geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
          geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
          geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
          ylab("Length (mm)") + 
          xlab("Spawn Date (Julian)") +
          scale_y_continuous(limits = c(0,32)) + 
          scale_x_continuous(limits = c(100, 300)) +
          ggtitle(paste("Tow ID", i, "Scots Bay")))
          cat("\n")

TotalCategories <- Larval1 %>% select("id", "Date", "Survey.No", "LengthAdjustment", "JulianSpawnDate", "TowReplicate", "TowID") %>% filter(TowID == i)
          
print(kbl(TotalCategories, align = "c") %>%
        kable_paper("striped", full_width = F))
        cat("\n")
}
```

### German Bank {.tabset}
#### Length Data {.tabset .tabset-pills}

##### Total

```{r echo=FALSE, fig.align='center'}

Larval = Larval %>% filter(Ground == "GB")

Larval %>% ggplot(aes(y=LengthAdjustment, x=Julian, colour = Year)) + 
  geom_jitter(size = 1.25, width = 0.75) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  labs(y="Length (mm)", x="Julian Date")

ggplot(Larval, aes(Year, LengthAdjustment, colour = Year)) + 
  geom_boxplot() +
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  labs(y="Length (mm)")

Table = Larval %>%
  group_by(Year) %>%
  summarize(MinLength = min(LengthAdjustment),
            MaxLength = max(LengthAdjustment),
            AvgLength = mean(LengthAdjustment),
            AvgSD = mean(SD),
            Abundance = n()) %>%
  mutate_if(is.numeric, format, digits=2)

kbl(Table, col.names=c("Year", "Min Length (mm)", "Max Length (mm)", "Mean Length (mm)", "+/- SD (mm)", "Abundance"), align = "c") %>%
  kable_paper("striped", full_width = F)
```

```{r, results = "asis", fig.align='center'}

Larval1 = Larval %>% filter(Ground == "GB")

for(i in unique(Larval$Year)) {
  
# In histogram, count is the number of individuals that fall into that length category over the whole year. It is split by colour into each individual survey. Each length category is therefore split up by number of individuals per survey.
  
  cat("\n")
  cat("#####", i, "\n")
  cat("\n")

Larval1 = Larval1 %>% filter(Year == i)

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=Julian, colour = id)) + 
  geom_point() +
  labs(y="Length (mm)", x="Julian Day")

print(ggplot(data = subset(Larval1, Year == i), aes(x = Julian, y = LengthAdjustment, colour = id)) + 
  geom_point() +
  geom_jitter(width = .5) +
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  ylab("Length (mm)") + 
  xlab("Julian Day") +
  scale_y_continuous(limits = c(0, max(Larval1$LengthAdjustment))) + 
  scale_x_continuous(breaks = seq(from = min(Larval1$Julian), to = max(Larval1$Julian), by = 2)) +
  ggtitle(paste(i, "German Bank")))
  cat("\n")
 
print(ggplot(data = Larval1, (aes(LengthAdjustment, fill = id))) + 
  geom_histogram(binwidth=0.5, colour = "white") + 
  theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
  labs(x = "Length (mm)", y="Count"))
  cat("\n")
  
  Table = Larval1 %>% 
  group_by(Survey.No) %>%
  summarize(AvgLength = mean(LengthAdjustment),
            AvgSD = mean(SD),
            Abundance = n()) %>%
  mutate_if(is.numeric, format, digits=2)

print(kbl(Table, col.names=c("Survey #", "Mean Length (mm)", "+/- SD (mm)", "Abundance"), align = "c") %>%
  kable_paper("striped", full_width = F))
  cat("\n")
}
```

#### Mapped Data {.tabset .tabset-pills}

```{r message=FALSE, warning=FALSE}
CP <- as(extent(-66.5, -65.75, 43, 43.7), "SpatialPolygons") #set boundaries for German Bank before plotting
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)
```

##### Total

```{r echo=FALSE, fig.align='center'}

Larval2 <- subset(Larval, Ground == 'GB')

ggplot(Larval2, aes(x=X, y=Y)) + 
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=polyGB,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=GBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_polygon(data=polySI,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_point(data=Larval2, aes(fill = Year), pch=21, alpha = 0.6) +
  labs(x=NULL, y=NULL) +   coord_map()

```



```{r, results = "asis", fig.align='center'}
for(i in unique(Larval$Year)) {
  
  cat("\n")
  cat("#####", i, "\n")
  cat("\n")

Larval1 = Larval %>% filter(Year == i) %>% filter()
 
print(ggplot(Larval1, aes(x=X, y=Y)) + 
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=GBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_polygon(data=polyGB,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polySI,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) + 
  geom_point(data=Larval1, aes(fill = category), pch=21, alpha = 0.6) +
  labs(x=NULL, y=NULL) + 
  coord_map())
  cat("\n")
  
  TotalCategories <- Larval1 %>%
  group_by(category) %>%
  dplyr::summarize(n = n()) %>%
  mutate(Percentage = (n/sum(n))*100) %>%
  mutate_if(is.numeric, format, digits = 1)

print(kbl(TotalCategories, col.names=c("Category", "Abundance", "%"), align = "c") %>%
  kable_paper("striped", full_width = F))
  cat("\n")
}
```

#### Depth Data {.tabset .tabset-pills}
##### Total

```{r echo=FALSE, fig.align='center'}

Larval1 = Larval %>% filter(Ground == "GB")

Larval1 %>% 
  ggplot(aes(AvgTowDepth, LengthAdjustment, colour = Year)) + 
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") + 
  scale_y_reverse() +
  labs(x = "Average Tow Depth (m)", y = "Larval Length (mm)", colour = "Category") 

TotalCategories <- Larval1 %>%
  group_by(category) %>%
  summarize(n = n(),
            MeanDepth = mean(AvgTowDepth, na.rm = TRUE)) %>%
  mutate(Percentage = (n/sum(n))*100) %>%
  mutate_if(is.numeric, format, digits = 1) %>%
  relocate(MeanDepth, .after= Percentage)

kbl(TotalCategories, col.names=c("Category", "Abundance", "%", "Avg Tow Depth (m)"), align = "c") %>%
  kable_paper("striped", full_width = F)
```

```{r, results = "asis", fig.align='center'}
for(i in unique(Larval$Year)) {
  
  cat("\n")
  cat("#####", i, "\n")
  cat("\n")

Larval1 = Larval %>% filter(Year == i)
Larval1 = Larval1 %>% filter(Ground == "GB")
 
print(ggplot(data = Larval1, aes(AvgTowDepth, LengthAdjustment, colour = Year)) + 
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") + 
  scale_y_reverse() +
  labs(x = "Average Tow Depth (m)", y = "Larval Length (mm)", colour = "Category"))
  cat("\n")
  
  TotalCategories <- Larval1 %>%
  group_by(category) %>%
  summarize(n = n(),
            MeanDepth = mean(AvgTowDepth, na.rm = TRUE)) %>%
  mutate(Percentage = (n/sum(n))*100) %>%
  mutate_if(is.numeric, format, digits = 1) %>%
  relocate(MeanDepth, .after= Percentage)

print(kbl(TotalCategories, col.names=c("Category", "Abundance", "%", "Avg Tow Depth (m)"), align = "c") %>%
  kable_paper("striped", full_width = F))
  cat("\n")
}
```

#### Spawning Modes {.tabset .tabset-pills}

##### Total

Growth applied to compare spawning modes.

```{r, fig.align='center'}

#Should x be Julian date and colour be survey number instead of year?
#Need to add in Larval summary table within compendium

GBLarvalSum = LarvalSum %>% filter(Ground == "GB")

#GBLarvalSum$Density[is.na(GBLarvalSum$Density)] = 0
#GBLarvalSum$Abundance[is.na(GBLarvalSum$Abundance)] = 0
#GBLarvalSum$MeanAgeInDays[is.na(GBLarvalSum$MeanAgeInDays)] = 0

print(ggplot(GBLarvalSum, aes(x = Survey.No, y = Density, colour = Year)) + 
  geom_point() + 
  ylab("Density (Abundance/Volume)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(GBLarvalSum$Density))) +
  scale_x_continuous(limits = c(1, 10), breaks = seq(1,10,1)) +
  ggtitle("Larval Density "))

print(ggplot(GBLarvalSum, aes(x = Survey.No, y = Abundance, colour = Year)) + 
  geom_point() + 
  ylab("Abundance (Larvae/Tow)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(GBLarvalSum$Abundance))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle("Larval Abundance "))

print(ggplot(GBLarvalSum, aes(x = Survey.No, y = MeanAgeInDays, colour = Year)) + 
  geom_point() + 
  ylab("Mean Larval Age (days)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(GBLarvalSum$MeanAgeInDays))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle("Mean Larval Age of Individual Tows"))

```


```{r, results='asis', fig.align='center'}
 
for(i in unique(Larval$Year)) {
  cat("\n")
  cat("#####", i, "\n")
  cat("\n")

Larval1 = LarvalSum %>% filter(Ground == "GB")
Larval1 = Larval1 %>% filter(Year == i)
#Larval1$Density[is.na(Larval1$Density)] <- 0
#Larval1$Abundance[is.na(Larval1$Abundance)] <- 0
#Larval1$MeanAgeInDays[is.na(Larval1$MeanAgeInDays)] <- 0

Larval1$MonthDay <- format(Larval1$Date, "%m-%d")

  
print(ggplot(data = subset(Larval1, Year == i), aes(x = as.numeric(Survey.No), y = Density, colour = MonthDay)) + 
  geom_point() + 
  ylab("Density (Abundance/Volume)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(Larval1$Density))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle(paste(i, "Larval Density ")))
  cat("\n")

print(ggplot(Larval1, aes(x = as.numeric(Survey.No), y = Abundance, colour = MonthDay)) + 
  geom_point() + 
  ylab("Abundance (Larvae/Tow)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(Larval1$Abundance))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle(paste(i, "Larval Abundance ")))
  cat("\n")

print(ggplot(Larval1, aes(x = as.numeric(Survey.No), y = MeanAgeInDays, colour = MonthDay)) + 
  geom_point() + 
  ylab("Mean Age (days)") + 
  xlab("Survey Number") +
  xlim(0, 10) + 
  scale_y_continuous(limits = c(0, max(Larval1$MeanAgeInDays))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle(paste(i, "Mean Larval Age in Days")))
  cat("\n")
}
```

#### Individual Spawn Dates {.tabset}

##### Total

Dates individual larvae were spawned. Used an incubation period of 10 days.

```{r, results = 'asis', echo=FALSE, fig.align='center'}

Larval1 <- Larval %>% filter(Ground == "GB")

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=JulianSpawnDate, colour = Year)) +
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  scale_y_continuous(limits = c(0,32)) + 
  scale_x_continuous(breaks = seq(from = 150, to = 300, by = 20)) +
  labs(y="Length (mm)", x="Spawn Date(Julian)")

#Possibly summarize this table? Use individual points for other graphs?
TotalCategories <- Larval1 %>% select("id", "Date", "Survey.No", "LengthAdjustment", "JulianSpawnDate", "TowReplicate", "TowID")

print(kbl(TotalCategories, align = "c") %>%
      kable_paper("striped", full_width = F))

```

##### Year {.tabset}

```{r, results = 'asis', echo=FALSE, fig.align='center'}

for(i in unique(Larval$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
  
Larval1 <- subset.data.frame(Larval, Ground == "GB")
Larval1 = Larval1 %>% filter(Year == i)
TotalCategories <- Larval1 %>% select("id", "Date", "Survey.No", "LengthAdjustment", "JulianSpawnDate", "TowReplicate", "TowID") 

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=JulianSpawnDate, colour = id)) + 
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  labs(y="Length (mm)", x="Spawn Date (Julian)")

print(ggplot(data = subset(Larval1, Year == i), aes(x = JulianSpawnDate, y = LengthAdjustment, colour = id))+
        geom_jitter(size = 1.25, width = 3) + 
        geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
        geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
        geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
        geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
        ylab("Length (mm)") + 
        xlab("Spawn Date (Julian)") +
        scale_y_continuous(limits = c(0,32)) + 
        scale_x_continuous(breaks = seq(from = 150, to = 300, by = 20)) +
        ggtitle(paste(i, "German Bank")))
        cat("\n")
  
print(kbl(TotalCategories, align = "c") %>%
      kable_paper("striped", full_width = F))
    
}
```


##### Tow ID {.tabset .tabset-fade .tabset-pills}

```{r, results = 'asis', echo=FALSE, fig.align='center'}
Larval1 <- subset(Larval, Ground == "GB")

for(i in unique(Larval$TowID)) {
  
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=JulianSpawnDate, colour = id)) +
    geom_jitter(size = 1.25, width = 3) +
    geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  +
    geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  +
    geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") +
    geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
    labs(y="Length (mm)", x="Spawn Date (Julian)")

#when putting in the y_continuous max it drops a point. So have set to 32 and that seems to have solved the problem. Figure out a solution that can be more long term.
print(ggplot(data = subset(Larval1, TowID == i), aes(x = JulianSpawnDate, y = LengthAdjustment, colour = id))+
          geom_jitter(size = 1.25, width = 3) + 
          geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
          geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
          geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
          geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
          ylab("Length (mm)") + 
          xlab("Spawn Date (Julian)") +
          scale_y_continuous(limits = c(0,32)) + 
          scale_x_continuous(limits = c(100, 300)) +
          ggtitle(paste("Tow ID", i, "German Bank")))
          cat("\n")

TotalCategories <- Larval1 %>% select("id", "Date", "Survey.No", "LengthAdjustment", "JulianSpawnDate", "TowReplicate", "TowID")
          
print(kbl(TotalCategories, align = "c") %>%
        kable_paper("striped", full_width = F))
        cat("\n")
}
```
### Seal Island {.tabset}
#### Length Data {.tabset .tabset-pills}

##### Total

```{r echo=FALSE, fig.align='center'}

Larval = LarvalSI

Larval %>% ggplot(aes(y=LengthAdjustment, x=Julian, colour = Year)) + 
  geom_point() +
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  scale_x_continuous(labels = scales::label_number(1), limits = c(284, 288)) +
  labs(y="Length (mm)", x="Julian Date of Collection")

ggplot(Larval, aes(Year, LengthAdjustment, colour = Year)) + 
  geom_boxplot() +
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  labs(y="Length (mm)")

Table = Larval %>%
  group_by(Year) %>%
  summarize(MinLength = min(LengthAdjustment),
            MaxLength = max(LengthAdjustment),
            AvgLength = mean(LengthAdjustment),
            AvgSD = mean(SD),
            Abundance = n()) %>%
  mutate_if(is.numeric, format, digits=2)

kbl(Table, col.names=c("Year", "Min Length (mm)", "Max Length (mm)", "Mean Length (mm)", "+/- SD (mm)", "Abundance"), align = "c") %>%
  kable_paper("striped", full_width = F)
```

```{r, results = "asis", fig.align='center'}
for(i in unique(Larval$Year)) {
  
# In histogram, count is the number of individuals that fall into that length category over the whole year. It is split by colour into each individual survey. Each length category is therefore split up by number of individuals per survey.
  
  cat("\n")
  cat("#####", i, "\n")
  cat("\n")

Larval1 = LarvalSI %>% filter(Year == i)

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=Julian, colour = id)) + 
  geom_point() +
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  labs(y="Length (mm)", x="Julian Day")

print(ggplot(data = subset(Larval1, Year == i), aes(x = Julian, y = LengthAdjustment, colour = id)) + 
  geom_point() +
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  geom_jitter(width = .5) +
  ylab("Length (mm)") + 
  xlab("Julian Day") +
  scale_y_continuous(limits = c(0, max(Larval1$LengthAdjustment))) + 
  scale_x_continuous(breaks = seq(from = min(Larval1$Julian), to = max(Larval1$Julian), by = 2)) +
  ggtitle(paste(i, "Seal Island")))
  cat("\n")
 
print(ggplot(data = Larval1, (aes(LengthAdjustment, fill = id))) + 
  geom_histogram(binwidth=0.5, colour = "white") + 
  theme(panel.background = element_rect(fill = "white", colour = "grey50")) + 
  labs(x = "Length (mm)", y="Count"))
  cat("\n")
  
## This is the same plot but a different format.
  
#print(ggplot(data=Larval1, aes(LengthAdjustment, colour = Survey.No)) + 
#  geom_freqpoly(bins=100, linewidth = 1) +
#  labs(y="Count", x="Length (mm)"))
#  cat("\n")
  
  Table = Larval1 %>% 
  group_by(Survey.No) %>%
  summarize(AvgLength = mean(LengthAdjustment),
            AvgSD = mean(SD),
            Abundance = n()) %>%
  mutate_if(is.numeric, format, digits=2)

print(kbl(Table, col.names=c("Survey #", "Mean Length (mm)", "+/- SD (mm)", "Abundance"), align = "c") %>%
  kable_paper("striped", full_width = F))
  cat("\n")
}
```



#### Mapped Data {.tabset .tabset-pills}

```{r message=FALSE, warning=FALSE}
CP <- as(extent(-66.5, -65.5, 43, 44), "SpatialPolygons") #set boundaries for German Bank before plotting
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)
```

##### Total

```{r echo=FALSE, fig.align='center'}

Larval2 <- subset(Larval, Ground == 'SI')

ggplot(Larval2, aes(x=X, y=Y)) + 
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=polyGB,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=GBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_polygon(data=polySI,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_point(data=Larval2, aes(fill = Year), pch=21, alpha = 0.6) +
  labs(x=NULL, y=NULL) + 
  coord_map()

```



```{r, results = "asis", fig.align='center'}
for(i in unique(Larval$Year)) {
  
  cat("\n")
  cat("#####", i, "\n")
  cat("\n")

Larval1 = Larval %>% filter(Year == i) %>% filter()
 
print(ggplot(Larval1, aes(x=X, y=Y)) + 
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +  
  geom_polygon(data=GBCTD,aes(x=X, y=Y, group=PID), colour = "black", fill = "white", linetype = 3) +
  geom_polygon(data=polyGB,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) +
  geom_polygon(data=polySI,aes(x=X, y=Y, group=PID), colour = "black", fill="white",linetype = 3) + 
  geom_point(data=Larval1, aes(fill = category), pch=21, alpha = 0.6) +
  labs(x=NULL, y=NULL) + 
  coord_map())
  cat("\n")
  
  TotalCategories <- Larval1 %>%
  group_by(category) %>%
  dplyr::summarize(n = n()) %>%
  mutate(Percentage = (n/sum(n))*100) %>%
  mutate_if(is.numeric, format, digits = 1)

print(kbl(TotalCategories, col.names=c("Category", "Abundance", "%"), align = "c") %>%
  kable_paper("striped", full_width = F))
  cat("\n")
}
```

#### Depth Data {.tabset .tabset-pills}
##### Total

```{r echo=FALSE, fig.align='center'}

LarvalSI %>% 
  ggplot(aes(AvgTowDepth, LengthAdjustment, colour = Year)) + 
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") + 
  scale_y_reverse() +
  labs(x = "Average Tow Depth (m)", y = "Larval Length (mm)", colour = "Category") 

TotalCategories <- LarvalSI %>%
  group_by(category) %>%
  summarize(n = n(),
            MeanDepth = mean(AvgTowDepth, na.rm = TRUE)) %>%
  mutate(Percentage = (n/sum(n))*100) %>%
  mutate_if(is.numeric, format, digits = 1) %>%
  relocate(MeanDepth, .after= Percentage)

kbl(TotalCategories, col.names=c("Category", "Abundance", "%", "Avg Tow Depth (m)"), align = "c") %>%
  kable_paper("striped", full_width = F)
```

```{r, results = "asis", fig.align='center'}
for(i in unique(Larval$Year)) {
  
  cat("\n")
  cat("#####", i, "\n")
  cat("\n")

Larval1 = LarvalSI %>% filter(Year == i)
 
print(ggplot(data = Larval1, aes(AvgTowDepth, LengthAdjustment, colour = Year)) + 
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") + 
  scale_y_reverse() +
  labs(x = "Average Tow Depth (m)", y = "Larval Length (mm)", colour = "Category"))
  cat("\n")
  
  TotalCategories <- Larval1 %>%
  group_by(category) %>%
  summarize(n = n(),
            MeanDepth = mean(AvgTowDepth, na.rm = TRUE)) %>%
  mutate(Percentage = (n/sum(n))*100) %>%
  mutate_if(is.numeric, format, digits = 1) %>%
  relocate(MeanDepth, .after= Percentage)

print(kbl(TotalCategories, col.names=c("Category", "Abundance", "%", "Avg Tow Depth (m)"), align = "c") %>%
  kable_paper("striped", full_width = F))
  cat("\n")
}
```

#### Spawning Modes {.tabset .tabset-pills}

##### Total

Growth applied to compare spawning modes.

```{r, fig.align='center'}

LarvalSum = LarvalSum %>% filter(Ground == "SI")

print(ggplot(LarvalSum, aes(x = Survey.No, y = Density, colour = Year)) + 
  geom_point() + 
  ylab("Density (Abundance/Volume)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(LarvalSum$Density))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle("Larval Density "))

print(ggplot(LarvalSum, aes(x = Survey.No, y = Abundance, colour = Year)) + 
  geom_point() + 
  ylab("Abundance (Larvae/Tow)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(LarvalSum$Abundance))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle("Larval Abundance "))

print(ggplot(LarvalSum, aes(x = Survey.No, y = MeanAgeInDays, colour = Year)) + 
  geom_point() + 
  ylab("Mean Age (days)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(LarvalSum$MeanAgeInDays))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle("Mean Larval Age in Days"))

```


```{r, results='asis', fig.align='center'}
 
for(i in unique(Larval$Year)) {
  cat("\n")
  cat("#####", i, "\n")
  cat("\n")

LarvalSum = LarvalSum %>% filter(Year == i)
#LarvalSum$Density[is.na(LarvalSum$Density)] <- 0
#LarvalSum$Abundance[is.na(LarvalSum$Abundance)] <- 0
#LarvalSum$MeanAgeInDays[is.na(LarvalSum$MeanAgeInDays)] <- 0

LarvalSum$MonthDay <- format(LarvalSum$Date, "%m-%d")

  
print(ggplot(data = subset(LarvalSum, Year == i), aes(x = as.numeric(Survey.No), y = Density, colour = MonthDay)) + 
  geom_point() + 
  ylab("Density (Abundance/Volume)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(LarvalSum$Density))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle(paste(i, "Larval Density ")))
  cat("\n")

print(ggplot(LarvalSum, aes(x = as.numeric(Survey.No), y = Abundance, colour = MonthDay)) + 
  geom_point() + 
  ylab("Abundance (Larvae/Tow)") + 
  xlab("Survey Number") +
  scale_y_continuous(limits = c(0, max(LarvalSum$Abundance))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle(paste(i, "Larval Abundance ")))
  cat("\n")

print(ggplot(LarvalSum, aes(x = as.numeric(Survey.No), y = MeanAgeInDays, colour = MonthDay)) + 
  geom_point() + 
  ylab("Mean Age (days)") + 
  xlab("Survey Number") +
  xlim(0, 10) + 
  scale_y_continuous(limits = c(0, max(LarvalSum$MeanAgeInDays))) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  ggtitle(paste(i, "Mean Larval Age of Each Individual Tow")))
  cat("\n")
}
```

#### Individual Spawn Dates {.tabset}

##### Total

Dates individual larvae were spawned. Used an incubation period of 10 days.

```{r, results = 'asis', echo=FALSE, fig.align='center'}

Larval1 <- Larval %>% filter(Ground == "SI")

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=JulianSpawnDate, colour = Year)) +
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  labs(y="Length (mm)", x="Spawn Date(Julian)")

#Possibly summarize this table? Use individual points for other graphs?
TotalCategories <- Larval1 %>% select("id", "Date", "Survey.No", "LengthAdjustment", "JulianSpawnDate", "TowReplicate", "TowID")

print(kbl(TotalCategories, align = "c") %>%
      kable_paper("striped", full_width = F))

```

##### Year {.tabset}

```{r, results = 'asis', echo=FALSE, fig.align='center'}

Larval1 <- subset.data.frame(Larval, Ground == "SI")

for(i in unique(Larval$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
Larval1 = Larval1 %>% filter(Year == i)
TotalCategories <- Larval1 %>% select("id", "Date", "Survey.No", "LengthAdjustment", "JulianSpawnDate", "TowReplicate", "TowID") 

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=JulianSpawnDate, colour = id)) + 
  geom_jitter(size = 1.25, width = 3) + 
  geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
  geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
  geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
  geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
  labs(y="Length (mm)", x="Spawn Date (Julian)")

print(ggplot(data = subset(Larval1, Year == i), aes(x = JulianSpawnDate, y = LengthAdjustment, colour = id))+
        geom_jitter(size = 1.25, width = 3) + 
        geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
        geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
        geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
        geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
        ylab("Length (mm)") + 
        xlab("Spawn Date (Julian)") +
        scale_y_continuous(limits = c(0,30)) + 
        scale_x_continuous(breaks = seq(from = 150, to = 300, by = 20)) +
        ggtitle(paste(i, "Seal Island")))
        cat("\n")
  
print(kbl(TotalCategories, align = "c") %>%
      kable_paper("striped", full_width = F))
    
}
```


##### Tow ID {.tabset .tabset-fade .tabset-pills}

```{r, results = 'asis', echo=FALSE, fig.align='center'}
Larval1 <- subset(Larval, Ground == "SI")

for(i in unique(Larval$TowID)) {
  
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")

Larval1 %>% ggplot(aes(y=LengthAdjustment, x=JulianSpawnDate, colour = id)) +
    geom_jitter(size = 1.25, width = 3) +
    geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  +
    geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  +
    geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") +
    geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
    labs(y="Length (mm)", x="Spawn Date (Julian)")

#when putting in the y_continuous max it drops a point. So have set to 32 and that seems to have solved the problem. Figure out a solution that can be more long term.
print(ggplot(data = subset(Larval1, TowID == i), aes(x = JulianSpawnDate, y = LengthAdjustment, colour = id))+
          geom_jitter(size = 1.25, width = 3) + 
          geom_hline(yintercept = 8, linetype = "longdash", size =1, colour = "red")  + 
          geom_hline(yintercept = 12, linetype = "longdash", size =1, colour = "blue")  + 
          geom_hline(yintercept = 17, linetype = "longdash", size =1, colour = "forestgreen") + 
          geom_hline(yintercept = 27, linetype = "longdash", size =1, colour = "grey70") +
          ylab("Length (mm)") + 
          xlab("Spawn Date (Julian)") +
          scale_y_continuous(limits = c(0,32)) + 
          scale_x_continuous(limits = c(100, 300)) +
          ggtitle(paste("Tow ID", i, "Seal Island")))
          cat("\n")

TotalCategories <- Larval1 %>% select("id", "Date", "Survey.No", "LengthAdjustment", "JulianSpawnDate", "TowReplicate", "TowID")
          
print(kbl(TotalCategories, align = "c") %>%
        kable_paper("striped", full_width = F))
        cat("\n")
}
```

## Fat Project 

### Spatial Analysis {.tabset .tabset-pills}

#### By Ground {.tabset .tabset-pills}

##### Total

```{r}

# can<-getData('GADM', country="CAN", level=1)
# us = getData('GADM', country = "USA", level = 1)
# can1 = rbind(can,us)
# NBNS <- can1[can1@data$NAME_1%in%c("New Brunswick","Nova Scotia","Prince Edward Island","Newfoundland and Labrador","Québec", "Maine", "New Hampshire", "Massachusetts", "Connecticut", "Rhode Island", "New York", "Vermont", "New Jersey"),]

CP <- as(extent(-73, -61, 40.5, 46), "SpatialPolygons")
proj4string(CP) <- CRS(proj4string(NBNS))
out <- crop(NBNS, CP, byid=TRUE)

pal <- colorNumeric(
  palette = "Reds",
  domain = FatData$Fat)

FatDataSum = FatData %>%
  group_by(Date, Lat, Lon) %>%
  summarize(Fat = mean(Fat))
leaflet(FatDataSum, options = leafletOptions(preferCanvas = TRUE)) %>% 
  addCircles(data = subset(FatDataSum, Lat > 40 & Lat < 47), color=~pal(Fat), popup = ~as.character(Fat)) %>%
  addProviderTiles(providers$CartoDB.Positron, options = providerTileOptions(updateWhenZooming = FALSE, updateWhenIdle = TRUE)) %>%
  clearBounds() %>%
  addLegend("bottomright", pal = pal, values = ~Fat,
    title = "Fat Percent (%)",
    labFormat = labelFormat(suffix = "%"),
    opacity = 1)

```

##### January {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center', fig.width = 14} 
for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 1)

print(FatData1 %>%
  ggplot(aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
  geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
  scale_color_viridis_c(direction=-1) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
  coord_map() +
  theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))

  cat("\n")

}
```
  
##### February {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center', fig.width = 14} 
for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 2) 

print(FatData1 %>%
  ggplot(aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
  geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
  scale_color_viridis_c(direction=-1) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
  coord_map() +
  theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10))) 

cat("\n")
}
```

##### March {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center', fig.width = 14} 
for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 3)

print(FatData1 %>%
  ggplot(aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
  geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
  scale_color_viridis_c(direction=-1) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
  coord_map() +
  theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))

  cat("\n")
}

```

##### April{.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center', fig.width = 14} 
for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 4)

print(FatData1 %>%
  ggplot(aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
  geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
  scale_color_viridis_c(direction=-1) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
  coord_map() +
  theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))

  cat("\n")
}
```

##### May {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center', fig.width = 14} 
for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 5)

print(FatData1 %>%
  ggplot(aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
  geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
  scale_color_viridis_c(direction=-1) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
  coord_map() +
  theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))

  cat("\n")
}
```

##### June{.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center', fig.width = 14} 
for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 6)

print(FatData1 %>%
  ggplot(aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
  geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
  scale_color_viridis_c(direction=-1) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
  coord_map() +
  theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))

  cat("\n")
}

```

##### July{.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center', fig.width = 14} 
for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 7)

print(FatData1 %>%
  ggplot(aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
  geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
  scale_color_viridis_c(direction=-1) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
  coord_map() +
  theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))

  cat("\n")
}
```

##### August{.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center', fig.width = 14} 
for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 8)

print(FatData1 %>%
  ggplot(aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
  geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
  scale_color_viridis_c(direction=-1) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
  coord_map() +
  theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))

  cat("\n")
}

```

##### September{.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center', fig.width = 14} 
for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 9)

print(FatData1 %>%
  ggplot(aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
  geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
  scale_color_viridis_c(direction=-1) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
  coord_map() +
  theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))

  cat("\n")
}
```

##### October{.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center', fig.width = 14} 
for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 10)

print(FatData1 %>%
  ggplot(aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
  geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
  scale_color_viridis_c(direction=-1) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
  coord_map() +
  theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))

  cat("\n")
}
```

##### November{.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center', fig.width = 14} 
for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 11)

print(FatData1 %>%
  ggplot(aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
  geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
  scale_color_viridis_c(direction=-1) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
  coord_map() +
  theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))

  cat("\n")
}
```

##### December {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center', fig.width = 14} 
for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 12)

print(FatData1 %>%
  ggplot(aes(x=Lon, y=Lat)) + 
  geom_polygon(data=polysT,aes(x=X, y=Y, group=Box, fill = Box), colour = "black") +
  geom_point(data=subset(FatData1, Lat < 46 & Lat > 40 & Year == i), aes(color=Fat)) +
  scale_color_viridis_c(direction=-1) +
  geom_polygon(data=out,aes(x=long, y=lat, group=group)) +
  coord_map() +
  theme(legend.position = 'bottom', legend.title = element_text(size = 10), legend.text = element_text(size=10)))

  cat("\n")
}
```


#### By Latitude {.tabset .tabset-pills}

##### Total

```{r}
library(scales)


FatData %>%
  filter(!is.na(Lat)) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)")

```

##### January {.tabset .tabset-pills}

```{r, results = "asis", fig.align='center'}

for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 1) %>% filter(!is.na(Lat))


print(FatData1 %>%
  filter(Year == i) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)"))

cat("\n")

}
```

##### February {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center'}

for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 2) %>% filter(!is.na(Lat))

print(FatData1 %>%
  filter(Year == i) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)"))

cat("\n")

}
```

##### March {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center'}

for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 3) %>% filter(!is.na(Lat))

print(FatData1 %>%
  filter(Year == i) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)"))

cat("\n")

}
```

##### April {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center'}

for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 4) %>% filter(!is.na(Lat))

print(FatData1 %>%
  filter(Year == i) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)"))

cat("\n")

}
```

##### May {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center'}

for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 5) %>% filter(!is.na(Lat))

print(FatData1 %>%
  filter(Year == i) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)"))

cat("\n")

}
```

##### June {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center'}

for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 6) %>% filter(!is.na(Lat))

print(FatData1 %>%
  filter(Year == i) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)"))

cat("\n")

}
```

##### July {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center'}

for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 7) %>% filter(!is.na(Lat))

print(FatData1 %>%
  filter(Year == i) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)"))

cat("\n")

}
```

##### August {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center'}

for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 8) %>% filter(!is.na(Lat))

print(FatData1 %>%
  filter(Year == i) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)"))

cat("\n")

}
```


##### September {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center'}

for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 9) %>% filter(!is.na(Lat))

print(FatData1 %>%
  filter(Year == i) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)"))

cat("\n")

}
```

##### October {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center'}

for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 10) %>% filter(!is.na(Lat))

print(FatData1 %>%
  filter(Year == i) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)"))

cat("\n")

}
```

##### November {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center'}

for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 11) %>% filter(!is.na(Lat))

print(FatData1 %>%
  filter(Year == i) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)"))

cat("\n")

}
```

##### December {.tabset .tabset-fade .tabset-pills}

```{r, results = "asis", fig.align='center'}

for(i in unique(FatData$Year)) {
  
  cat("\n")
  cat("######", i, "\n")
  cat("\n")
  
FatData1 = FatData %>% filter(Month == 12) %>% filter(!is.na(Lat))

print(FatData1 %>%
  filter(Year == i) %>%
  mutate(Lat = format(round(Lat, 1), nsmall = 1)) %>%
ggplot(aes(x=Fat, y=Lat, group = Lat, fill = Lat)) +
  geom_density_ridges(rel_min_height = 0.01) +
  theme(legend.position = "none") +
  labs(y="Latitude", x="Fat Percentage (%)"))

cat("\n")

}

```


#### By Company {.tabset .tabset-pills}

##### Total

::: row
::: col-md-6
```{r echo=FALSE}
FatDataSum = FatData
FatData$Year = as.factor(FatData$Year)
ggplot(data=FatData, aes(x=Year, y=Fat)) +
  geom_boxplot() +
  labs(y="Fat Percent (%)")
```
:::

::: col-md-6
```{r echo=FALSE}
FatData %>%
  group_by(Year) %>%
  summarize(FatMean = mean(Fat)) %>%
  kbl(col.names = c("Year", "Avg Fat (%)")) %>%
  kable_paper("striped", full_width = F)
```
:::
:::

##### Connors {.tabset .tabset-fade .tabset-pills}

###### By Year
```{r echo=FALSE}

ggplot(data=subset(FatData, Supplier == "Connors"), aes(x=Year, y=Fat)) +
  geom_boxplot() +
  labs(y="Fat Percent (%)")

FatData %>%
  dplyr::filter(Supplier == "Connors") %>%
  group_by(Year) %>%
  summarize(FatMean = mean(Fat)) %>%
  kbl(col.names = c("Year", "Avg Fat (%)")) %>%
  kable_paper("striped", full_width = F)

```

###### By Month

```{r echo=FALSE}
ggplot(data=subset(FatData, Supplier == "Connors" & !is.na(Month)), aes(x=Month, y=Fat, group=Month)) +
  geom_boxplot() +
  scale_x_continuous(breaks = round(seq(min(FatData$Month, max(FatData$Month), by = 1), 12)) ) +
  labs(y="Fat Percent (%)")

FatData %>%
  dplyr::filter(Supplier == "Connors" & !is.na(Month)) %>%
  group_by(Month) %>%
  summarize(FatMean = mean(Fat)) %>%
  kbl(col.names = c("Month", "Avg Fat (%)")) %>%
  kable_paper("striped", full_width = F)

```

##### Comeaus {.tabset .tabset-fade .tabset-pills}

###### By Year
```{r echo=FALSE}

ggplot(data=subset(FatData, Supplier == "Comeaus"), aes(x=Year, y=Fat)) +
  geom_boxplot() +
  labs(y="Fat Percent (%)")

FatData %>%
  dplyr::filter(Supplier == "Comeaus") %>%
  group_by(Year) %>%
  summarize(FatMean = mean(Fat)) %>%
  kbl(col.names = c("Year", "Avg Fat (%)")) %>%
  kable_paper("striped", full_width = F)

```

###### By Month

```{r echo=FALSE}
ggplot(data=subset(FatData, Supplier == "Comeaus" & !is.na(Month)), aes(x=Month, y=Fat, group=Month)) +
  geom_boxplot() +
  scale_x_continuous(breaks = round(seq(min(FatData$Month, max(FatData$Month), by = 1), 12)) ) +
  labs(y="Fat Percent (%)")

FatData %>%
  dplyr::filter(Supplier == "Connors" & !is.na(Month)) %>%
  group_by(Month) %>%
  summarize(FatMean = mean(Fat)) %>%
  kbl(col.names = c("Month", "Avg Fat (%)")) %>%
  kable_paper("striped", full_width = F)

```

##### Scotia {.tabset .tabset-fade .tabset-pills}

###### By Year
```{r echo=FALSE}

ggplot(data=subset(FatData, Supplier == "Scotia"), aes(x=Year, y=Fat)) +
  geom_boxplot() +
  labs(y="Fat Percent (%)")

FatData %>%
  dplyr::filter(Supplier == "Scotia") %>%
  group_by(Year) %>%
  summarize(FatMean = mean(Fat)) %>%
  kbl(col.names = c("Year", "Avg Fat (%)")) %>%
  kable_paper("striped", full_width = F)

```

###### By Month 

```{r echo=FALSE}
ggplot(data=subset(FatData, Supplier == "Comeaus" & !is.na(Month)), aes(x=Month, y=Fat, group=Month)) +
  geom_boxplot() +
  scale_x_continuous(breaks = round(seq(min(FatData$Month, max(FatData$Month), by = 1), 12)) ) +
  labs(y="Fat Percent (%)")

FatData %>%
  dplyr::filter(Supplier == "Connors" & !is.na(Month)) %>%
  group_by(Month) %>%
  summarize(FatMean = mean(Fat)) %>%
  kbl(col.names = c("Month", "Avg Fat (%)")) %>%
  kable_paper("striped", full_width = F)

```

##### Maine {.tabset .tabset-fade .tabset-pills}

###### By Year


```{r echo=FALSE}

ggplot(data=subset(FatData, Supplier == "Maine"), aes(x=Year, y=Fat)) +
  geom_boxplot() +
  labs(y="Fat Percent (%)")

FatData %>%
  dplyr::filter(Supplier == "Maine") %>%
  group_by(Year) %>%
  summarize(FatMean = mean(Fat)) %>%
  kbl(col.names = c("Year", "Avg Fat (%)")) %>%
  kable_paper("striped", full_width = F)

```

###### By Month 


```{r echo=FALSE}
ggplot(data=subset(FatData, Supplier == "Comeaus" & !is.na(Month)), aes(x=Month, y=Fat, group=Month)) +
  geom_boxplot() +
  scale_x_continuous(breaks = round(seq(min(FatData$Month, max(FatData$Month), by = 1), 12)) ) +
  labs(y="Fat Percent (%)")

FatData %>%
  dplyr::filter(Supplier == "Connors" & !is.na(Month)) %>%
  group_by(Month) %>%
  summarize(FatMean = mean(Fat)) %>%
  kbl(col.names = c("Month", "Avg Fat (%)")) %>%
  kable_paper("striped", full_width = F)

```


#### Weight At Age {.tabset .tabset-fade .tabset-pills}

::: row
::: col-md-6
```{r echo=FALSE}
FatDataSum = FatDataSum %>% 
  group_by(Year) %>%
  summarize(WAA = mean(WAA), Fat = mean(Fat))

p1 = ggplot(FatDataSum, aes(x=Year)) + 
  geom_line(aes(y=Fat)) +
  labs(y="Fat Percentage (%)")

p2 = ggplot(FatDataSum, aes(x=Year)) +
  geom_line(aes(y=WAA)) +
  labs(y="Average Weight At Age (g)")

library(patchwork)
p1+p2
```
:::

::: col-md-6
```{r echo=FALSE}
FatDataSum %>%
  kbl(col.names = c("Year", "Avg Wt at Age (g)", "Fat (%)")) %>%
  kable_paper("striped", full_width = T)

```
:::
:::